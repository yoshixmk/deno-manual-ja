<!DOCTYPE HTML>
<html lang="ja" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Deno 日本語マニュアル</title>
        
        <meta name="robots" content="noindex" />
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="introduction.html"><strong aria-hidden="true">1.</strong> 前書き</a></li><li class="chapter-item expanded "><a href="getting_started.html"><strong aria-hidden="true">2.</strong> 入門</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="getting_started/installation.html"><strong aria-hidden="true">2.1.</strong> インストール方法</a></li><li class="chapter-item expanded "><a href="getting_started/setup_your_environment.html"><strong aria-hidden="true">2.2.</strong> 環境セットアップ</a></li><li class="chapter-item expanded "><a href="getting_started/first_steps.html"><strong aria-hidden="true">2.3.</strong> ファーストステップ</a></li><li class="chapter-item expanded "><a href="getting_started/command_line_interface.html"><strong aria-hidden="true">2.4.</strong> コマンドラインインターフェース</a></li><li class="chapter-item expanded "><a href="getting_started/permissions.html"><strong aria-hidden="true">2.5.</strong> パーミッション</a></li><li class="chapter-item expanded "><a href="getting_started/typescript.html"><strong aria-hidden="true">2.6.</strong> TypeScriptの使用</a></li><li class="chapter-item expanded "><a href="getting_started/webassembly.html"><strong aria-hidden="true">2.7.</strong> WebAssemblyの使用</a></li></ol></li><li class="chapter-item expanded "><a href="runtime.html"><strong aria-hidden="true">3.</strong> ランタイム</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="runtime/stability.html"><strong aria-hidden="true">3.1.</strong> 安定性</a></li><li class="chapter-item expanded "><a href="runtime/program_lifecycle.html"><strong aria-hidden="true">3.2.</strong> ライフサイクル</a></li><li class="chapter-item expanded "><a href="runtime/compiler_apis.html"><strong aria-hidden="true">3.3.</strong> コンパイラAPI</a></li><li class="chapter-item expanded "><a href="runtime/workers.html"><strong aria-hidden="true">3.4.</strong> Worker</a></li></ol></li><li class="chapter-item expanded "><a href="linking_to_external_code.html"><strong aria-hidden="true">4.</strong> 外部コードへのリンク</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="linking_to_external_code/reloading_modules.html"><strong aria-hidden="true">4.1.</strong> モジュールの再読み込み</a></li><li class="chapter-item expanded "><a href="linking_to_external_code/integrity_checking.html"><strong aria-hidden="true">4.2.</strong> 整合性チェック</a></li><li class="chapter-item expanded "><a href="linking_to_external_code/proxies.html"><strong aria-hidden="true">4.3.</strong> プロキシ</a></li><li class="chapter-item expanded "><a href="linking_to_external_code/import_maps.html"><strong aria-hidden="true">4.4.</strong> Importt maps</a></li></ol></li><li class="chapter-item expanded "><a href="standard_library.html"><strong aria-hidden="true">5.</strong> 標準ライブラリ</a></li><li class="chapter-item expanded "><a href="testing.html"><strong aria-hidden="true">6.</strong> テスト</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="testing/assertions.html"><strong aria-hidden="true">6.1.</strong> アサーション</a></li></ol></li><li class="chapter-item expanded "><a href="tools.html"><strong aria-hidden="true">7.</strong> ツール</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="tools/debugger.html"><strong aria-hidden="true">7.1.</strong> デバッガ</a></li><li class="chapter-item expanded "><a href="tools/script_installer.html"><strong aria-hidden="true">7.2.</strong> スクリプトインストーラー</a></li><li class="chapter-item expanded "><a href="tools/formatter.html"><strong aria-hidden="true">7.3.</strong> フォーマッター</a></li><li class="chapter-item expanded "><a href="tools/bundler.html"><strong aria-hidden="true">7.4.</strong> バンドラー</a></li><li class="chapter-item expanded "><a href="tools/documentation_generator.html"><strong aria-hidden="true">7.5.</strong> ドキュメントジェネレータ</a></li><li class="chapter-item expanded "><a href="tools/dependency_inspector.html"><strong aria-hidden="true">7.6.</strong> 依存関係インスペクタ</a></li><li class="chapter-item expanded "><a href="tools/linter.html"><strong aria-hidden="true">7.7.</strong> リンター</a></li></ol></li><li class="chapter-item expanded "><a href="embedding_deno.html"><strong aria-hidden="true">8.</strong> 組み込みDeno</a></li><li class="chapter-item expanded "><a href="contributing.html"><strong aria-hidden="true">9.</strong> 貢献</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="contributing/building_from_source.html"><strong aria-hidden="true">9.1.</strong> ソースコードのビルド</a></li><li class="chapter-item expanded "><a href="contributing/development_tools.html"><strong aria-hidden="true">9.2.</strong> 開発ツール</a></li><li class="chapter-item expanded "><a href="contributing/style_guide.html"><strong aria-hidden="true">9.3.</strong> スタイルガイド</a></li><li class="chapter-item expanded "><a href="contributing/architecture.html"><strong aria-hidden="true">9.4.</strong> アーキテクチャ</a></li></ol></li><li class="chapter-item expanded "><a href="examples.html"><strong aria-hidden="true">10.</strong> 例</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="examples/hello_world.html"><strong aria-hidden="true">10.1.</strong> Hello World</a></li><li class="chapter-item expanded "><a href="examples/import_export.html"><strong aria-hidden="true">10.2.</strong> インポートとエクスポート</a></li><li class="chapter-item expanded "><a href="examples/manage_dependencies.html"><strong aria-hidden="true">10.3.</strong> 依存関係の管理</a></li><li class="chapter-item expanded "><a href="examples/unix_cat.html"><strong aria-hidden="true">10.4.</strong> Unix cat</a></li><li class="chapter-item expanded "><a href="examples/file_server.html"><strong aria-hidden="true">10.5.</strong> ファイルサーバー</a></li><li class="chapter-item expanded "><a href="examples/tcp_echo.html"><strong aria-hidden="true">10.6.</strong> TCP echo</a></li><li class="chapter-item expanded "><a href="examples/subprocess.html"><strong aria-hidden="true">10.7.</strong> サブプロセス</a></li><li class="chapter-item expanded "><a href="examples/permissions.html"><strong aria-hidden="true">10.8.</strong> パーミッション付与</a></li><li class="chapter-item expanded "><a href="examples/os_signals.html"><strong aria-hidden="true">10.9.</strong> OSシグナル</a></li><li class="chapter-item expanded "><a href="examples/file_system_events.html"><strong aria-hidden="true">10.10.</strong> ファイルシステムイベント</a></li><li class="chapter-item expanded "><a href="examples/testing_if_main.html"><strong aria-hidden="true">10.11.</strong> メインファイルでのテスト</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Deno 日本語マニュアル</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        <a href="https://github.com/yoshixmk/deno-manual-ja" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#前書き" id="前書き">前書き</a></h1>
<blockquote>
<p><a href="https://github.com/yoshixmk/deno-manual-ja/" rel="noopener noreferrer" target="_blank" style="display:inline-flex;align-items:center"><span style="margin-right:1em">deno-manual-ja</span><img alt="GitHub stars" src="https://img.shields.io/github/stars/yoshixmk/deno-manual-ja?style=social"> </a></p>
<p>最終更新日 2020 年 7 月 24 日 <a href="https://github.com/denoland/deno/tree/a8f74aa381c99e9c3c3d8fdfde02919966a3a824">deno @ a8f74aa</a></p>
</blockquote>
<p>DenoはJavaScript / TypeScriptランタイムであり、安全なデフォルトと優れた開発者エクスペリエンスを備えています。</p>
<p>V8、Rust、Tokioに基づいて構築されています。</p>
<h2><a class="header" href="#特徴" id="特徴">特徴</a></h2>
<ul>
<li>
<p>デフォルトでセキュアです。ファイル、ネットワーク、または環境変数へのアクセスをしません（明示的に有効にしない限り）。</p>
</li>
<li>
<p>TypeScriptがそのまま動作することをサポートしています。</p>
</li>
<li>
<p>単一のコマンドで実行が可能 (<code>deno</code>)。</p>
</li>
<li>
<p>依存関係の検査(<code>deno info</code>)やコードフォーマッター(<code>deno fmt</code>)などの組み込みユーティリティがあります。</p>
</li>
<li>
<p>Denoで動作が保証されている一連のレビュー（監査）済みの<a href="https://github.com/denoland/deno/tree/master/std">標準モジュール</a>があります。</p>
</li>
<li>
<p>スクリプトは、単一のJavaScriptファイルにバンドルできます。</p>
</li>
</ul>
<h2><a class="header" href="#哲学" id="哲学">哲学</a></h2>
<p>Denoは、モダンなプログラマーにとって生産的で安全なスクリプト環境を目指しています。</p>
<p>Denoは常に単一の実行形式ファイルとして配布されます。 DenoへのプログラムのURLを指定すると、<a href="https://github.com/denoland/deno/releases">15MB以下の圧縮された実行可能ファイル</a>を実行できます。 Denoは、ランタイムとパッケージマネージャーの両方の役割を明示的に行います。モジュールのロードに標準のブラウザ互換プロトコルとして、URLを使用します。 </p>
<p>とりわけ、Denoは、歴史的にbashまたはpythonで作成されたユーティリティスクリプトの優れた代替品です。</p>
<h2><a class="header" href="#目標" id="目標">目標</a></h2>
<ul>
<li>
<p>単一の実行形式ファイルだけにする (<code>deno</code>)。</p>
</li>
<li>
<p>デフォルトでセキュアを提供する</p>
<ul>
<li>特に許可されていない限り、スクリプトはファイル、環境、またはネットワークにアクセスできません。</li>
</ul>
</li>
<li>
<p>ブラウザー互換性：JavaScriptで完全に記述され、グローバルな<code>Deno</code>名前空間（またはその機能テスト）を使用しなければ、変更なしで最新のWebブラウザーで実行できます。</p>
</li>
<li>
<p>ユニットテスト、コードフォーマット、リンターなどの組み込みツールを提供して、開発者のエクスペリエンスを向上させます。</p>
</li>
<li>
<p>V8の概念をユーザーランドまで拡げません。</p>
</li>
<li>
<p>効率的にHTTPを捌けます</p>
</li>
</ul>
<h2><a class="header" href="#nodejsとの比較" id="nodejsとの比較">Node.jsとの比較</a></h2>
<ul>
<li>
<p>Denoは<code>npm</code>を使用しません。</p>
<ul>
<li>URLまたはファイルパスとして参照されたモジュールを使用します。</li>
</ul>
</li>
<li>
<p>Denoは、モジュール解決アルゴリズムで<code>package.json</code>を使用しません。</p>
</li>
<li>
<p>Denoにおいて、すべての非同期アクションにはPromiseを返します。したがって、DenoはNodeとは異なるAPIを提供します。</p>
</li>
<li>
<p>Denoは、ファイル、ネットワーク、および環境へのアクセスに明示的なパーミッションを必要とします。</p>
</li>
<li>
<p>Denoは常にエラーがどこにもキャッチされないとき、終了します。</p>
</li>
<li>
<p>「ESモジュール」を使用し、<code>require()</code>をサポートしません。サードパーティのモジュールは、URLを介してインポートされます。</p>
<pre><code class="language-javascript">import * as log from &quot;https://deno.land/std@0.63.0/log/mod.ts&quot;;
</code></pre>
</li>
</ul>
<h2><a class="header" href="#その他の主要な行動" id="その他の主要な行動">その他の主要な行動</a></h2>
<ul>
<li>
<p>リモートのコードは最初の実行時にフェッチしたのちにキャッシュされ、そのコードは<code>--reload</code>フラグを使って実行されるまで更新されません。（したがって、飛行機でも機能します。） </p>
</li>
<li>
<p>リモートURLからロードされたモジュール/ファイルは、不変的にキャッシュできることを目指しています。</p>
</li>
</ul>
<h1><a class="header" href="#入門" id="入門">入門</a></h1>
<p>この章では、以下について説明します。:</p>
<ul>
<li>Denoのインストール</li>
<li>環境をセットアップする</li>
<li><code>Hello World</code>スクリプトを実行する</li>
<li>独自のスクリプトを書く</li>
<li>コマンドラインインターフェース(CLI)</li>
<li>パーミッションについて理解する</li>
<li>TypeScriptでのDenoの使用</li>
<li>WebAssemblyの使用</li>
</ul>
<h2><a class="header" href="#インストール方法" id="インストール方法">インストール方法</a></h2>
<p>DenoはmacOS、Linux、およびWindowsで動作します。 Denoは単一のバイナリ実行ファイルです。外部依存関係はありません。</p>
<h3><a class="header" href="#ダウンロードとインストール" id="ダウンロードとインストール">ダウンロードとインストール</a></h3>
<p><a href="https://github.com/denoland/deno_install">deno_install</a>は、バイナリをダウンロードしてインストールするための便利なスクリプトを提供します。</p>
<p>Shellの場合 (macOS and Linux):</p>
<pre><code class="language-shell">curl -fsSL https://deno.land/x/install/install.sh | sh
</code></pre>
<p>PowerShellの場合 (Windows):</p>
<pre><code class="language-shell">iwr https://deno.land/x/install/install.ps1 -useb | iex
</code></pre>
<p><a href="https://scoop.sh/">Scoop</a>の場合 (Windows):</p>
<pre><code class="language-shell">scoop install deno
</code></pre>
<p><a href="https://chocolatey.org/packages/deno">Chocolatey</a>の場合 (Windows):</p>
<pre><code class="language-shell">choco install deno
</code></pre>
<p><a href="https://formulae.brew.sh/formula/deno">Homebrew</a>の場合 (macOS):</p>
<pre><code class="language-shell">brew install deno
</code></pre>
<p><a href="https://crates.io/crates/deno">Cargo</a>の場合 (Windows, macOS, Linux):</p>
<pre><code class="language-shell">cargo install deno
</code></pre>
<p>Denoのバイナリは
<a href="https://github.com/denoland/deno/releases">github.com/denoland/deno/releases</a>
からZipファイルをダウンロードして、手動でインストールすることもできます。パッケージには、実行ファイルが1つだけ含まれています。macOSとLinuxは実行可能な成果物を選び設定する必要があります。</p>
<h3><a class="header" href="#インストールのテスト" id="インストールのテスト">インストールのテスト</a></h3>
<p>インストールをテストするには、<code>deno --version</code>を実行します。もしDenoバージョンがコンソールに出力されれば、インストールは成功しています。</p>
<p><code>deno help</code>を使用すると、Denoのオプションのフラグと利用方法を確認できます。
CLIの詳細については、<a href="getting_started/./command_line_interface.html">こちら</a>をご確認ください。</p>
<h3><a class="header" href="#アップデート" id="アップデート">アップデート</a></h3>
<p>以前にインストールされたバージョンのDenoを更新するには、次のコマンドを実行します:</p>
<pre><code class="language-shell">deno upgrade
</code></pre>
<p>これにより、<a href="https://github.com/denoland/deno/releases">github.com/denoland/deno/releases</a>から、最新のリリースを取得し、解凍され、現在の実行ファイルと置き換えられます。</p>
<p>次のユーティリティを使用して、特定のバージョンのDenoをインストールすることもできます:</p>
<pre><code class="language-shell">deno upgrade --version 1.0.1
</code></pre>
<h3><a class="header" href="#ソースからビルドする" id="ソースからビルドする">ソースからビルドする</a></h3>
<p>ソースからビルドする方法についての情報は、<code>貢献</code>の章にあります。</p>
<h2><a class="header" href="#環境セットアップ" id="環境セットアップ">環境セットアップ</a></h2>
<p>Denoを生産的に使用するには、環境をセットアップする必要があります。つまり、シェルのオートコンプリート、環境変数、選択したエディターまたはIDEを設定します。</p>
<h3><a class="header" href="#環境変数" id="環境変数">環境変数</a></h3>
<p>Denoの動作を制御するいくつかの環境変数があります。：</p>
<p><code>DENO_DIR</code>のデフォルトは <code>$HOME/.cache/deno</code>で、任意のパスに設定できますが、生成およびキャッシュされたソースコードの書き込みと読み取りを制御します。</p>
<p>もし<code>NO_COLOR</code>を設定すれば、カラー出力がオフになります。 <a href="https://no-color.org/">https://no-color.org/</a>を参照してください。<code>NO_COLOR</code>を使用することで<code>--allow-env</code>を使うことなく、ソースコードでboolean定数の<code>Deno.noColor</code>を使用して、設定されているかどうかをテストできます。</p>
<h3><a class="header" href="#シェルのオートコンプリート" id="シェルのオートコンプリート">シェルのオートコンプリート</a></h3>
<p><code>deno completions &lt;shell&gt;</code>を使用して、 シェルのオートコンプリート用のスクリプトを生成できます 。コマンドはstdoutに出力するため、適切なファイルにリダイレクトする必要があります。</p>
<p>Deno がサポートしているシェルは次の通り：</p>
<ul>
<li>zsh</li>
<li>bash</li>
<li>fish</li>
<li>powershell</li>
<li>elvish</li>
</ul>
<p>例 (bash)：</p>
<pre><code class="language-shell">deno completions bash &gt; /usr/local/etc/bash_completion.d/deno.bash
source /usr/local/etc/bash_completion.d/deno.bash
</code></pre>
<p>例 (zsh):</p>
<pre><code class="language-shell">mkdir ~/.oh-my-zsh/custom/plugins/deno
deno completions zsh &gt; ~/.oh-my-zsh/custom/plugins/deno/_deno
</code></pre>
<p>在此之后，在 <code>~/.zshrc</code> 文件中的 plugins 标签下增加 <code>deno</code> 插件。</p>
<h3><a class="header" href="#エディターとide" id="エディターとide">エディターとIDE</a></h3>
<p>Denoはモジュールのインポートにファイル拡張子を使用する必要があり、さらにはhttpのインポートを許可が必要で、現在ほとんどのエディターと言語サーバーはこれをネイティブでサポートしていないため、多くのエディターは不要なファイル拡張子を持つファイルまたはインポートを見つけられないというエラーをスローします。</p>
<p>コミュニティは、一部の編集者がこれらの問題を解決するための拡張機能を開発しています:</p>
<h4><a class="header" href="#vs-code" id="vs-code">VS Code</a></h4>
<p>ベータバージョンの <a href="https://github.com/denoland/vscode_deno">vscode_deno</a>が<a href="https://marketplace.visualstudio.com/items?itemName=denoland.vscode-deno">Visual Studio Marketplace</a>に公開されました。問題があればIssuesをください。</p>
<h4><a class="header" href="#jetbrains-ide" id="jetbrains-ide">JetBrains IDE</a></h4>
<p>JetBrains IDEのサポートは、<a href="https://plugins.jetbrains.com/plugin/14382-deno">the Deno plugin</a>を通じて利用できます。</p>
<p>JetBrains IDEをDeno用に設定する方法の詳細については、YouTrackの<a href="https://youtrack.jetbrains.com/issue/WEB-41607#focus=streamItem-27-4160152.0-0">このコメント</a>を参照してください。</p>
<h3><a class="header" href="#vim-と-neovim" id="vim-と-neovim">Vim と NeoVim</a></h3>
<p>もし<a href="https://github.com/neoclide/coc.nvim">CoC</a>（intellisense engine and language server protocol）をインストールすれば、Vim は Deno/TypeScript に対してかなりうまく機能します。</p>
<p>当安装完 CoC 后，可以在 Vim 内部运行 <code>:CocInstall coc-deno</code>。你会发现，诸如 <code>gd</code>（转到定义）和 <code>gr</code>（转到/查找引用）之类的东西可以正常工作了。</p>
<p>CoCをインストールした後、Vim内からおよび<code>：CocInstall coc-deno</code>と<code>:CocInstall coc-deno</code>を実行します。 Denoタイプ定義でオートコンプリートを機能させるには、<code>：CocCommand deno.types</code>を実行します。必要に応じて、<code>：CocRestart</code>でCoCサーバーを再起動します。これからは、<code>gd</code>（定義に移動）や<code>gr</code>（goto / find参照）などが機能するようになります。</p>
<h4><a class="header" href="#emacs" id="emacs">Emacs</a></h4>
<p>Emacsは、Emacs内でTypeScriptを使用する標準的な方法である<a href="https://github.com/ananthakumaran/tide">tide</a>と、Denoの<a href="https://github.com/denoland/vscode_deno">公式VSCode拡張機能</a>で使用される<a href="https://github.com/justjavac/typescript-deno-plugin">typescript-deno-plugin</a>の組み合わせを使用することにより、DenoをターゲットとするTypeScriptプロジェクトでかなりうまく機能します。</p>
<p>これを使用するには、まずEmacsのインスタンスに<code>tide</code>が設定されていることを確認してください。次に、 <a href="https://github.com/justjavac/typescript-deno-plugin">typescript-deno-plugin</a> ページで指示されているように、最初に <code>npm install --save-dev typescript-deno-plugin typescript</code> (<code>npm init -y</code>が必須)を行い、次に下記のブロックを<code>tsconfig.json</code>に追加すれば準備完了です！</p>
<pre><code class="language-json">{
  &quot;compilerOptions&quot;: {
    &quot;plugins&quot;: [
      {
        &quot;name&quot;: &quot;typescript-deno-plugin&quot;,
        &quot;enable&quot;: true, // default is `true`
        &quot;importmap&quot;: &quot;import_map.json&quot;
      }
    ]
  }
}
</code></pre>
<p>このリストにお気に入りのIDEがない場合は、拡張機能を開発するかもしれません。私たちの<a href="https://discord.gg/deno">コミュニティのDiscordグループ</a>で、どこから始めればよいかについて、いくつか指針を差し上げることができます。</p>
<h2><a class="header" href="#ファーストステップ" id="ファーストステップ">ファーストステップ</a></h2>
<p>このページには、Denoの基礎について説明するいくつかの例が含まれています。 </p>
<p>このドキュメントは、JavaScript、特に<code>async</code>/<code>await</code>に関する予備知識があることを前提としています。 JavaScriptの予備知識がない場合は、Denoから始める前に、<a href="https://developer.mozilla.org/zh-CN/docs/learn/JavaScript">JavaScript</a>の基本に関するガイドに従うことをお勧めします。</p>
<h3><a class="header" href="#hello-world" id="hello-world">Hello World</a></h3>
<p>DenoはJavaScript / TypeScriptのランタイムであり、Web互換で、可能な限り最新の機能を使用しようとします。 ブラウザーの互換性は、Denoの<code>Hello World</code>プログラムがブラウザーで実行できるプログラムと同じであることを意味します。</p>
<pre><code class="language-ts">console.log(&quot;Welcome to Deno 🦕&quot;);
</code></pre>
<p>プログラムを試してください：</p>
<pre><code class="language-shell">deno run https://deno.land/std/examples/welcome.ts
</code></pre>
<h3><a class="header" href="#httpリクエストを行う" id="httpリクエストを行う">HTTPリクエストを行う</a></h3>
<p>多くのプログラムは、HTTP要求を使用してWebサーバーからデータをフェッチします。ファイルをフェッチしてその内容を端末に出力する小さなプログラムを書いてみましょう。 ブラウザーと同様に、Web標準<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API"><code>fetch</code></a>APIを使用してHTTP呼び出しを行うことができます。</p>
<pre><code class="language-typescript">const url = Deno.args[0];
const res = await fetch(url);

const body = new Uint8Array(await res.arrayBuffer());
await Deno.stdout.write(body);
</code></pre>
<p>このアプリケーションの機能を見ていきましょう。</p>
<ol>
<li>
<p>最初の引数をアプリケーションに渡して、それを<code>url</code>定数に格納します。</p>
</li>
<li>
<p>指定されたURLにリクエストを送信し、レスポンスを待って、<code>res</code>定数に格納します。</p>
</li>
<li>
<p>応答の本文を<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer"><code>ArrayBuffer</code></a>として解析し、応答を待ち、<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array"><code>Uint8Array</code></a>に変換して<code>body</code>の定数に格納します。。</p>
</li>
<li>
<p><code>body</code>定数の内容を<code>stdout</code>に書き込みます。</p>
</li>
</ol>
<p>やってみよう：</p>
<pre><code class="language-shell">deno run https://deno.land/std/examples/curl.ts https://example.com
</code></pre>
<p>このプログラムはネットワークアクセスに関するエラーを返しますが、何が問題だったのでしょうか。はじめに、Denoはデフォルトで安全なランタイムであることを覚えているかもしれません。つまり、ネットワークへのアクセスなど、特定の「特権」アクションを実行する許可をプログラムに明示的に与える必要があります。</p>
<p>正しい許可フラグでもう一度試してください:</p>
<pre><code class="language-shell">deno run --allow-net=example.com https://deno.land/std/examples/curl.ts https://example.com
</code></pre>
<h3><a class="header" href="#ファイルを読み取る" id="ファイルを読み取る">ファイルを読み取る</a></h3>
<p>Denoは、Web以外のAPIも提供しています。これらはすべて<code>Deno</code>グローバルに含まれています。これらのAPIのドキュメントは、<a href="https://doc.deno.land/https/github.com/denoland/deno/releases/latest/download/lib.deno.d.ts">doc.deno.land</a>にあります。</p>
<p>たとえばファイルシステムAPIにはWeb標準形式がないため、Denoは独自のAPIを提供します。</p>
<p>このプログラムでは、各コマンドライン引数はファイル名であると想定され、ファイルが開かれ、標準出力に出力されます。</p>
<p>例：<a href="getting_started/../examples/unix_cat.html">Unix cat</a></p>
<p>このプログラムでは、各コマンドライン引数はファイル名であると想定され、ファイルが開かれ、標準出力に出力されます。</p>
<pre><code class="language-ts">const filenames = Deno.args;
for (const filename of filenames) {
  const file = await Deno.open(filename);
  await Deno.copy(file, Deno.stdout);
  file.close();
}
</code></pre>
<p>ここの<code>copy()</code>関数は、実際には必要なカーネル-&gt;ユーザースペース-&gt;カーネルのコピーしか作成しません。つまり、データがファイルから読み取られるのと同じメモリがstdoutに書き込まれます。これは、DenoのI / Oストリームの一般的な設計目標を示しています。</p>
<p>プログラムを試してください：</p>
<pre><code class="language-shell">deno run --allow-read https://deno.land/std@$STD_VERSION/examples/cat.ts /etc/passwd
</code></pre>
<h3><a class="header" href="#tcp-サーバー" id="tcp-サーバー">TCP サーバー</a></h3>
<p>例：<a href="getting_started/../examples/tcp_echo.html">TCP echo</a></p>
<p>これは、ポート8080で接続を受け入れ、送信したものをクライアントに返すサーバーの例です。</p>
<pre><code class="language-ts">const listener = Deno.listen({ port: 8080 });
console.log(&quot;listening on 0.0.0.0:8080&quot;);
for await (const conn of listener) {
  Deno.copy(conn, conn);
}
</code></pre>
<p>このプログラムを起動すると、PermissionDeniedエラーがスローされます。</p>
<pre><code class="language-shell">$ deno run https://deno.land/std@$STD_VERSION/examples/echo_server.ts
error: Uncaught PermissionDenied: network access to &quot;0.0.0.0:8080&quot;, run again with the --allow-net flag
► $deno$/dispatch_json.ts:40:11
    at DenoError ($deno$/errors.ts:20:5)
    ...
</code></pre>
<p>セキュリティ上の理由から、Denoは明示的な許可なしにプログラムがネットワークにアクセスすることを許可していません。ネットワークへのアクセスを許可するには、コマンドラインフラグを使用します：</p>
<pre><code class="language-shell">deno run --allow-net https://deno.land/std@$STD_VERSION/examples/echo_server.ts
</code></pre>
<p>テストするには、netcatを使用してデータを送信してみてください。</p>
<pre><code class="language-shell">$ nc localhost 8080
hello world
hello world
</code></pre>
<p><code>cat.ts</code>の例と同様に、ここでの<code>copy()</code>関数も不要なメモリコピーを作成しません。それはカーネルからパケットを受信し、さらに複雑にすることなく送り返します。</p>
<h3><a class="header" href="#更なる例について" id="更なる例について">更なる例について</a></h3>
<p>HTTPファイルサーバーなどの例は、<a href="getting_started/../examples.html">例</a> の章にあります。</p>
<h2><a class="header" href="#コマンドラインインターフェースcli" id="コマンドラインインターフェースcli">コマンドラインインターフェース(CLI)</a></h2>
<p>Denoはコマンドラインプログラムです。これまでの例に従ってきたいくつかの簡単なコマンドに精通し、シェルの使用法の基本をすでに理解している必要があります。</p>
<p>メインのヘルプテキストを表示する方法はいくつかあります。</p>
<pre><code class="language-shell"># Using the subcommand.
deno help

# Using the short flag -- outputs the same as above.
deno -h

# Using the long flag -- outputs more detailed help text where available.
deno --help
</code></pre>
<p>DenoのCLIはサブコマンドベースです。上記のコマンドは、<code>deno bundle</code>など、サポートされているもののリストを表示します。 bundleのサブコマンド固有のヘルプを表示するには、同様に次のいずれかを実行できます。</p>
<pre><code class="language-shell">deno help bundle
deno bundle -h
deno bundle --help
</code></pre>
<p>各サブコマンドの詳細なガイドは<a href="getting_started/../tools.html">这里</a>にあります。</p>
<h3><a class="header" href="#スクリプト" id="スクリプト">スクリプト</a></h3>
<p>Denoは、複数のソース、ファイル名、URL、および「-」からスクリプトを取得して、stdinからファイルを読み取ることができます。最後は他のアプリケーションとの統合に役立ちます。</p>
<pre><code class="language-shell">deno run main.ts
deno run https://mydomain.com/main.ts
cat main.ts | deno run -
</code></pre>
<h3><a class="header" href="#スクリプト引数" id="スクリプト引数">スクリプト引数</a></h3>
<p>Denoランタイムフラグとは別に、スクリプト名の後にユーザースペース引数を指定して、実行中のスクリプトに渡すことができます。</p>
<pre><code class="language-shell">deno run main.ts a b -c --quiet
</code></pre>
<pre><code class="language-ts">// main.ts
console.log(Deno.args); // [ &quot;a&quot;, &quot;b&quot;, &quot;-c&quot;, &quot;--quiet&quot; ]
</code></pre>
<p><strong>スクリプト名の後に渡されたものはすべてスクリプト引数として渡され、Denoランタイムフラグとしては消費されないことに注意してください。</strong></p>
<p>これは、次の落とし穴につながります:</p>
<pre><code class="language-shell"># Good. We grant net permission to net_client.ts.
deno run --allow-net net_client.ts

# Bad! --allow-net was passed to Deno.args, throws a net permission error.
deno run net_client.ts --allow-net
</code></pre>
<p>一部の人は、それを型破りなものと感じるかもしれません：</p>
<blockquote>
<p>非定位置フラグは、その位置に応じて異なる方法で解析されます。</p>
</blockquote>
<p>しかしながら：</p>
<ol>
<li>これは、ランタイムフラグとスクリプト引数を区別する最も論理的な方法です。</li>
<li>これは、ランタイムフラグとスクリプト引数を区別する最も人間工学的な方法です。</li>
<li>これは実際には、他の一般的なランタイムと同じ動作です。</li>
<li>实际上，这和其他流行的运行时具有相同的行为。
<ul>
<li><code>node -c index.js</code> と <code>node index.js -c</code>を試してみます。すると1つ目は、ノードの<code>-c</code>フラグに従って、<code>index.js</code>の構文チェックのみを実行します。2番目は、<code>require(&quot;process&quot;).argv</code>に<code>-c</code>を渡して<code>index.js</code>を実行します。</li>
</ul>
</li>
</ol>
<hr />
<p>関連するサブコマンド間で共有されるフラグの論理グループが存在します。これらについては以下で説明します。</p>
<h3><a class="header" href="#整合性フラグ" id="整合性フラグ">整合性フラグ</a></h3>
<p>リソースをキャッシュにダウンロードできるコマンドに影響を与えます：<code>deno cache</code>、<code>deno run</code>、<code>deno test</code>。</p>
<pre><code>--lock &lt;FILE&gt;    Check the specified lock file
--lock-write     Write lock file. Use with --lock.
</code></pre>
<p>これらの詳細については、<a href="getting_started/../linking_to_external_code/integrity_checking.html">这里</a>をご覧ください。</p>
<h3><a class="header" href="#キャッシュとコンパイルのフラグ" id="キャッシュとコンパイルのフラグ">キャッシュとコンパイルのフラグ</a></h3>
<p>キャッシュにデータを入力できるコマンドに影響を与えます：<code>deno cache</code>、<code>deno run</code>、<code>deno test</code>。上記のフラグに加えて、これにはモジュールの解決、コンパイル構成などに影響するフラグが含まれます。</p>
<pre><code>--config &lt;FILE&gt;               Load tsconfig.json configuration file
--importmap &lt;FILE&gt;            UNSTABLE: Load import map file
--no-remote                   Do not resolve remote modules
--reload=&lt;CACHE_BLOCKLIST&gt;    Reload source code cache (recompile TypeScript)
--unstable                    Enable unstable APIs
</code></pre>
<h3><a class="header" href="#ランタイムフラグ" id="ランタイムフラグ">ランタイムフラグ</a></h3>
<p>ユーザーコードを実行するコマンドに影響を与えます：<code>deno run</code>および<code>deno test</code>。これらには、上記のすべてと次のものが含まれます。</p>
<h4><a class="header" href="#パーミッションフラグ" id="パーミッションフラグ">パーミッションフラグ</a></h4>
<p>これらは<a href="getting_started/./permissions.html">こちら</a>にリストされています。</p>
<h4><a class="header" href="#その他のランタイムフラグ" id="その他のランタイムフラグ">その他のランタイムフラグ</a></h4>
<p>実行環境に影響を与えるその他のフラグ：</p>
<pre><code>--cached-only                Require that remote dependencies are already cached
--inspect=&lt;HOST:PORT&gt;        activate inspector on host:port ...
--inspect-brk=&lt;HOST:PORT&gt;    activate inspector on host:port and break at ...
--seed &lt;NUMBER&gt;              Seed Math.random()
--v8-flags=&lt;v8-flags&gt;        Set V8 command line options. For help: ...
</code></pre>
<h2><a class="header" href="#パーミッション" id="パーミッション">パーミッション</a></h2>
<p>Denoはデフォルトで安全です。したがって、特に有効にしない限り、denoモジュールには、ファイル、ネットワーク、環境などのアクセス権がありません。セキュリティ上重要な領域や機能にアクセスするには、コマンドラインでdenoプロセスに許可を与える必要があります。</p>
<p>次の例では、<code>mod.ts</code>にファイルシステムへの読み取り専用アクセスが許可されています。それに書き込むことも、その他の機密性の高い機能を実行することもできません。</p>
<pre><code class="language-shell">deno run --allow-read mod.ts
</code></pre>
<h3><a class="header" href="#パーミッションのリスト" id="パーミッションのリスト">パーミッションのリスト</a></h3>
<p>次のパーミッションを使用できます：</p>
<ul>
<li><strong>-A, --allow-all</strong> すべての権限を許可します。これにより、すべてのセキュリティが無効になります。</li>
<li><strong>--allow-env</strong> 環境変数の取得や設定などの環境アクセスを許可します。</li>
<li><strong>--allow-hrtime</strong> 高分解能の時間測定を可能にします。高解像度の時間は、タイミング攻撃やフィンガープリントに使用できます。</li>
<li><strong>--allow-net=&lt;allow-net&gt;</strong> ネットワークアクセスを許可します。オプションのドメインのコンマ区切りリストを指定して、許可されたドメインの許可リストを提供できます。</li>
<li><strong>--allow-plugin</strong> プラグインの読み込みを許可します。 --allow-pluginは不安定な機能であることに注意してください。</li>
<li><strong>--allow-read=&lt;allow-read&gt;</strong> ファイルシステムの読み取りアクセスを許可します。オプションのコンマ区切りのディレクトリまたはファイルのリストを指定して、許可されたファイルシステムアクセスの許可リストを提供できます。</li>
<li><strong>--allow-run</strong> サブプロセスの実行を許可します。サブプロセスはサンドボックスで実行されないため、denoプロセスと同じセキュリティ制限がないことに注意してください。したがって、注意して使用してください。</li>
<li><strong>--allow-write=&lt;allow-write&gt;</strong> ファイルシステムの書き込みアクセスを許可します。オプションのコンマ区切りのディレクトリまたはファイルのリストを指定して、許可されたファイルシステムアクセスの許可リストを提供できます。</li>
</ul>
<h3><a class="header" href="#パーミッション許可リスト" id="パーミッション許可リスト">パーミッション許可リスト</a></h3>
<p>Denoでは、許可リストを使用して一部の権限の細かさを制御することもできます。</p>
<p>この例では、<code>/usr</code>ディレクトリのみを許可リストすることによってファイルシステムアクセスを制限していますが、プロセスが<code>/etc</code>ディレクトリ内のファイルにアクセスしようとしたため、実行は失敗します。</p>
<pre><code class="language-shell">$ deno run --allow-read=/usr https://deno.land/std/examples/cat.ts /etc/passwd
error: Uncaught PermissionDenied: read access to &quot;/etc/passwd&quot;, run again with the --allow-read flag
► $deno$/dispatch_json.ts:40:11
    at DenoError ($deno$/errors.ts:20:5)
    ...
</code></pre>
<p>代わりに<code>/etc</code>を許可リストにして、正しい権限でもう一度試してください:</p>
<pre><code class="language-shell">deno run --allow-read=/etc https://deno.land/std/examples/cat.ts /etc/passwd
</code></pre>
<p><code>--allow-write</code> は<code>--allow-read</code>と同じように機能します</p>
<h3><a class="header" href="#ネットワークアクセス" id="ネットワークアクセス">ネットワークアクセス</a></h3>
<p><em>fetch.ts</em>:</p>
<pre><code class="language-ts">const result = await fetch(&quot;https://deno.land/&quot;);
</code></pre>
<p>これは、ホスト/ URLを許可するリストの例です：</p>
<pre><code class="language-shell">deno run --allow-net=github.com,deno.land fetch.ts
</code></pre>
<p>もし<code>fetch.ts</code>が他のドメインへのネットワーク接続を確立しようとすると、プロセスは失敗します。</p>
<p>すべてのホスト/ URLへの呼び出しを許可：</p>
<pre><code class="language-shell">deno run --allow-net fetch.ts
</code></pre>
<h2><a class="header" href="#typescriptの使用" id="typescriptの使用">TypeScriptの使用</a></h2>
<!-- TODO(lucacasonato): text on 'just import .ts' -->
<p>Denoは、実行時にファーストクラス言語としてJavaScriptとTypeScriptの両方をサポートします。つまり、拡張子（または正しいメディアタイプを提供するサーバー）を含む完全修飾モジュール名が必要です。さらに、Denoには「魔法の」モジュール解決策がありません。代わりに、インポートされたモジュールは、ファイル（拡張子を含む）または完全修飾URLインポートとして指定されます。 Typescriptモジュールは直接インポートできます。例えば：</p>
<pre><code class="language-ts">import { Response } from &quot;https://deno.land/std@0.64.0/http/server.ts&quot;;
import { queue } from &quot;./collections.ts&quot;;
</code></pre>
<h3><a class="header" href="#--no-check-オプション" id="--no-check-オプション"><code>--no-check</code> オプション</a></h3>
<p><code>deno run</code>、<code>deno test</code>、<code>deno cache</code>、<code>deno info</code>、<code>deno bundle</code>を使用する場合、<code>--no-check</code>フラグを指定してTypeScriptタイプのチェックを無効にすることができます。これにより、プログラムの起動にかかる時間を大幅に短縮できます。これは、エディターによって型チェックが提供され、起動時間をできるだけ速くしたい場合（ファイルウォッチャーでプログラムを自動的に再起動する場合など）に非常に役立ちます。</p>
<p><code>--no-check</code>はTypeScriptの型チェックを行わないため、型情報が必要になるため、型のみのインポートとエクスポートを自動的に削除することはできません。この目的のために、TypeScriptは<a href="https://www.typescriptlang.org/docs/handbook/release-notes/typescript-3-8.html#type-only-imports-and-exports"><code>importタイプとexportタイプの構文</code></a>を提供します。タイプを別のファイルにエクスポートするには、<code>export type {AnInterface} from &quot;./mod.ts&quot;;</code>を使用します。タイプをインポートするには、 <code>import type { AnInterface } from &quot;./mod.ts&quot;;</code>を使用します。 <code>importsNotUsedAsValues</code> TypeScriptコンパイラオプションを<code>&quot;error&quot;</code>に設定することで、必要に応じてインポートタイプとエクスポートタイプを使用していることを確認できます。このオプションを使用した<a href="https://github.com/denoland/deno/blob/master/std/tsconfig_test.json"><code>tsconfig_test.json</code></a>の例は、標準ライブラリ内にあります。</p>
<h3><a class="header" href="#外部型定義の使用" id="外部型定義の使用">外部型定義の使用</a></h3>
<p>ただし、標準のTypeScriptコンパイラは、JavaScriptモジュールにタイプを適用するために、拡張機能のないモジュールとNode.jsモジュール解決ロジックの両方に依存しています。</p>
<p>このギャップを埋めるために、Denoは「魔法の」解決に頼ることなくタイプ定義ファイルを参照する3つの方法をサポートしています。</p>
<h4><a class="header" href="#コンパイラーのヒント" id="コンパイラーのヒント">コンパイラーのヒント</a></h4>
<p>JavaScriptモジュールをインポートしていて、そのモジュールの型定義の場所がわかっている場合は、インポート時に型定義を指定できます。これはコンパイラのヒントの形をとります。コンパイラーのヒントは、<code>.d.ts</code>ファイルの場所と、それらが関連付けられているインポートされたJavaScriptコードをDenoに通知します。ヒントは<code>@deno-types</code>であり、指定すると、JavaScriptモジュールの代わりにコンパイラで値が使用されます。</p>
<p>たとえば、<code>foo.js</code>があったが、それに加えてファイルのタイプであるfoo.d.tsであることがわかっている場合、コードは次のようになります:</p>
<pre><code class="language-ts">// @deno-types=&quot;./foo.d.ts&quot;
import * as foo from &quot;./foo.js&quot;;
</code></pre>
<p>値は、モジュールのインポートと同じ解決ロジックに従います。つまり、ファイルには拡張子が必要であり、現在のモジュールに対して相対的です。リモート指定子も使用できます。</p>
<p>ヒントは、<code>@deno-types</code>の値が、指定されたモジュールの代わりにコンパイル時に置換される次の<code>import</code>ステートメント（または<code>export ... from</code>ステートメント）に影響します。上記の例のように、Denoコンパイラは<code>./foo.js</code>ではなく<code>./foo.d.ts</code>をロードします。 Denoはプログラムの実行時に<code>./foo.js</code>を引き続きロードします。</p>
<h4><a class="header" href="#javascriptファイルのトリプルスラッシュ参照ディレクティブ" id="javascriptファイルのトリプルスラッシュ参照ディレクティブ">JavaScriptファイルのトリプルスラッシュ参照ディレクティブ</a></h4>
<p>Denoで使用するモジュールをホストしていて、型定義の場所についてDenoに通知する場合は、実際のコードでトリプルスラッシュディレクティブを使用できます。たとえば、JavaScriptモジュールがあり、そのファイルの横にある型定義の場所をDenoに提供する場合、<code>foo.js</code>という名前のJavaScriptモジュールは次のようになります。：</p>
<pre><code class="language-js">/// &lt;reference types=&quot;./foo.d.ts&quot; /&gt;
export const foo = &quot;foo&quot;;
</code></pre>
<p>Denoはこれを確認し、コンパイラはファイルの型チェック時に<code>foo.d.ts</code>を使用しますが、<code>foo.js</code>は実行時にロードされます。ディレクティブの値の解決は、モジュールのインポートと同じ解決ロジックに従います。</p>
<p>つまり、ファイルには拡張子が必要であり、現在のファイルに対して相対的です。リモート指定子も使用できます。</p>
<h4><a class="header" href="#x-typescript-types-カスタムヘッダー" id="x-typescript-types-カスタムヘッダー">X-TypeScript-Types カスタムヘッダー</a></h4>
<p>Denoによって使用されるモジュールをホストしていて、Denoに型定義の場所を通知する場合は、<code>X-TypeScript-Types</code>のカスタムHTTPヘッダーを使用して、そのファイルの場所をDenoに通知できます。</p>
<p>ヘッダーは、前述のトリプルスラッシュリファレンスと同じように機能します。つまり、JavaScriptファイル自体のコンテンツを変更する必要がなく、型定義の場所をサーバー自体が決定できることを意味します。</p>
<p><strong>すべての型定義がサポートされているわけではありません。</strong></p>
<p>Denoはコンパイラヒントを使用して、指定された<code>.d.ts</code>ファイルをロードしますが、一部の<code>.d.ts</code>ファイルにはサポートされていない機能が含まれています。具体的には、一部の<code>.d.ts</code>ファイルは、モジュール解決ロジックを使用して、他のパッケージからタイプ定義をロードまたは参照できると想定しています。たとえば、<code>node</code>を含めるタイプ参照ディレクティブは、。<code>./node_modules/@types/node/index.d.ts</code>のようなパスに解決されることを期待しています。これは相対的でない「魔法の」解像度に依存するため、Denoはこれを解決できません。</p>
<p><strong>TypeScriptファイルでトリプルスラッシュタイプの参照を使用しないのはなぜですか？</strong></p>
<p>TypeScriptコンパイラは、タイプ参照ディレクティブを含むトリプルスラッシュディレクティブをサポートします。 Denoがこれを使用した場合、TypeScriptコンパイラの動作に干渉します。 DenoはJavaScript（およびJSX）ファイルでディレクティブを検索するだけです。</p>
<h3><a class="header" href="#カスタムtypescriptコンパイラオプション" id="カスタムtypescriptコンパイラオプション">カスタムTypeScriptコンパイラオプション</a></h3>
<p>Denoエコシステムでは、デフォルトで<code>厳格</code>であるというTypeScriptの理想に準拠するために、すべての厳格なフラグが有効になっています。ただし、カスタマイズをサポートする方法を提供するために、プログラムの実行時に<code>tsconfig.json</code>などの構成ファイルがDenoに提供される場合があります。 </p>
<p>アプリケーションを実行するときに<code>-C</code>（または<code>--config</code>）引数を設定して、この構成を探す場所をDenoに明示的に指示する必要があります。</p>
<pre><code class="language-shell">deno run -c tsconfig.json mod.ts
</code></pre>
<p>以下は、現在Denoで許可されている設定とそのデフォルト値です：</p>
<pre><code class="language-json">{
  &quot;compilerOptions&quot;: {
    &quot;allowJs&quot;: false,
    &quot;allowUmdGlobalAccess&quot;: false,
    &quot;allowUnreachableCode&quot;: false,
    &quot;allowUnusedLabels&quot;: false,
    &quot;alwaysStrict&quot;: true,
    &quot;assumeChangesOnlyAffectDirectDependencies&quot;: false,
    &quot;checkJs&quot;: false,
    &quot;disableSizeLimit&quot;: false,
    &quot;generateCpuProfile&quot;: &quot;profile.cpuprofile&quot;,
    &quot;jsx&quot;: &quot;react&quot;,
    &quot;jsxFactory&quot;: &quot;React.createElement&quot;,
    &quot;lib&quot;: [],
    &quot;noFallthroughCasesInSwitch&quot;: false,
    &quot;noImplicitAny&quot;: true,
    &quot;noImplicitReturns&quot;: true,
    &quot;noImplicitThis&quot;: true,
    &quot;noImplicitUseStrict&quot;: false,
    &quot;noStrictGenericChecks&quot;: false,
    &quot;noUnusedLocals&quot;: false,
    &quot;noUnusedParameters&quot;: false,
    &quot;preserveConstEnums&quot;: false,
    &quot;removeComments&quot;: false,
    &quot;resolveJsonModule&quot;: true,
    &quot;strict&quot;: true,
    &quot;strictBindCallApply&quot;: true,
    &quot;strictFunctionTypes&quot;: true,
    &quot;strictNullChecks&quot;: true,
    &quot;strictPropertyInitialization&quot;: true,
    &quot;suppressExcessPropertyErrors&quot;: false,
    &quot;suppressImplicitAnyIndexErrors&quot;: false,
    &quot;useDefineForClassFields&quot;: false
  }
}
</code></pre>
<p>許可される値と使用例に関するドキュメントについては、<a href="https://www.typescriptlang.org/docs/handbook/compiler-options.html">typescript docs</a>をご覧ください。.</p>
<p><strong>注意</strong>：上記にリストされていないオプションは、Denoでサポートされていないか、TypeScriptドキュメントで非推奨/実験的としてリストされています。</p>
<h2><a class="header" href="#webassembly-支持" id="webassembly-支持">WebAssembly 支持</a></h2>
<p>Denoは<a href="https://webassembly.org/">WebAssembly</a>バイナリを実行できます。</p>
<!-- dprint-ignore -->
<pre><code class="language-js">const wasmCode = new Uint8Array([
  0, 97, 115, 109, 1, 0, 0, 0, 1, 133, 128, 128, 128, 0, 1, 96, 0, 1, 127,
  3, 130, 128, 128, 128, 0, 1, 0, 4, 132, 128, 128, 128, 0, 1, 112, 0, 0,
  5, 131, 128, 128, 128, 0, 1, 0, 1, 6, 129, 128, 128, 128, 0, 0, 7, 145,
  128, 128, 128, 0, 2, 6, 109, 101, 109, 111, 114, 121, 2, 0, 4, 109, 97,
  105, 110, 0, 0, 10, 138, 128, 128, 128, 0, 1, 132, 128, 128, 128, 0, 0,
  65, 42, 11
]);
const wasmModule = new WebAssembly.Module(wasmCode);
const wasmInstance = new WebAssembly.Instance(wasmModule);
console.log(wasmInstance.exports.main().toString());
</code></pre>
<h1><a class="header" href="#ランタイム" id="ランタイム">ランタイム</a></h1>
<p>すべてのランタイム関数（Web API + Denoグローバル）の ドキュメントは、<a href="https://doc.deno.land/https/github.com/denoland/deno/releases/latest/download/lib.deno.d.ts">doc.deno.land</a>にあります。</p>
<h2><a class="header" href="#web-api" id="web-api">Web API</a></h2>
<p><code>fetch</code> HTTPリクエストのように、Web標準がすでに存在するAPIの場合、Denoは新しい独自のAPIを発明するのではなく、これらを使用します。</p>
<p>実装されたWeb APIの詳細なドキュメントは、<a href="https://doc.deno.land/https/raw.githubusercontent.com/denoland/deno/master/cli/dts/lib.deno.shared_globals.d.ts">doc.deno.land</a>にあります。さらに、Denoが実装するWeb APIの完全なリストは、<a href="https://github.com/denoland/deno/blob/master/cli/rt/README.md">リポジトリ</a>にもあります。</p>
<p>実装されたWeb APIのTypeScript定義は、
<a href="https://github.com/denoland/deno/blob/master/cli/dts/lib.deno.shared_globals.d.ts">lib.deno.shared_globals.d.ts</a> および
<a href="https://github.com/denoland/deno/blob/master/cli/dts/lib.deno.window.d.ts">lib.deno.window.d.ts</a>ファイルにあります。</p>
<p>ワーカーに固有の定義は<a href="https://github.com/denoland/deno/blob/master/cli/dts/lib.deno.worker.d.ts">lib.deno.worker.d.ts</a>ファイルにあります。</p>
<h2><a class="header" href="#deno-グローバル名前空間" id="deno-グローバル名前空間"><code>Deno</code> グローバル名前空間</a></h2>
<p>Web標準ではないすべてのAPIは、グローバル<code>Deno</code>名前空間に含まれています。ファイルからの読み取り、TCPソケットのオープン、サブプロセスの実行などのためのAPIを備えています。</p>
<p>Deno名前空間のTypeScript定義は
<a href="https://github.com/denoland/deno/blob/master/cli/dts/lib.deno.ns.d.ts">lib.deno.ns.d.ts</a>ファイルにあります。</p>
<p>Deno固有のすべてのAPIのドキュメントは、
<a href="https://doc.deno.land/https/raw.githubusercontent.com/denoland/deno/master/cli/dts/lib.deno.ns.d.ts">doc.deno.land</a>にあります。</p>
<h2><a class="header" href="#安定" id="安定">安定</a></h2>
<p>Deno 1.0.0以降、<code>Deno</code>名前空間APIは安定しています。つまり、1.0.0で動作するコードが今後のバージョンでも引き続き動作するように努めます。</p>
<p>ただし、Denoの機能のすべてがまだプロダクションの準備ができているわけではありません。まだドラフト段階にあるため準備ができていない機能は、<code>--unstable</code>コマンドラインフラグの背後にロックされています。</p>
<pre><code class="language-shell">deno run --unstable mod_which_uses_unstable_stuff.ts
</code></pre>
<p>このフラグを渡すと、いくつかのことが行われます。</p>
<ul>
<li>実行時に不安定なAPIを使用できるようにします。</li>
<li><a href="https://doc.deno.land/https/raw.githubusercontent.com/denoland/deno/master/cli/dts/lib.deno.unstable.d.ts"><code>lib.deno.unstable.d.ts</code></a>型チェックに使用されるTypeScript定義のリストにファイルを追加します。<code>deno types</code>にはこの出力が含まれます。</li>
</ul>
<p>多くの不安定なAPIは<strong>セキュリティレビューを受けておらず</strong>、将来APIに重大な変更が加えられる可能性が あり、<strong>本稼働の準備ができていない</strong>ことに注意してください。</p>
<h3><a class="header" href="#標準モジュール" id="標準モジュール">標準モジュール</a></h3>
<p>Denoの標準モジュール（<a href="https://deno.land/std/">https://deno.land/std/</a>）はまだ安定していません。現在、これを反映するために、CLIとは異なる方法で標準モジュールをバージョン管理しています。<code>Deno</code>名前空間とは異なり、標準モジュールの使用には<code>--unstable</code>フラグが不要であることに注意してください（標準モジュール自体が不安定なDeno機能を使用しない限り）。</p>
<h2><a class="header" href="#ライフサイクル" id="ライフサイクル">ライフサイクル</a></h2>
<p>Denoは、ブラウザの互換性のあるライフサイクルイベントをサポートしています<code>load</code>と<code>unload</code>。これらのイベントを使用して、プログラムにセットアップコードとクリーンアップコードを提供できます。</p>
<p><code>load</code>イベントのリスナーは非同期であり、待機します。<code>unload</code>イベントのリスナーは同期している必要があります。どちらのイベントもキャンセルできません。</p>
<p>例：</p>
<p><strong>main.ts</strong></p>
<pre><code class="language-ts">import &quot;./imported.ts&quot;;

const handler = (e: Event): void =&gt; {
  console.log(`got ${e.type} event in event handler (main)`);
};

window.addEventListener(&quot;load&quot;, handler);

window.addEventListener(&quot;unload&quot;, handler);

window.onload = (e: Event): void =&gt; {
  console.log(`got ${e.type} event in onload function (main)`);
};

window.onunload = (e: Event): void =&gt; {
  console.log(`got ${e.type} event in onunload function (main)`);
};

console.log(&quot;log from main script&quot;);
</code></pre>
<p><strong>imported.ts</strong></p>
<pre><code class="language-ts">const handler = (e: Event): void =&gt; {
  console.log(`got ${e.type} event in event handler (imported)`);
};

window.addEventListener(&quot;load&quot;, handler);
window.addEventListener(&quot;unload&quot;, handler);

window.onload = (e: Event): void =&gt; {
  console.log(`got ${e.type} event in onload function (imported)`);
};

window.onunload = (e: Event): void =&gt; {
  console.log(`got ${e.type} event in onunload function (imported)`);
};

console.log(&quot;log from imported script&quot;);
</code></pre>
<p>注意: <code>window.addEventListener</code>と<code>window.onload</code> / <code>window.onunload</code>の両方を使用して、イベントのハンドラーを定義できることに注意してください。それらの間には大きな違いがあります。例を実行してみましょう:</p>
<pre><code class="language-shell">$ deno run main.ts
log from imported script
log from main script
got load event in onload function (main)
got load event in event handler (imported)
got load event in event handler (main)
got unload event in onunload function (main)
got unload event in event handler (imported)
got unload event in event handler (main)
</code></pre>
<p><code>window.addEventListener</code>を使用して追加されたすべてのリスナーが実行されましたが、<code>main.ts</code>で定義された<code>window.onload</code>および<code>window.onunload</code>は、<code>imported.ts</code>で定義されたハンドラーをオーバーライドしました。</p>
<p>つまり、複数の<code>window.addEventListener</code> <code>&quot;load&quot;</code>または <code>&quot;unload&quot;</code>イベントを登録できますが、最後に読み込まれた<code>window.onload</code>または<code>window.onunload</code>イベントのみが実行されます。</p>
<h2><a class="header" href="#コンパイラapi" id="コンパイラapi">コンパイラAPI</a></h2>
<blockquote>
<p>これは不安定なDeno機能です。<a href="runtime/stability.html">不安定な機能の詳細</a>をご覧ください。</p>
</blockquote>
<p>Denoは、組み込みのTypeScriptコンパイラへのランタイムアクセスをサポートしています。 <code>Deno</code>名前空間には、このアクセスを提供する3つのメソッドがあります。</p>
<h3><a class="header" href="#denocompile" id="denocompile"><code>Deno.compile()</code></a></h3>
<p>これは<code>deno cacheと</code>同様に機能し、コードのフェッチ、キャッシュ、コンパイルはできますが、実行はできません。これは、最大3つの引数で、<code>rootName</code>と、オプションで<code>sources</code>、<code>options</code>を取ります。 <code>rootName</code>は、結果のプログラムを生成するために使用されるルートモジュールです。これは、<code>deno run --reload example.ts</code>のコマンドラインで渡すモジュール名に似ています。<code>sources</code>はハッシュであり、キーは完全修飾モジュール名であり、値はモジュールのテキストソースです。<code>sources</code>が渡された場合、Denoはそのハッシュ内からすべてのモジュールを解決し、Denoの外部では解決を試みません。ソースが提供されない場合、Denoは、ルートモジュールがコマンドラインで渡されたかのようにモジュールを解決します。 Denoはこれらのリソースもキャッシュします。解決されたすべてのリソースは動的インポートとして扱われ、ローカルかリモートかに応じて読み取りまたはネット権限が必要です。 <code>options</code>引数は、<code>Deno.CompilerOptions</code>タイプのオプションのセットです。これは、Denoでサポートされているオプションを含むTypeScriptコンパイラオプションのサブセットです。</p>
<p>メソッドはタプルで解決されます。最初の引数には、コードに関連するすべての診断（構文または型エラー）が含まれます。 2番目の引数は、キーが出力ファイル名で値がコンテンツであるマップです。</p>
<p>ソースを提供する例：:</p>
<pre><code class="language-ts">const [diagnostics, emitMap] = await Deno.compile(&quot;/foo.ts&quot;, {
  &quot;/foo.ts&quot;: `import * as bar from &quot;./bar.ts&quot;;\nconsole.log(bar);\n`,
  &quot;/bar.ts&quot;: `export const bar = &quot;bar&quot;;\n`,
});

assert(diagnostics == null); // ensuring no diagnostics are returned
console.log(emitMap);
</code></pre>
<p>mapには、<code>/foo.js.map</code>、<code>/foo.js</code>、<code>/bar.js.map</code>、<code>/bar.js</code>という名前の4つの「ファイル」が含まれていると予想されます。</p>
<p>リソースを提供しない場合は、コマンドラインで行うのと同じように、ローカルモジュールまたはリモートモジュールを使用できます。だからあなたはこのようなことをすることができます：</p>
<pre><code class="language-ts">const [diagnostics, emitMap] = await Deno.compile(
  &quot;https://deno.land/std/examples/welcome.ts&quot;,
);
</code></pre>
<p>この場合、<code>emitMap</code>には<code>console.log()</code>ステートメントが含まれます。</p>
<h3><a class="header" href="#denobundle" id="denobundle"><code>Deno.bundle()</code></a></h3>
<p>これは、コマンドラインで<code>deno bundle</code>が行うのとよく似ています。これも<code>Deno.compile()</code>に似ていますが、ファイルのマップを返す代わりに、提供または解決されたすべてのコードとエクスポートを含む自己完結型のJavaScript ESモジュールである単一の文字列を返します。提供されたルートモジュールのすべてのエクスポートのこれは、最大3つの引数で、<code>rootName</code>、オプションで<code>sources</code>、<code>options</code>を取ります。 <code>rootName</code>は、結果のプログラムを生成するために使用されるルートモジュールです。これは、<code>deno bundle example.ts</code>のコマンドラインで渡すモジュール名に似ています。<code>sources</code>はハッシュであり、キーは完全修飾モジュール名であり、値はモジュールのテキストソースです。<code>sources</code>が渡された場合、Denoはそのハッシュ内からすべてのモジュールを解決し、Denoの外部では解決を試みません。<code>sources</code>が提供されない場合、Denoは、ルートモジュールがコマンドラインで渡されたかのようにモジュールを解決します。解決されたすべてのリソースは動的インポートとして扱われ、ローカルかリモートかに応じて読み取りまたはネット権限が必要です。 Denoはこれらのリソースもキャッシュします。 <code>options</code>引数は、<code>Deno.CompilerOptions</code>タイプのオプションのセットです。これは、Denoでサポートされているオプションを含むTypeScriptコンパイラオプションのサブセットです。</p>
<p>ソースを提供する例:</p>
<pre><code class="language-ts">const [diagnostics, emit] = await Deno.bundle(&quot;/foo.ts&quot;, {
  &quot;/foo.ts&quot;: `import * as bar from &quot;./bar.ts&quot;;\nconsole.log(bar);\n`,
  &quot;/bar.ts&quot;: `export const bar = &quot;bar&quot;;\n`,
});

assert(diagnostics == null); // 确保没有返回诊断信息
console.log(emit);
</code></pre>
<p>両方のモジュールの出力ソースを含む、ESモジュールのテキストが<code>出力</code>されることを期待します。</p>
<p>リソースを提供しない場合は、コマンドラインで行うのと同じように、ローカルモジュールまたはリモートモジュールを使用できます。だからあなたはこのようなことをすることができます:</p>
<pre><code class="language-ts">const [diagnostics, emit] = await Deno.bundle(
  &quot;https://deno.land/std/http/server.ts&quot;,
);
</code></pre>
<p>在这种情况下，<code>emit</code> 将是一个自包含的 JavaScript ES 模块，并解析了所有依赖项，导出与源模块相同的导出。</p>
<h3><a class="header" href="#denotranspileonly" id="denotranspileonly"><code>Deno.transpileOnly()</code></a></h3>
<p>これは、TypeScript関数<code>transpileModule()</code>に基づいています。これが行うことは、モジュールからすべてのタイプを「消去」し、JavaScriptを発行することだけです。型チェックや依存関係の解決はありません。最大2つの引数を受け入れます。最初の引数は、キーがモジュール名で値がコンテンツであるハッシュです。モジュール名の唯一の目的は、ソースファイル名とは何か、ソースマップに情報を入れるときです。 2番目の引数には、<code>Deno.CompilerOptions</code>タイプの<code>options</code>オプションが含まれます。関数はマップで解決されます。キーは指定されたソースモジュール名であり、値は<code>source</code>のプロパティを持つオブジェクトで、オプションで<code>map</code>されます。 1つ目は、モジュールの出力内容です。 <code>map</code>プロパティはソースマップです。ソースマップはデフォルトで提供されますが、<code>options</code>引数を介してオフにすることができます。</p>
<p>例：</p>
<pre><code class="language-ts">const result = await Deno.transpileOnly({
  &quot;/foo.ts&quot;: `enum Foo { Foo, Bar, Baz };\n`,
});

console.log(result[&quot;/foo.ts&quot;].source);
console.log(result[&quot;/foo.ts&quot;].map);
</code></pre>
<p><code>enum</code>は、enumerableを構成するIIFEに書き換えられ、マップが定義されることを期待します。</p>
<h3><a class="header" href="#typescriptライブラリファイルの参照" id="typescriptライブラリファイルの参照">TypeScriptライブラリファイルの参照</a></h3>
<p><code>deno run</code>、またはTypeScriptを型チェックする他のDenoコマンドを使用すると、そのコードは、Denoがサポートする環境を記述するカスタムライブラリに対して評価されます。デフォルトでは、TypeScriptを型チェックするコンパイラランタイムAPIもこれらのライブラリ（<code>Deno.compile()</code>および<code>Deno.bundle()</code>）を使用します。</p>
<p>ただし、他のランタイム用にTypeScriptをコンパイルまたはバンドルする場合は、デフォルトのライブラリをオーバーライドすることができます。これを行うために、ランタイムAPIはコンパイラオプションの<code>lib</code>プロパティをサポートしています。たとえば、ブラウザを宛先とするTypeScriptコードがある場合、TypeScriptの<code>&quot;dom&quot;</code>ライブラリを使用します。:</p>
<pre><code class="language-ts">const [errors, emitted] = await Deno.compile(
  &quot;main.ts&quot;,
  {
    &quot;main.ts&quot;: `document.getElementById(&quot;foo&quot;);\n`,
  },
  {
    lib: [&quot;dom&quot;, &quot;esnext&quot;],
  },
);
</code></pre>
<p>TypeScriptがサポートするすべてのライブラリのリストについては、<a href="https://www.typescriptlang.org/docs/handbook/compiler-options.html"><code>lib</code> コンパイラオプション</a>のドキュメントを参照してください。</p>
<p><strong>JavaScriptライブラリを含めることを忘れないでください</strong></p>
<p>就像 <code>tsc</code> 一样，当您提供一个 <code>lib</code> 编译器选项时，它会覆盖默认的选项，这意味着基本的 JavaScript 库不会被包含，而您应该包含最能代表您的目标运行时的选项（例如 <code>es5</code>，<code>es2015</code>，<code>es2016</code>，<code>es2017</code>，<code>es2018</code>，<code>es2019</code>，<code>es2020</code> 或 <code>esnext</code>）。</p>
<h4><a class="header" href="#deno名前空間を含める" id="deno名前空間を含める">Deno名前空間を含める</a></h4>
<p>TypeScriptによって提供されるライブラリーに加えて、参照可能なDenoに組み込まれている4つのライブラリーがあります:</p>
<ul>
<li><code>deno.ns</code> - <code>Deno</code>の名前空間を提供します</li>
<li><code>deno.shared_globals</code> - Denoが使用するグローバルインターフェイスと変数を提供します</li>
<li><code>deno.window</code> - グローバル変数とDeno名前空間を公開します。</li>
<li><code>deno.worker</code> - Denoの下のワーカーで使用可能なグローバル変数を公開します。</li>
</ul>
<p>したがって、Deno名前空間をコンパイルに追加するには、<code>deno.ns</code> libを配列に含めます。例えば：</p>
<pre><code class="language-ts">const [errors, emitted] = await Deno.compile(
  &quot;main.ts&quot;,
  {
    &quot;main.ts&quot;: `document.getElementById(&quot;foo&quot;);\n`,
  },
  {
    lib: [&quot;dom&quot;, &quot;esnext&quot;, &quot;deno.ns&quot;],
  },
);
</code></pre>
<p><strong>注意</strong> Deno名前空間は、少なくともES2018以降のランタイム環境を想定していること。つまり、ES2018より「低い」libを使用すると、コンパイルの一部としてエラーがログに記録されます。</p>
<h4><a class="header" href="#トリプルスラッシュリファレンスの使用" id="トリプルスラッシュリファレンスの使用">トリプルスラッシュリファレンスの使用</a></h4>
<p>コンパイラオプションで<code>lib</code>を指定する必要はありません。 Denoは、<a href="https://www.typescriptlang.org/docs/handbook/triple-slash-directives.html#-reference-lib-">libへのトリプルスラッシュ参照</a>もサポートしています。ファイルのコンテンツに埋め込むことができます。たとえば、次のような<code>main.ts</code>があるとします。</p>
<pre><code class="language-ts">/// &lt;reference lib=&quot;dom&quot; /&gt;

document.getElementById(&quot;foo&quot;);
</code></pre>
<p>次のようなエラーなしでコンパイルされます:</p>
<pre><code class="language-ts">const [errors, emitted] = await Deno.compile(&quot;./main.ts&quot;, undefined, {
  lib: [&quot;esnext&quot;],
});
</code></pre>
<p><strong>注意</strong>，<code>dom</code>ライブラリは、Denoのデフォルトタイプライブラリで定義されているデフォルトグローバルの一部と競合することに注意してください。これを回避するには、ランタイムコンパイラAPIのコンパイラオプションで<code>lib</code>オプションを指定する必要があります。</p>
<h2><a class="header" href="#worker" id="worker">Worker</a></h2>
<p>Deno 支持 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Worker/Worker">Web Worker API</a>.</p>
<p>Worker 能够用来在多个线程中运行代码，<code>Worker</code> 的每个实例都会在一个单独的线程中运行，这个线程专属于它。</p>
<p>目前，Deno 只支持 <code>module</code> 类型的 worker，因此在创建新的 worker 时必须传递 <code>type: &quot;module&quot;</code> 选项。</p>
<p>目前，相对模块说明符 (Relative module specifiers) <a href="https://github.com/denoland/deno/issues/5216">尚不支持</a>。作为代替，您可以用 <code>URL</code> 构造函数和 <code>import.meta.url</code> 来为附近的脚本创建说明符。</p>
<pre><code class="language-ts">// Good
new Worker(new URL(&quot;worker.js&quot;, import.meta.url).href, { type: &quot;module&quot; });

// Bad
new Worker(new URL(&quot;worker.js&quot;, import.meta.url).href);
new Worker(new URL(&quot;worker.js&quot;, import.meta.url).href, { type: &quot;classic&quot; });
new Worker(&quot;./worker.js&quot;, { type: &quot;module&quot; });
</code></pre>
<h3><a class="header" href="#权限" id="权限">权限</a></h3>
<p>创建一个新的 <code>Worker</code> 实例的行为与动态导入类似，因此 Deno 需要适当的权限来做这个操作。</p>
<p>对于使用本地模块的 worker，Deno 需要读取 (<code>--allow-read</code>) 权限：</p>
<p><strong>main.ts</strong></p>
<pre><code class="language-ts">new Worker(new URL(&quot;worker.ts&quot;, import.meta.url).href, { type: &quot;module&quot; });
</code></pre>
<p><strong>worker.ts</strong></p>
<pre><code class="language-ts">console.log(&quot;hello world&quot;);
self.close();
</code></pre>
<pre><code class="language-shell">$ deno run main.ts
error: Uncaught PermissionDenied: read access to &quot;./worker.ts&quot;, run again with the --allow-read flag

$ deno run --allow-read main.ts
hello world
</code></pre>
<p>对于使用远程模块的 worker，Deno 需要网络 (<code>--allow-net</code>) 权限：</p>
<p><strong>main.ts</strong></p>
<pre><code class="language-ts">new Worker(&quot;https://example.com/worker.ts&quot;, { type: &quot;module&quot; });
</code></pre>
<p><strong>worker.ts</strong></p>
<pre><code class="language-ts">console.log(&quot;hello world&quot;);
self.close();
</code></pre>
<pre><code class="language-shell">$ deno run main.ts
error: Uncaught PermissionDenied: net access to &quot;https://example.com/worker.ts&quot;, run again with the --allow-net flag

$ deno run --allow-net main.ts
hello world
</code></pre>
<h3><a class="header" href="#在-worker-中使用-deno" id="在-worker-中使用-deno">在 Worker 中使用 Deno</a></h3>
<blockquote>
<p>这是一个不稳定的 Deno 特性。
更多信息请查阅 <a href="runtime/stability.html">稳定性</a></p>
</blockquote>
<p>默认情况下，<code>Deno</code> 命名空间在 worker 作用域中不可用。</p>
<p>要想启用 <code>Deno</code> 命名空间，在创建新的 worker 时传递 <code>deno: true</code> 选项：</p>
<p><strong>main.js</strong></p>
<pre><code class="language-ts">const worker = new Worker(new URL(&quot;worker.js&quot;, import.meta.url).href, {
  type: &quot;module&quot;,
  deno: true,
});
worker.postMessage({ filename: &quot;./log.txt&quot; });
</code></pre>
<p><strong>worker.js</strong></p>
<pre><code class="language-ts">self.onmessage = async (e) =&gt; {
  const { filename } = e.data;
  const text = await Deno.readTextFile(filename);
  console.log(text);
  self.close();
};
</code></pre>
<p><strong>log.txt</strong></p>
<pre><code>hello world
</code></pre>
<pre><code class="language-shell">$ deno run --allow-read --unstable main.js
hello world
</code></pre>
<p>当 <code>Deno</code> 命名空间在 worker 作用域中启用时，此 worker 继承创建者的权限（使用类似 <code>--allow-*</code> 的选项指定的权限）。</p>
<p>我们计划提供 worker 权限的配置方法。</p>
<h1><a class="header" href="#サードパーティのコードへのリンク" id="サードパーティのコードへのリンク">サードパーティのコードへのリンク</a></h1>
<p>「<a href="(./getting_started.html">入門</a>」のセクションでは、DenoがURLからスクリプトを実行できることを確認しました。ブラウザのJavaScriptと同様に、DenoはURLから直接ライブラリをインポートできます。この例では、URLを使用してアサーションライブラリをインポートします。</p>
<p><strong>test.ts</strong></p>
<pre><code class="language-ts">import { assertEquals } from &quot;https://deno.land/std/testing/asserts.ts&quot;;

assertEquals(&quot;hello&quot;, &quot;hello&quot;);
assertEquals(&quot;world&quot;, &quot;world&quot;);

console.log(&quot;Asserted! ✓&quot;);
</code></pre>
<p>これを実行してみてください：</p>
<pre><code class="language-shell">$ deno run test.ts
Compile file:///mnt/f9/Projects/github.com/denoland/deno/docs/test.ts
Download https://deno.land/std/testing/asserts.ts
Download https://deno.land/std/fmt/colors.ts
Download https://deno.land/std/testing/diff.ts
Asserted! ✓
</code></pre>
<p>このプログラムに<code>--allow-net</code>フラグを提供する必要はなかったが、ネットワークにアクセスしたことに注意してください。ランタイムには、インポートをダウンロードしてディスクにキャッシュするための特別なアクセス権があります。</p>
<p>Denoは、<code>DENO_DIR</code>の環境変数で指定された特別なディレクトリにリモートインポートをキャッシュします。DENO_DIR が指定されていない場合、システムのキャッシュディレクトリがデフォルトになります。次にプログラムを実行するときには、ダウンロードは行われません。プログラムが変更されていなければ、再コンパイルもされません。デフォルトのディレクトリは次のとおりです。</p>
<ul>
<li>Linux/Redox: <code>$XDG_CACHE_HOME/deno</code> or <code>$HOME/.cache/deno</code></li>
<li>Windows: <code>%LOCALAPPDATA%/deno</code> (<code>%LOCALAPPDATA%</code> = <code>FOLDERID_LocalAppData</code>)</li>
<li>macOS: <code>$HOME/Library/Caches/deno</code></li>
<li>何かが失敗した場合、<code>$HOME/.deno</code>にフォールバックします。</li>
</ul>
<h2><a class="header" href="#faq" id="faq">FAQ</a></h2>
<h3><a class="header" href="#モジュールの特定のバージョンをインポートするにはどうすればよいですか" id="モジュールの特定のバージョンをインポートするにはどうすればよいですか">モジュールの特定のバージョンをインポートするにはどうすればよいですか？</a></h3>
<p>URLでバージョンを指定します。たとえば、次のように実行中のコードで完全URLで指定します。 <code>https://unpkg.com/liltest@0.0.5/dist/liltest.js</code>。</p>
<h3><a class="header" href="#どこにでもurlをインポートするのは扱いにくいようです" id="どこにでもurlをインポートするのは扱いにくいようです">どこにでもURLをインポートするのは扱いにくいようです。</a></h3>
<blockquote>
<p>URLの1つが微妙に異なるバージョンのライブラリにリンクしている場合はどうなりますか？<br />
大規模なプロジェクトのどこにでもURLを保持するのは間違いやすいのではないでしょうか？</p>
</blockquote>
<p>解決策は、外部のライブラリを<code>deps.ts</code>ファイル（Nodeの<code>package.json</code>ファイルと同じ目的で機能する）にインポートおよび再エクスポートすることです。たとえば、大規模なプロジェクト全体で上記のアサーションライブラリを使用していたとしましょう。 <code>&quot;https://deno.land/std@0.64.0/testing/asserts.ts&quot;</code>をどこにでもインポートするのではなく、サードパーティのコードをエクスポートする<code>deps.ts</code>ファイルを作成できます。</p>
<p><strong>deps.ts</strong></p>
<pre><code class="language-ts">export {
  assert,
  assertEquals,
  assertStrContains,
} from &quot;https://deno.land/std/testing/asserts.ts&quot;;
</code></pre>
<p>また、同じプロジェクト全体で、<code>deps.ts</code>からインポートして、同じURLへの多くの参照を避けることができます。</p>
<pre><code class="language-ts">import { assertEquals, runTests, test } from &quot;./deps.ts&quot;;
</code></pre>
<p>この設計により、パッケージ管理ソフトウェア、一元化されたコードリポジトリ、および余分なファイル形式によって生成される大量の複雑さが回避されます。</p>
<h3><a class="header" href="#変更される可能性のあるurlを信頼するにはどうすればよいですか" id="変更される可能性のあるurlを信頼するにはどうすればよいですか">変更される可能性のあるURLを信頼するにはどうすればよいですか？</a></h3>
<p>ロックファイル（<code>--lock</code>コマンドラインフラグを指定）を使用することで、URLから取得したコードが初期開発時のものと同じであることを確認できます。これについて詳しくは、<a href="./linking_to_external_code/integrity_checking.html">こちら</a>をご覧ください。</p>
<h3><a class="header" href="#しかしurlのホストがダウンした場合はどうなりますかソースは利用できません" id="しかしurlのホストがダウンした場合はどうなりますかソースは利用できません">しかし、URLのホストがダウンした場合はどうなりますか？ソースは利用できません。</a></h3>
<p>これは、上記と同様に、リモートの依存関係システムが直面する問題です。外部サーバーに依存することは、開発には便利ですが、本番環境では脆弱です。本番ソフトウェアは、常にその依存関係を提供する必要があります。 Nodeでは、これは<code>node_modules</code>をソース管理にチェックインすることで行われます。<br />
Denoでは、実行時に<code>$DENO_DIR</code>をプロジェクトローカルディレクトリにポイントし、同様にそれをソース管理にチェックインすることでこれを行います。</p>
<pre><code class="language-shell"># Download the dependencies.
DENO_DIR=./deno_dir deno cache src/deps.ts

# Make sure the variable is set for any command which invokes the cache.
DENO_DIR=./deno_dir deno test src

# Check the directory into source control.
git add -u deno_dir
git commit
</code></pre>
<h2><a class="header" href="#モジュールの再読み込み" id="モジュールの再読み込み">モジュールの再読み込み</a></h2>
<p>デフォルトでは、キャッシュ内のモジュールは、フェッチまたは再コンパイルせずに再利用されます。これは望ましくない場合があり、denoにモジュールを再フェッチしてキャッシュに再コンパイルさせることができます。 <code>deno cache</code>サブコマンドの<code>--reload</code>フラグを使用して、ローカルの<code>DENO_DIR</code>キャッシュを無効にすることができます。</p>
<p>使い方は以下の通りです:</p>
<h3><a class="header" href="#すべてをリロードする" id="すべてをリロードする">すべてをリロードする</a></h3>
<pre><code class="language-ts">deno cache --reload my_module.ts
</code></pre>
<h3><a class="header" href="#特定のモジュールをリロードする" id="特定のモジュールをリロードする">特定のモジュールをリロードする</a></h3>
<p>一部のモジュールのみをアップグレードしたい場合があります。 <code>--reload</code>フラグに引数を渡すことで制御できます。</p>
<p>全ての 0.64.0 標準モジュールをリロードする：</p>
<pre><code class="language-ts">deno cache --reload=https://deno.land/std@v0.64.0 my_module.ts
</code></pre>
<p>特定のモジュール（この例では、色とファイルシステムのコピー）を再ロードするには、コンマを使用してURLを区切ります：</p>
<pre><code class="language-ts">deno cache --reload=https://deno.land/std@0.64.0/fs/copy.ts,https://deno.land/std@0.64.0/fmt/colors.ts my_module.ts
</code></pre>
<!-- Should this be part of examples? -->
<h2><a class="header" href="#整合性チェックとファイルのロック" id="整合性チェックとファイルのロック">整合性チェックとファイルのロック</a></h2>
<h3><a class="header" href="#イントロダクション" id="イントロダクション">イントロダクション</a></h3>
<p>あなたのモジュールがリモートモジュール<code>https：//some.url/a.ts</code>に依存しているとしましょう。モジュールを初めてコンパイルするとき、<code>a.ts</code>が取得、コンパイル、およびキャッシュされます。これは、新しいマシンでモジュールを実行する（たとえば、本番環境で）か、キャッシュを再ロードする（たとえば、<code>deno cache --reload</code>を使用）まで、この方法のままです。しかし、リモートURL <code>https：//some.url/a.ts</code>のコンテンツが変更された場合はどうなりますか？これにより、ローカルモジュールとは異なる依存関係コードで運用モジュールが実行される可能性があります。これを回避するためのDenoのソリューションは、整合性チェックとロックファイルを使用することです。</p>
<h3><a class="header" href="#ファイルのキャッシュとロック" id="ファイルのキャッシュとロック">ファイルのキャッシュとロック</a></h3>
<p>Denoは、小さなJSONファイルを使用して、モジュールのサブリソースの整合性を保存およびチェックできます。</p>
<p><code>--lock=lock.json</code>を使用して、ロックファイルのチェックを有効にして指定します。ロックを更新または作成するには、<code>--lock=lock.json --lock-write</code>を使用します。<code>--lock=lock.json</code>はDenoに使用するロックファイルを教えますが、<code>--lock-write</code>は依存関係ハッシュをロックファイルに出力するために使用されます（<code>--lock-write</code>は<code>--lock</code>と組み合わせて使用​​する必要があります） ）。 </p>
<p><code>lock.json</code>は次のようになり、依存関係に対するファイルのハッシュを保存します。</p>
<pre><code class="language-json">{
  &quot;https://deno.land/std@v0.64.0/textproto/mod.ts&quot;: &quot;3118d7a42c03c242c5a49c2ad91c8396110e14acca1324e7aaefd31a999b71a4&quot;,
  &quot;https://deno.land/std@v0.64.0/io/util.ts&quot;: &quot;ae133d310a0fdcf298cea7bc09a599c49acb616d34e148e263bcb02976f80dee&quot;,
  &quot;https://deno.land/std@v0.64.0/async/delay.ts&quot;: &quot;35957d585a6e3dd87706858fb1d6b551cb278271b03f52c5a2cb70e65e00c26a&quot;,
   ...
}
</code></pre>
<p>一般的なワークフローは次のようになります。：</p>
<p><strong>src/deps.ts</strong></p>
<pre><code class="language-ts">// Add a new dependency to &quot;src/deps.ts&quot;, used somewhere else.
export { xyz } from &quot;https://unpkg.com/xyz-lib@v0.9.0/lib.ts&quot;;
</code></pre>
<p>それから:</p>
<pre><code class="language-shell"># # Create/update the lock file &quot;lock.json&quot;.
deno cache --lock=lock.json --lock-write src/deps.ts

# Include it when committing to source control.
git add -u lock.json
git commit -m &quot;feat: Add support for xyz using xyz-lib&quot;
git push
</code></pre>
<p>別のマシンのコラボレーター-新しくクローンされたプロジェクトツリー内：</p>
<pre><code class="language-shell"># Download the project's dependencies into the machine's cache, integrity
# checking each resource.
deno cache -reload --lock=lock.json src/deps.ts

# Done! You can proceed safely.
deno test --allow-read src
</code></pre>
<h3><a class="header" href="#ランタイム検証" id="ランタイム検証">ランタイム検証</a></h3>
<p>上記のキャッシュと同様に、<code>deno run</code>サブコマンドの使用中に<code>--lock=lock.json</code>オプションを使用して、実行中にロックされたモジュールの整合性を検証することもできます。これは、以前に<code>lock.json</code>ファイルに追加された依存関係に対してのみ検証されることに注意してください。新しい依存関係はキャッシュされますが検証されません。</p>
<p><code>--cached-only</code>フラグを使用してリモート依存関係がすでにキャッシュされていることを要求することで、これをさらに一歩進めることができます。</p>
<pre><code class="language-shell">deno run --lock=lock.json --cached-only mod.ts
</code></pre>
<p>まだキャッシュされていないmod.tsの依存関係ツリーに依存関係がある場合、これは失敗します。</p>
<!-- TODO - Add detail on dynamic imports -->
<h2><a class="header" href="#代理proxies" id="代理proxies">代理（Proxies）</a></h2>
<p>Deno 支持模块下载和 Web 标准 <code>fetch</code> API 的代理。</p>
<p>代理配置从环境变量中读取: <code>HTTP_PROXY</code> 和 <code>HTTPS_PROXY</code>。</p>
<p>在 Windows 的环境下，如果没有发现环境变量，Deno 会从注册表中读取代理。</p>
<h2><a class="header" href="#导入映射import-maps" id="导入映射import-maps">导入映射（Import maps）</a></h2>
<blockquote>
<p>这是一个不稳定的特性。
更多信息请查阅 <a href="linking_to_external_code/../runtime/stability.html">稳定性</a></p>
</blockquote>
<p>Deno 支持 <a href="https://github.com/WICG/import-maps">导入映射</a>。</p>
<p>您可以通过 <code>--importmap=&lt;FILE&gt;</code> 的命令行选项使用导入映射。</p>
<p>目前的限制:</p>
<ul>
<li>只支持单个导入映射</li>
<li>没有 fallback URL</li>
<li>Deno 不支持 <code>std:</code> 命名空间</li>
<li>仅支持 <code>file:</code>，<code>http:</code> 和 <code>https:</code> 协议</li>
</ul>
<p>示例：</p>
<p><strong>import_map.json</strong></p>
<pre><code class="language-js">{
   &quot;imports&quot;: {
      &quot;fmt/&quot;: &quot;https://deno.land/std@0.64.0/fmt/&quot;
   }
}
</code></pre>
<p><strong>color.ts</strong></p>
<pre><code class="language-ts">import { red } from &quot;fmt/colors.ts&quot;;

console.log(red(&quot;hello world&quot;));
</code></pre>
<p>运行：</p>
<pre><code class="language-shell">$ deno run --importmap=import_map.json --unstable color.ts
</code></pre>
<p>为绝对导入使用起始目录：</p>
<pre><code class="language-json">// import_map.json

{
  &quot;imports&quot;: {
    &quot;/&quot;: &quot;./&quot;
  }
}
</code></pre>
<pre><code class="language-ts">// main.ts

import { MyUtil } from &quot;/util.ts&quot;;
</code></pre>
<p>您可以映射一个不同的目录（比如 src）：</p>
<pre><code class="language-json">// import_map.json

{
  &quot;imports&quot;: {
    &quot;/&quot;: &quot;./src&quot;
  }
}
</code></pre>
<h1><a class="header" href="#標準ライブラリ" id="標準ライブラリ">標準ライブラリ</a></h1>
<p>Denoは、コアチームによって監査され、Denoでの動作が保証されている一連の標準モジュールを提供します。</p>
<p>標準ライブラリは<a href="https://deno.land/std/">https://deno.land/std/</a>で入手できます。</p>
<h2><a class="header" href="#バージョン管理と安定性" id="バージョン管理と安定性">バージョン管理と安定性</a></h2>
<p>標準ライブラリはまだ安定していないため、Denoとはバージョンが異なります。最新のリリースについては、<a href="https://deno.land/std/">https://deno.land/std/</a>または<a href="https://deno.land/std/version.ts">https://deno.land/std/version.ts</a>。を参照してください。標準ライブラリは、Denoがリリースされるたびにリリースされます。</p>
<p>意図しない変更を避けるために、常に標準ライブラリの固定バージョンでインポートを使用することを強くお勧めします。たとえば、いつでも変更される可能性があるコードのマスターブランチにリンクするのではなく、コンパイルエラーや予期しない動作を引き起こす可能性があります。</p>
<pre><code class="language-typescript">// imports from master, this should be avoided
import { copy } from &quot;https://deno.land/std/fs/copy.ts&quot;;
</code></pre>
<p>代わりに、バージョンを指定してstdライブラリを使用すればイミュータブルです：</p>
<pre><code class="language-typescript">// imports from v0.64.0 of std, never changes
import { copy } from &quot;https://deno.land/std@0.64.0/fs/copy.ts&quot;;
</code></pre>
<h2><a class="header" href="#トラブルシューティング" id="トラブルシューティング">トラブルシューティング</a></h2>
<p>標準ライブラリで提供されているモジュールの一部は、不安定なDeno APIを使用しています。 </p>
<p>このようなモジュールを<code>--unstable</code> CLIフラグなしで実行しようとすると、<code>Deno</code>名前空間にいくつかのAPIが存在しないことを示唆する多くのTypeScriptエラーが発生します。</p>
<pre><code class="language-typescript">// main.ts
import { copy } from &quot;https://deno.land/std@0.64.0/fs/copy.ts&quot;;

copy(&quot;log.txt&quot;, &quot;log-old.txt&quot;);
</code></pre>
<pre><code class="language-shell">$ deno run --allow-read --allow-write main.ts
Compile file:///dev/deno/main.ts
Download https://deno.land/std@0.64.0/fs/copy.ts
Download https://deno.land/std@0.64.0/fs/ensure_dir.ts
Download https://deno.land/std@0.64.0/fs/_util.ts
error: TS2339 [ERROR]: Property 'utime' does not exist on type 'typeof Deno'.
    await Deno.utime(dest, statInfo.atime, statInfo.mtime);
               ~~~~~
    at https://deno.land/std@0.64.0/fs/copy.ts:90:16

TS2339 [ERROR]: Property 'utimeSync' does not exist on type 'typeof Deno'.
    Deno.utimeSync(dest, statInfo.atime, statInfo.mtime);
         ~~~~~~~~~
    at https://deno.land/std@0.64.0/fs/copy.ts:101:10
</code></pre>
<p>解决方法是加上 <code>--unstable</code> 选项：</p>
<pre><code class="language-shell">deno run --allow-read --allow-write --unstable main.ts
</code></pre>
<p>API生成エラーが不安定であることを確認するには、
<a href="https://github.com/denoland/deno/blob/master/cli/dts/lib.deno.unstable.d.ts">lib.deno.unstable.d.ts</a>
を確認してください。</p>
<p>この問題は近い将来に修正される予定です。依存する特定のモジュールがフラグなしで正常にコンパイルされる場合は、フラグを省略してもかまいません。</p>
<h1><a class="header" href="#テスト" id="テスト">テスト</a></h1>
<p>Denoには、JavaScriptまたはTypeScriptコードのテストに使用できる組み込みのテストランナーがあります。</p>
<h2><a class="header" href="#テストを書く" id="テストを書く">テストを書く</a></h2>
<p>テストを定義するには、テストする名前と関数を指定して<code>Deno.test</code>を呼び出す必要があります。</p>
<p>使用できるスタイルは2つあります：</p>
<pre><code class="language-ts">// Simple name and function, compact form, but not configurable
Deno.test(&quot;hello world #1&quot;, () =&gt; {
  const x = 1 + 2;
  assertEquals(x, 3);
});

// Fully fledged test definition, longer form, but configurable (see below)
Deno.test({
  name: &quot;hello world #2&quot;,
  fn: () =&gt; {
    const x = 1 + 2;
    assertEquals(x, 3);
  },
});
</code></pre>
<h2><a class="header" href="#アサーション" id="アサーション">アサーション</a></h2>
<p>テストを容易にするために、<a href="https://deno.land/std@0.64.0/testing#usage">https：//deno.land/std@0.64.0/testing#usage</a>に有用なアサーションユーティリティがいくつかあります。</p>
<pre><code class="language-ts">import {
  assertEquals,
  assertArrayContains,
} from &quot;https://deno.land/std/testing/asserts.ts&quot;;

Deno.test(&quot;hello world&quot;, () =&gt; {
  const x = 1 + 2;
  assertEquals(x, 3);
  assertArrayContains([1, 2, 3, 4, 5, 6], [3], &quot;Expected 3 to be in the array&quot;);
});
</code></pre>
<h3><a class="header" href="#非同期ファンクション" id="非同期ファンクション">非同期ファンクション</a></h3>
<p>promiseを返すテスト関数を渡すことで、非同期コードをテストすることもできます。このため、関数を定義するときに<code>async</code>キーワードを使用できます:</p>
<pre><code class="language-ts">import { delay } from &quot;https://deno.land/std/async/delay.ts&quot;;

Deno.test(&quot;async hello world&quot;, async () =&gt; {
  const x = 1 + 2;

  // await some async task
  await delay(100);

  if (x !== 3) {
    throw Error(&quot;x should be equal to 3&quot;);
  }
});
</code></pre>
<h3><a class="header" href="#リソースおよび非同期opサニタイザー" id="リソースおよび非同期opサニタイザー">リソースおよび非同期opサニタイザー</a></h3>
<p>Denoの特定のアクションは、リソーステーブルにリソースを作成します（<a href="(./contributing/architecture.html">詳細はこちら</a>）。これらのリソースは、使い終わったら閉じてください。</p>
<p>各テスト定義について、テストランナーはこのテストで作成されたすべてのリソースが閉じられていることを確認します。これは、リソースの「リーク」を防ぐためです。これはすべてのテストでデフォルトで有効になっていますが、テスト定義で<code>sanitizeResources</code>のboolean値をfalseに設定することで無効にできます。</p>
<p>ファイルシステムとの対話などの非同期操作についても同様です。テストランナーは、テストで開始する各操作がテストの終了前に完了することを確認します。これはすべてのテストでデフォルトで有効になっていますが、テスト定義でsanitizeOpsのboolean値をfalseに設定することで無効にできます。</p>
<pre><code class="language-ts">Deno.test({
  name: &quot;leaky test&quot;,
  fn() {
    Deno.open(&quot;hello.txt&quot;);
  },
  sanitizeResources: false,
  sanitizeOps: false,
});
</code></pre>
<h2><a class="header" href="#テストの実行" id="テストの実行">テストの実行</a></h2>
<p>テストを実行するには、テスト関数を含むファイルを使用して<code>deno test</code>を呼び出します。また、ファイル名を省略することもできます。その場合、現在のディレクトリ内でglobが<code>{*_,*.,}test.{js,mjs,ts,jsx,tsx}</code>に一致するすべてのテストが（再帰的に）実行されます。ディレクトリを渡すと、このグロブに一致するディレクトリ内のすべてのファイルが実行されます。</p>
<pre><code class="language-shell"># Run all tests in the current directly and all sub-directories
deno test

# Run all tests in the util directory
deno test util/

# Run just my_test.ts
deno test my_test.ts
</code></pre>
<p><code>deno test</code>は<code>deno run</code>と同じアクセス許可モデルを使用するため、たとえば、テスト中に<code>--allow-write</code>を実行してファイルシステムに書き込む必要があります。</p>
<p><code>deno test</code>のすべてのランタイムオプションを表示するには、コマンドラインのhelpで参照できます。</p>
<pre><code class="language-shell">deno help test
</code></pre>
<h2><a class="header" href="#フィルタリング" id="フィルタリング">フィルタリング</a></h2>
<p>実行中のテストをフィルタリングするためのオプションがいくつかあります。</p>
<h3><a class="header" href="#コマンドラインでフィルタリングする" id="コマンドラインでフィルタリングする">コマンドラインでフィルタリングする</a></h3>
<p>テストは、コマンドラインの<code>--filter</code>オプションを使用して、個別にまたはグループで実行できます。</p>
<p>フィルターフラグは、文字列またはパターンを値として受け入れます。</p>
<p>次のテストを想定しています。</p>
<pre><code class="language-ts">Deno.test({ name: &quot;my-test&quot;, fn: myTest });
Deno.test({ name: &quot;test-1&quot;, fn: test1 });
Deno.test({ name: &quot;test2&quot;, fn: test2 });
</code></pre>
<p>これらのテストにはすべて「test」という単語が含まれているため、このコマンドはこれらのテストをすべて実行します。</p>
<pre><code class="language-shell">deno test --filter &quot;test&quot; tests/
</code></pre>
<p>反対に、次のコマンドはパターンを使用して、2番目と3番目のテストを実行します：</p>
<pre><code class="language-shell">deno test --filter &quot;/test-*\d/&quot; tests/
</code></pre>
<p><em>パターンを使用することをDenoに通知するには、REGEXのJavaScript構文シュガーのように、フィルターをスラッシュで囲みます。</em></p>
<h3><a class="header" href="#テスト定義のフィルタリング" id="テスト定義のフィルタリング">テスト定義のフィルタリング</a></h3>
<p>テスト自体には、フィルタリングのための2つのオプションがあります。</p>
<h4><a class="header" href="#フィルタリング特定のテストは無視" id="フィルタリング特定のテストは無視">フィルタリング（特定のテストは無視）</a></h4>
<p>ある種の条件に基づくテストを無視したい場合があります（たとえば、Windowsでのみテストを実行したい場合など）。このために、テスト定義で<code>ignore</code>のboolean値を使用できます。 trueに設定されている場合、テストはスキップされます。</p>
<pre><code class="language-ts">Deno.test({
  name: &quot;do macOS feature&quot;,
  ignore: Deno.build.os !== &quot;darwin&quot;,
  fn() {
    doMacOSFeature();
  },
});
</code></pre>
<h4><a class="header" href="#フィルタリング特定のテストのみを実行" id="フィルタリング特定のテストのみを実行">フィルタリング（特定のテストのみを実行）</a></h4>
<p>大きなテストクラス内で問題の真っ只中にいる可能性があり、そのテストのみに焦点を当て、残りは今は無視したい場合があります。このため、<code>only</code>のオプションを使用して、テストフレームワークに、trueに設定されたテストのみを実行するように指示できます。複数のテストでこのオプションを設定できます。テストの実行では各テストの成功または失敗が報告されますが、テストで<code>only</code>フラグが立てられている場合は、テスト全体が常に失敗します。これは、ほとんどすべてのテストを無効にする一時的な対策に過ぎないためです。</p>
<pre><code class="language-ts">Deno.test({
  name: &quot;Focus on this test only&quot;,
  only: true,
  fn() {
    testComplicatedStuff();
  },
});
</code></pre>
<h2><a class="header" href="#失敗を早める" id="失敗を早める">失敗を早める</a></h2>
<p>長時間実行するテストスイートがあり、最初の失敗時にテストスイートを停止したい場合は、スイートの実行時に<code>--failfast</code>フラグを指定できます。</p>
<pre><code class="language-shell">deno test --failfast
</code></pre>
<h2><a class="header" href="#アサーション-1" id="アサーション-1">アサーション</a></h2>
<p>開発者がテストを記述できるように、Deno標準ライブラリには、
<code>https：//deno.land/std@0.64.0/testing/asserts.ts</code>からインポートできる組み込みの<a href="https://deno.land/std/testing/asserts.ts">アサーションモジュール</a>が付属しています。</p>
<pre><code class="language-js">import { assert } from &quot;https://deno.land/std@0.64.0/testing/asserts.ts&quot;;

Deno.test(&quot;Hello Test&quot;, () =&gt; {
  assert(&quot;Hello&quot;);
});
</code></pre>
<p>アサーションモジュールは、9つのアサーションを提供します：</p>
<ul>
<li><code>assert(expr: unknown, msg = &quot;&quot;): asserts expr</code></li>
<li><code>assertEquals(actual: unknown, expected: unknown, msg?: string): void</code></li>
<li><code>assertNotEquals(actual: unknown, expected: unknown, msg?: string): void</code></li>
<li><code>assertStrictEquals(actual: unknown, expected: unknown, msg?: string): void</code></li>
<li><code>assertStringContains(actual: string, expected: string, msg?: string): void</code></li>
<li><code>assertArrayContains(actual: unknown[], expected: unknown[], msg?: string): void</code></li>
<li><code>assertMatch(actual: string, expected: RegExp, msg?: string): void</code></li>
<li><code>assertThrows(fn: () =&gt; void, ErrorClass?: Constructor, msgIncludes = &quot;&quot;, msg?: string): Error</code></li>
<li><code>assertThrowsAsync(fn: () =&gt; Promise&lt;void&gt;, ErrorClass?: Constructor, msgIncludes = &quot;&quot;, msg?: string): Promise&lt;Error&gt;</code></li>
</ul>
<h3><a class="header" href="#アサート" id="アサート">アサート</a></h3>
<p><code>assert</code>メソッドは単純な「真の」アサーションであり、<code>true</code>と推定できる任意の値をアサートするために使用できます。</p>
<pre><code class="language-js">Deno.test(&quot;Test Assert&quot;, () =&gt; {
  assert(1);
  assert(&quot;Hello&quot;);
  assert(true);
});
</code></pre>
<h3><a class="header" href="#同等性" id="同等性">同等性</a></h3>
<p>利用可能な等価アサーションには、<code>assertEquals()</code>、<code>assertNotEquals()</code> 、 <code>assertStrictEquals()</code>の3つがあります</p>
<p><code>assertEquals()</code> と <code>assertNotEquals()</code> のメソッドは、一般的な等価チェックを提供し、プリミティブ型とオブジェクト間の等価をアサートすることができます。</p>
<pre><code class="language-js">Deno.test(&quot;Test Assert Equals&quot;, () =&gt; {
  assertEquals(1, 1);
  assertEquals(&quot;Hello&quot;, &quot;Hello&quot;);
  assertEquals(true, true);
  assertEquals(undefined, undefined);
  assertEquals(null, null);
  assertEquals(new Date(), new Date());
  assertEquals(new RegExp(&quot;abc&quot;), new RegExp(&quot;abc&quot;));

  class Foo {}
  const foo1 = new Foo();
  const foo2 = new Foo();

  assertEquals(foo1, foo2);
});

Deno.test(&quot;Test Assert Not Equals&quot;, () =&gt; {
  assertNotEquals(1, 2);
  assertNotEquals(&quot;Hello&quot;, &quot;World&quot;);
  assertNotEquals(true, false);
  assertNotEquals(undefined, &quot;&quot;);
  assertNotEquals(new Date(), Date.now());
  assertNotEquals(new RegExp(&quot;abc&quot;), new RegExp(&quot;def&quot;));
});
</code></pre>
<p>対照的に、<code>assertStrictEquals()</code>は、<code>===</code>演算子に基づいて、より単純で厳密な等価チェックを提供します。結果として、同一オブジェクトの2つのインスタンスは参照上同じではないため、アサートされません。</p>
<pre><code class="language-js">Deno.test(&quot;Test Assert Strict Equals&quot;, () =&gt; {
  assertStrictEquals(1, 1);
  assertStrictEquals(&quot;Hello&quot;, &quot;Hello&quot;);
  assertStrictEquals(true, true);
  assertStrictEquals(undefined, undefined);
});
</code></pre>
<p><code>assertStrictEquals()</code> 最好用于精确判断两个基本类型的相等性。</p>
<h3><a class="header" href="#包含" id="包含">包含</a></h3>
<p>値が値を含むことをアサートするために使用できるメソッドは、<code>assertStringContains()</code>と<code>assertArrayContains()</code>の2つです。 <code>assertStringContains()</code>アサーションは、期待される文字列が含まれているかどうかを確認するために、文字列に対して単純なインクルードチェックを実行します。</p>
<p><code>assertStringContains()</code>アサーションは、期待される文字列が含まれているかどうかを確認するために、文字列に対して単純なインクルードチェックを実行します。</p>
<pre><code class="language-js">Deno.test(&quot;Test Assert String Contains&quot;, () =&gt; {
  assertStringContains(&quot;Hello World&quot;, &quot;Hello&quot;);
});
</code></pre>
<p><code>assertArrayContains()</code>アサーションは少し高度で、配列内の値と配列内の値の配列の両方を見つけることができます。</p>
<pre><code class="language-js">Deno.test(&quot;Test Assert Array Contains&quot;, () =&gt; {
  assertArrayContains([1, 2, 3], [1]);
  assertArrayContains([1, 2, 3], [1, 2]);
  assertArrayContains(Array.from(&quot;Hello World&quot;), Array.from(&quot;Hello&quot;));
});
</code></pre>
<h3><a class="header" href="#regex" id="regex">Regex</a></h3>
<p><code>assertMatch()</code> を介して正規表現をアサートできます。</p>
<pre><code class="language-js">Deno.test(&quot;Test Assert Match&quot;, () =&gt; {
  assertMatch(&quot;abcdefghi&quot;, new RegExp(&quot;def&quot;));

  const basicUrl = new RegExp(&quot;^https?://[a-z.]+.com$&quot;);
  assertMatch(&quot;https://www.google.com&quot;, basicUrl);
  assertMatch(&quot;http://facebook.com&quot;, basicUrl);
});
</code></pre>
<h3><a class="header" href="#例外スロー" id="例外スロー">例外スロー</a></h3>
<p>Denoでエラーがスローされたかどうかをアサートするには、<code>assertThrows()</code>と<code>assertAsyncThrows()</code>の2つの方法があります。どちらのアサーションでも、<a href="https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Error">Error</a>がスローされたこと、スローされたエラーのタイプ、メッセージが何であったかを確認できます。</p>
<p>2つのアサーションの違いは、<code>assertThrows()</code>が標準関数を受け入れ、<code>assertAsyncThrows()</code>が<a href="https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a> を返す関数を受け入れることです。</p>
<p><code>assertThrows()</code>は、エラーがスローされたことを確認し、オプションで、スローされたエラーが正しいタイプであることを確認し、エラーメッセージが期待どおりであることをアサートします。</p>
<pre><code class="language-js">Deno.test(&quot;Test Assert Throws&quot;, () =&gt; {
  assertThrows(
    () =&gt; {
      throw new Error(&quot;Panic!&quot;);
    },
    Error,
    &quot;Panic!&quot;,
  );
});
</code></pre>
<p><code>assertAsyncThrows()</code> は、主にPromiseを処理するため、もう少し複雑です。しかし、基本的にはPromiseでスローされたエラーや拒否をキャッチします。オプションで、エラーの種類とエラーメッセージを確認することもできます。</p>
<pre><code class="language-js">Deno.test(&quot;Test Assert Throws Async&quot;, () =&gt; {
  assertThrowsAsync(
    () =&gt; {
      return new Promise(() =&gt; {
        throw new Error(&quot;Panic! Threw Error&quot;);
      });
    },
    Error,
    &quot;Panic! Threw Error&quot;,
  );

  assertThrowsAsync(
    () =&gt; {
      return Promise.reject(new Error(&quot;Panic! Reject Error&quot;));
    },
    Error,
    &quot;Panic! Reject Error&quot;,
  );
});
</code></pre>
<h3><a class="header" href="#カスタムメッセージ" id="カスタムメッセージ">カスタムメッセージ</a></h3>
<p>Denoの組み込みアサーションはそれぞれ、必要に応じて標準のCLIエラーメッセージを上書きできます。</p>
<p>たとえば、この例では&quot;Values Don't Match!&quot;が出力されます。標準のCLIエラーメッセージではなく。</p>
<pre><code class="language-js">Deno.test(&quot;Test Assert Equal Fail Custom Message&quot;, () =&gt; {
  assertEquals(1, 2, &quot;Values Don't Match!&quot;);
});
</code></pre>
<h1><a class="header" href="#ビルトインツール" id="ビルトインツール">ビルトインツール</a></h1>
<p>Denoは、JavaScriptおよびTypeScriptを操作するときに役立つ組み込みツールをいくつか提供しています。</p>
<ul>
<li><a href="./tools/bundler.html"><code>deno bundle</code></a></li>
<li><a href="./tools/debugger.html"><code>--inspect, --inspect-brk</code></a></li>
<li><a href="./tools/dependency_inspector.html"><code>deno info</code></a></li>
<li><a href="./tools/documentation_generator.html"><code>deno doc</code></a></li>
<li><a href="./tools/formatter.html"><code>deno fmt</code></a></li>
<li><a href="./testing.html"><code>deno test</code></a></li>
<li><a href="./tools/linter.html"><code>deno lint</code></a></li>
</ul>
<h2><a class="header" href="#debugger" id="debugger">Debugger</a></h2>
<p>Deno supports the <a href="https://v8.dev/docs/inspector">V8 Inspector Protocol</a>.</p>
<p>It's possible to debug Deno programs using Chrome Devtools or other clients that
support the protocol (eg. VSCode).</p>
<p>To activate debugging capabilities run Deno with the <code>--inspect</code> or
<code>--inspect-brk</code> flags.</p>
<p>The <code>--inspect</code> flag allows attaching the debugger at any point in time, while
<code>--inspect-brk</code> will wait for the debugger to attach and will pause execution on
the first line of code.</p>
<h3><a class="header" href="#chrome-devtools" id="chrome-devtools">Chrome Devtools</a></h3>
<p>Let's try debugging a program using Chrome Devtools. For this, we'll use
<a href="https://deno.land/std@v0.64.0/http/file_server.ts">file_server.ts</a> from <code>std</code>,
a static file server.</p>
<p>Use the <code>--inspect-brk</code> flag to break execution on the first line:</p>
<pre><code class="language-shell">$ deno run --inspect-brk --allow-read --allow-net https://deno.land/std@v0.64.0/http/file_server.ts
Debugger listening on ws://127.0.0.1:9229/ws/1e82c406-85a9-44ab-86b6-7341583480b1
Download https://deno.land/std@v0.64.0/http/file_server.ts
Compile https://deno.land/std@v0.64.0/http/file_server.ts
...
</code></pre>
<p>Open <code>chrome://inspect</code> and click <code>Inspect</code> next to target:</p>
<p><img src="tools/../images/debugger1.jpg" alt="chrome://inspect" /></p>
<p>It might take a few seconds after opening the devtools to load all modules.</p>
<p><img src="tools/../images/debugger2.jpg" alt="Devtools opened" /></p>
<p>You might notice that Devtools paused execution on the first line of
<code>_constants.ts</code> instead of <code>file_server.ts</code>. This is expected behavior and is
caused by the way ES modules are evaluated by V8 (<code>_constants.ts</code> is left-most,
bottom-most dependency of <code>file_server.ts</code> so it is evaluated first).</p>
<p>At this point all source code is available in the Devtools, so let's open up
<code>file_server.ts</code> and add a breakpoint there; go to &quot;Sources&quot; pane and expand the
tree:</p>
<p><img src="tools/../images/debugger3.jpg" alt="Open file_server.ts" /></p>
<p><em>Looking closely you'll find duplicate entries for each file; one written
regularly and one in italics. The former is compiled source file (so in the case
of <code>.ts</code> files it will be emitted JavaScript source), while the latter is a
source map for the file.</em></p>
<p>Next, add a breakpoint in the <code>listenAndServe</code> method:</p>
<p><img src="tools/../images/debugger4.jpg" alt="Break in file_server.ts" /></p>
<p>As soon as we've added the breakpoint Devtools automatically opened up the
source map file, which allows us step through the actual source code that
includes types.</p>
<p>Now that we have our breakpoints set, we can resume the execution of our script
so that we might inspect an incoming request. Hit the Resume script execution
button to do so. You might even need to hit it twice!</p>
<p>Once our script is running again, let's send a request and inspect it in
Devtools:</p>
<pre><code>$ curl http://0.0.0.0:4500/
</code></pre>
<p><img src="tools/../images/debugger5.jpg" alt="Break in request handling" /></p>
<p>At this point we can introspect the contents of the request and go step-by-step
to debug the code.</p>
<h3><a class="header" href="#vscode" id="vscode">VSCode</a></h3>
<p>Deno can be debugged using VSCode.</p>
<p>Official support via the plugin is being worked on -
https://github.com/denoland/vscode_deno/issues/12</p>
<p>We can still attach the debugger by manually providing a
<a href="https://code.visualstudio.com/docs/editor/debugging#_launch-configurations"><code>launch.json</code></a>
config:</p>
<pre><code class="language-json">{
  &quot;version&quot;: &quot;0.2.0&quot;,
  &quot;configurations&quot;: [
    {
      &quot;name&quot;: &quot;Deno&quot;,
      &quot;type&quot;: &quot;node&quot;,
      &quot;request&quot;: &quot;launch&quot;,
      &quot;cwd&quot;: &quot;${workspaceFolder}&quot;,
      &quot;runtimeExecutable&quot;: &quot;deno&quot;,
      &quot;runtimeArgs&quot;: [&quot;run&quot;, &quot;--inspect-brk&quot;, &quot;-A&quot;, &quot;${file}&quot;],
      &quot;port&quot;: 9229
    }
  ]
}
</code></pre>
<p><strong>NOTE</strong>: This uses the file you have open as the entry point; replace <code>${file}</code>
with a script name if you want a fixed entry point.</p>
<p>Let's try out debugging a local source file. Create <code>server.ts</code>:</p>
<pre><code class="language-ts">import { serve } from &quot;https://deno.land/std@v0.64.0/http/server.ts&quot;;
const server = serve({ port: 8000 });
console.log(&quot;http://localhost:8000/&quot;);

for await (const req of server) {
  req.respond({ body: &quot;Hello World\n&quot; });
}
</code></pre>
<p>Then we can set a breakpoint, and run the created configuration:</p>
<p><img src="tools/../images/debugger7.jpg" alt="VSCode debugger" /></p>
<h3><a class="header" href="#jetbrains-ides" id="jetbrains-ides">JetBrains IDEs</a></h3>
<p>You can debug Deno using your JetBrains IDE by right-clicking the file you want
to debug and selecting the <code>Debug 'Deno: &lt;file name&gt;'</code> option. This will create
a run/debug configuration with no permission flags set. To configure these flags
edit the run/debug configuration and modify the <code>Arguments</code> field with the
required flags.</p>
<h3><a class="header" href="#other" id="other">Other</a></h3>
<p>Any client that implements the Devtools protocol should be able to connect to a
Deno process.</p>
<h3><a class="header" href="#limitations" id="limitations">Limitations</a></h3>
<p>Devtools support is still immature. There is some functionality that is known to
be missing or buggy:</p>
<ul>
<li>autocomplete in Devtools' console causes the Deno process to exit</li>
<li>profiling and memory dumps might not work correctly</li>
</ul>
<h2><a class="header" href="#script-installer" id="script-installer">Script installer</a></h2>
<p>Deno provides <code>deno install</code> to easily install and distribute executable code.</p>
<p><code>deno install [OPTIONS...] [URL] [SCRIPT_ARGS...]</code> will install the script
available at <code>URL</code> under the name <code>EXE_NAME</code>.</p>
<p>This command creates a thin, executable shell script which invokes <code>deno</code> using
the specified CLI flags and main module. It is placed in the installation root's
<code>bin</code> directory.</p>
<p>Example:</p>
<pre><code class="language-shell">$ deno install --allow-net --allow-read https://deno.land/std/http/file_server.ts
[1/1] Compiling https://deno.land/std/http/file_server.ts

✅ Successfully installed file_server.
/Users/deno/.deno/bin/file_server
</code></pre>
<p>To change the executable name, use <code>-n</code>/<code>--name</code>:</p>
<pre><code class="language-shell">deno install --allow-net --allow-read -n serve https://deno.land/std/http/file_server.ts
</code></pre>
<p>The executable name is inferred by default:</p>
<ul>
<li>Attempt to take the file stem of the URL path. The above example would become
'file_server'.</li>
<li>If the file stem is something generic like 'main', 'mod', 'index' or 'cli',
and the path has no parent, take the file name of the parent path. Otherwise
settle with the generic name.</li>
</ul>
<p>To change the installation root, use <code>--root</code>:</p>
<pre><code class="language-shell">deno install --allow-net --allow-read --root /usr/local https://deno.land/std/http/file_server.ts
</code></pre>
<p>The installation root is determined, in order of precedence:</p>
<ul>
<li><code>--root</code> option</li>
<li><code>DENO_INSTALL_ROOT</code> environment variable</li>
<li><code>$HOME/.deno</code></li>
</ul>
<p>These must be added to the path manually if required.</p>
<pre><code class="language-shell">echo 'export PATH=&quot;$HOME/.deno/bin:$PATH&quot;' &gt;&gt; ~/.bashrc
</code></pre>
<p>You must specify permissions that will be used to run the script at installation
time.</p>
<pre><code class="language-shell">deno install --allow-net --allow-read https://deno.land/std/http/file_server.ts -p 8080
</code></pre>
<p>The above command creates an executable called <code>file_server</code> that runs with
network and read permissions and binds to port 8080.</p>
<p>For good practice, use the <a href="tools/../examples/testing_if_main.html"><code>import.meta.main</code></a>
idiom to specify the entry point in an executable script.</p>
<p>Example:</p>
<!-- dprint-ignore -->
<pre><code class="language-ts">// https://example.com/awesome/cli.ts
async function myAwesomeCli(): Promise&lt;void&gt; {
  -- snip --
}

if (import.meta.main) {
  myAwesomeCli();
}
</code></pre>
<p>When you create an executable script make sure to let users know by adding an
example installation command to your repository:</p>
<pre><code class="language-shell"># Install using deno install

$ deno install -n awesome_cli https://example.com/awesome/cli.ts
</code></pre>
<h2><a class="header" href="#code-formatter" id="code-formatter">Code formatter</a></h2>
<p>Deno ships with a built in code formatter that auto-formats TypeScript and
JavaScript code.</p>
<pre><code class="language-shell"># format all JS/TS files in the current directory and subdirectories
deno fmt
# format specific files
deno fmt myfile1.ts myfile2.ts
# check if all the JS/TS files in the current directory and subdirectories are formatted
deno fmt --check
# format stdin and write to stdout
cat file.ts | deno fmt -
</code></pre>
<p>Ignore formatting code by preceding it with a <code>// deno-fmt-ignore</code> comment:</p>
<pre><code class="language-ts">// deno-fmt-ignore
export const identity = [
    1, 0, 0,
    0, 1, 0,
    0, 0, 1,
];
</code></pre>
<p>Or ignore an entire file by adding a <code>// deno-fmt-ignore-file</code> comment at the
top of the file.</p>
<h2><a class="header" href="#bundling" id="bundling">Bundling</a></h2>
<p><code>deno bundle [URL]</code> will output a single JavaScript file, which includes all
dependencies of the specified input. For example:</p>
<pre><code>&gt; deno bundle https://deno.land/std/examples/colors.ts colors.bundle.js
Bundling &quot;colors.bundle.js&quot;
Emitting bundle to &quot;colors.bundle.js&quot;
9.2 kB emitted.
</code></pre>
<p>If you omit the out file, the bundle will be sent to <code>stdout</code>.</p>
<p>The bundle can just be run as any other module in Deno would:</p>
<pre><code>deno run colors.bundle.js
</code></pre>
<p>The output is a self contained ES Module, where any exports from the main module
supplied on the command line will be available. For example, if the main module
looked something like this:</p>
<pre><code class="language-ts">export { foo } from &quot;./foo.js&quot;;

export const bar = &quot;bar&quot;;
</code></pre>
<p>It could be imported like this:</p>
<pre><code class="language-ts">import { foo, bar } from &quot;./lib.bundle.js&quot;;
</code></pre>
<p>Bundles can also be loaded in the web browser. The bundle is a self-contained ES
module, and so the attribute of <code>type</code> must be set to <code>&quot;module&quot;</code>. For example:</p>
<pre><code class="language-html">&lt;script type=&quot;module&quot; src=&quot;website.bundle.js&quot;&gt;&lt;/script&gt;
</code></pre>
<p>Or you could import it into another ES module to consume:</p>
<pre><code class="language-html">&lt;script type=&quot;module&quot;&gt;
  import * as website from &quot;website.bundle.js&quot;;
&lt;/script&gt;
</code></pre>
<h2><a class="header" href="#documentation-generator" id="documentation-generator">Documentation Generator</a></h2>
<p><code>deno doc</code> followed by a list of one or more source files will print the JSDoc
documentation for each of the module's <strong>exported</strong> members. Currently, only
exports in the style <code>export &lt;declaration&gt;</code> and <code>export ... from ...</code> are
supported.</p>
<p>For example, given a file <code>add.ts</code> with the contents:</p>
<pre><code class="language-ts">/**
 * Adds x and y.
 * @param {number} x
 * @param {number} y
 * @returns {number} Sum of x and y
 */
export function add(x: number, y: number): number {
  return x + y;
}
</code></pre>
<p>Running the Deno <code>doc</code> command, prints the function's JSDoc comment to <code>stdout</code>:</p>
<pre><code class="language-shell">deno doc add.ts
function add(x: number, y: number): number
  Adds x and y. @param {number} x @param {number} y @returns {number} Sum of x and y
</code></pre>
<p>Use the <code>--json</code> flag to output the documentation in JSON format. This JSON
format is consumed by the
<a href="https://github.com/denoland/doc_website">deno doc website</a> and used to generate
module documentation.</p>
<h2><a class="header" href="#dependency-inspector" id="dependency-inspector">Dependency Inspector</a></h2>
<p><code>deno info [URL]</code> will inspect ES module and all of its dependencies.</p>
<pre><code class="language-shell">deno info https://deno.land/std@0.52.0/http/file_server.ts
Download https://deno.land/std@0.52.0/http/file_server.ts
...
local: /Users/deno/Library/Caches/deno/deps/https/deno.land/5bd138988e9d20db1a436666628ffb3f7586934e0a2a9fe2a7b7bf4fb7f70b98
type: TypeScript
compiled: /Users/deno/Library/Caches/deno/gen/https/deno.land/std@0.52.0/http/file_server.ts.js
map: /Users/deno/Library/Caches/deno/gen/https/deno.land/std@0.52.0/http/file_server.ts.js.map
deps:
https://deno.land/std@0.52.0/http/file_server.ts
  ├─┬ https://deno.land/std@0.52.0/path/mod.ts
  │ ├─┬ https://deno.land/std@0.52.0/path/win32.ts
  │ │ ├── https://deno.land/std@0.52.0/path/_constants.ts
  │ │ ├─┬ https://deno.land/std@0.52.0/path/_util.ts
  │ │ │ └── https://deno.land/std@0.52.0/path/_constants.ts
  │ │ └─┬ https://deno.land/std@0.52.0/testing/asserts.ts
  │ │   ├── https://deno.land/std@0.52.0/fmt/colors.ts
  │ │   └── https://deno.land/std@0.52.0/testing/diff.ts
  │ ├─┬ https://deno.land/std@0.52.0/path/posix.ts
  │ │ ├── https://deno.land/std@0.52.0/path/_constants.ts
  │ │ └── https://deno.land/std@0.52.0/path/_util.ts
  │ ├─┬ https://deno.land/std@0.52.0/path/common.ts
  │ │ └── https://deno.land/std@0.52.0/path/separator.ts
  │ ├── https://deno.land/std@0.52.0/path/separator.ts
  │ ├── https://deno.land/std@0.52.0/path/interface.ts
  │ └─┬ https://deno.land/std@0.52.0/path/glob.ts
  │   ├── https://deno.land/std@0.52.0/path/separator.ts
  │   ├── https://deno.land/std@0.52.0/path/_globrex.ts
  │   ├── https://deno.land/std@0.52.0/path/mod.ts
  │   └── https://deno.land/std@0.52.0/testing/asserts.ts
  ├─┬ https://deno.land/std@0.52.0/http/server.ts
  │ ├── https://deno.land/std@0.52.0/encoding/utf8.ts
  │ ├─┬ https://deno.land/std@0.52.0/io/bufio.ts
  │ │ ├─┬ https://deno.land/std@0.52.0/io/util.ts
  │ │ │ ├── https://deno.land/std@0.52.0/path/mod.ts
  │ │ │ └── https://deno.land/std@0.52.0/encoding/utf8.ts
  │ │ └── https://deno.land/std@0.52.0/testing/asserts.ts
  │ ├── https://deno.land/std@0.52.0/testing/asserts.ts
  │ ├─┬ https://deno.land/std@0.52.0/async/mod.ts
  │ │ ├── https://deno.land/std@0.52.0/async/deferred.ts
  │ │ ├── https://deno.land/std@0.52.0/async/delay.ts
  │ │ └─┬ https://deno.land/std@0.52.0/async/mux_async_iterator.ts
  │ │   └── https://deno.land/std@0.52.0/async/deferred.ts
  │ └─┬ https://deno.land/std@0.52.0/http/_io.ts
  │   ├── https://deno.land/std@0.52.0/io/bufio.ts
  │   ├─┬ https://deno.land/std@0.52.0/textproto/mod.ts
  │   │ ├── https://deno.land/std@0.52.0/io/util.ts
  │   │ ├─┬ https://deno.land/std@0.52.0/bytes/mod.ts
  │   │ │ └── https://deno.land/std@0.52.0/io/util.ts
  │   │ └── https://deno.land/std@0.52.0/encoding/utf8.ts
  │   ├── https://deno.land/std@0.52.0/testing/asserts.ts
  │   ├── https://deno.land/std@0.52.0/encoding/utf8.ts
  │   ├── https://deno.land/std@0.52.0/http/server.ts
  │   └── https://deno.land/std@0.52.0/http/http_status.ts
  ├─┬ https://deno.land/std@0.52.0/flags/mod.ts
  │ └── https://deno.land/std@0.52.0/testing/asserts.ts
  └── https://deno.land/std@0.52.0/testing/asserts.ts
</code></pre>
<p>Dependency inspector works with any local or remote ES modules.</p>
<h2><a class="header" href="#cache-location" id="cache-location">Cache location</a></h2>
<p><code>deno info</code> can be used to display information about cache location:</p>
<pre><code class="language-shell">deno info
DENO_DIR location: &quot;/Users/deno/Library/Caches/deno&quot;
Remote modules cache: &quot;/Users/deno/Library/Caches/deno/deps&quot;
TypeScript compiler cache: &quot;/Users/deno/Library/Caches/deno/gen&quot;
</code></pre>
<h2><a class="header" href="#linter" id="linter">Linter</a></h2>
<p>Deno ships with a built in code linter for JavaScript and TypeScript.</p>
<p><strong>Note: linter is a new feature and still unstable thus it requires <code>--unstable</code>
flag</strong></p>
<pre><code class="language-shell"># lint all JS/TS files in the current directory and subdirectories
deno lint --unstable
# lint specific files
deno lint --unstable myfile1.ts myfile2.ts
</code></pre>
<h3><a class="header" href="#available-rules" id="available-rules">Available rules</a></h3>
<ul>
<li><code>ban-ts-comment</code></li>
<li><code>ban-untagged-ignore</code></li>
<li><code>constructor-super</code></li>
<li><code>for-direction</code></li>
<li><code>getter-return</code></li>
<li><code>no-array-constructor</code></li>
<li><code>no-async-promise-executor</code></li>
<li><code>no-case-declarations</code></li>
<li><code>no-class-assign</code></li>
<li><code>no-compare-neg-zero</code></li>
<li><code>no-cond-assign</code></li>
<li><code>no-debugger</code></li>
<li><code>no-delete-var</code></li>
<li><code>no-dupe-args</code></li>
<li><code>no-dupe-keys</code></li>
<li><code>no-duplicate-case</code></li>
<li><code>no-empty-character-class</code></li>
<li><code>no-empty-interface</code></li>
<li><code>no-empty-pattern</code></li>
<li><code>no-empty</code></li>
<li><code>no-ex-assign</code></li>
<li><code>no-explicit-any</code></li>
<li><code>no-func-assign</code></li>
<li><code>no-misused-new</code></li>
<li><code>no-namespace</code></li>
<li><code>no-new-symbol</code></li>
<li><code>no-obj-call</code></li>
<li><code>no-octal</code></li>
<li><code>no-prototype-builtins</code></li>
<li><code>no-regex-spaces</code></li>
<li><code>no-setter-return</code></li>
<li><code>no-this-alias</code></li>
<li><code>no-this-before-super</code></li>
<li><code>no-unsafe-finally</code></li>
<li><code>no-unsafe-negation</code></li>
<li><code>no-with</code></li>
<li><code>prefer-as-const</code></li>
<li><code>prefer-namespace-keyword</code></li>
<li><code>require-yield</code></li>
<li><code>triple-slash-reference</code></li>
<li><code>use-isnan</code></li>
<li><code>valid-typeof</code></li>
</ul>
<h3><a class="header" href="#ignore-directives" id="ignore-directives">Ignore directives</a></h3>
<h4><a class="header" href="#files" id="files">Files</a></h4>
<p>To ignore whole file <code>// deno-lint-ignore-file</code> directive should placed at the
top of the file.</p>
<pre><code class="language-ts">// deno-lint-ignore-file

function foo(): any {
  // ...
}
</code></pre>
<p>Ignore directive must be placed before first stament or declaration:</p>
<pre><code class="language-ts">// Copyright 2020 the Deno authors. All rights reserved. MIT license.

/**
 * Some JS doc
 **/

// deno-lint-ignore-file

import { bar } from &quot;./bar.js&quot;;

function foo(): any {
  // ...
}
</code></pre>
<h4><a class="header" href="#diagnostics" id="diagnostics">Diagnostics</a></h4>
<p>To ignore certain diagnostic <code>// deno-lint-ignore &lt;codes...&gt;</code> directive should
be placed before offending line. Specifying ignored rule name is required.</p>
<pre><code class="language-ts">// deno-lint-ignore no-explicit-any
function foo(): any {
  // ...
}

// deno-lint-ignore no-explicit-any explicit-function-return-type
function bar(a: any) {
  // ...
}
</code></pre>
<p>To provide some compatibility with ESLint <code>deno lint</code> also supports
<code>// eslint-ignore-next-line</code> directive. Just like in <code>// deno-lint-ignore</code> it's
required to specify ignored rule name is required.</p>
<pre><code class="language-ts">// eslint-ignore-next-line no-empty
while (true) {}

// eslint-ignore-next-line @typescript-eslint/no-explicit-any
function bar(a: any) {
  // ...
}
</code></pre>
<h1><a class="header" href="#組み込みdeno" id="組み込みdeno">組み込みDeno</a></h1>
<p>Denoは複数の部分で構成されており、そのうちの1つは<code>deno_core</code>です。これは、JavaScriptランタイムをRustアプリケーションに埋め込むために使用できるRust Crateです。 Denoは<code>deno_core</code>の上に構築されています。</p>
<p>Denoクレートは、<a href="https://crates.io/crates/deno_core">crates.io</a>でホストされています。 </p>
<p>APIは<a href="https://docs.rs/deno_core">docs.rs</a>で確認できます。</p>
<!-- TODO(lucacasonato): better docs -->
<h1><a class="header" href="#contributing" id="contributing">Contributing</a></h1>
<ul>
<li>
<p>Read the <a href="./contributing/style_guide.html">style guide</a>.</p>
</li>
<li>
<p>Please don't make <a href="https://deno.land/benchmarks.html">the benchmarks</a> worse.</p>
</li>
<li>
<p>Ask for help in the <a href="https://discord.gg/deno">community chat room</a>.</p>
</li>
<li>
<p>If you are going to work on an issue, mention so in the issue comments
<em>before</em> you start working on the issue.</p>
</li>
<li>
<p>Please be professional in the forums. We follow
<a href="https://www.rust-lang.org/policies/code-of-conduct">Rust's code of conduct</a>
(CoC) Have a problem? Email ry@tinyclouds.org.</p>
</li>
</ul>
<h2><a class="header" href="#development" id="development">Development</a></h2>
<p>Instructions on how to build from source can be found
<a href="./contributing/building_from_source.html">here</a>.</p>
<h2><a class="header" href="#submitting-a-pull-request" id="submitting-a-pull-request">Submitting a Pull Request</a></h2>
<p>Before submitting, please make sure the following is done:</p>
<ol>
<li>That there is a related issue and it is referenced in the PR text.</li>
<li>There are tests that cover the changes.</li>
<li>Ensure <code>cargo test</code> passes.</li>
<li>Format your code with <code>./tools/format.py</code></li>
<li>Make sure <code>./tools/lint.py</code> passes.</li>
</ol>
<h2><a class="header" href="#changes-to-third_party" id="changes-to-third_party">Changes to <code>third_party</code></a></h2>
<p><a href="https://github.com/denoland/deno_third_party"><code>deno_third_party</code></a> contains most
of the external code that Deno depends on, so that we know exactly what we are
executing at any given time. It is carefully maintained with a mixture of manual
labor and private scripts. It's likely you will need help from @ry or
@piscisaureus to make changes.</p>
<h2><a class="header" href="#adding-ops-aka-bindings" id="adding-ops-aka-bindings">Adding Ops (aka bindings)</a></h2>
<p>We are very concerned about making mistakes when adding new APIs. When adding an
Op to Deno, the counterpart interfaces on other platforms should be researched.
Please list how this functionality is done in Go, Node, Rust, and Python.</p>
<p>As an example, see how <code>Deno.rename()</code> was proposed and added in
<a href="https://github.com/denoland/deno/pull/671">PR #671</a>.</p>
<h2><a class="header" href="#releases" id="releases">Releases</a></h2>
<p>Summary of the changes from previous releases can be found
<a href="https://github.com/denoland/deno/releases">here</a>.</p>
<h2><a class="header" href="#documenting-apis" id="documenting-apis">Documenting APIs</a></h2>
<p>It is important to document public APIs and we want to do that inline with the
code. This helps ensure that code and documentation are tightly coupled
together.</p>
<h3><a class="header" href="#utilize-jsdoc" id="utilize-jsdoc">Utilize JSDoc</a></h3>
<p>All publicly exposed APIs and types, both via the <code>deno</code> module as well as the
global/<code>window</code> namespace should have JSDoc documentation. This documentation is
parsed and available to the TypeScript compiler, and therefore easy to provide
further downstream. JSDoc blocks come just prior to the statement they apply to
and are denoted by a leading <code>/**</code> before terminating with a <code>*/</code>. For example:</p>
<pre><code class="language-ts">/** A simple JSDoc comment */
export const FOO = &quot;foo&quot;;
</code></pre>
<p>Find more at https://jsdoc.app/</p>
<h2><a class="header" href="#building-from-source" id="building-from-source">Building from source</a></h2>
<p>Below are instructions on how to build Deno from source. If you just want to use
Deno you can download a prebuilt executable (more information in the
<code>Getting Started</code> chapter).</p>
<h3><a class="header" href="#cloning-the-repository" id="cloning-the-repository">Cloning the Repository</a></h3>
<p>Clone on Linux or Mac:</p>
<pre><code class="language-shell">git clone --recurse-submodules https://github.com/denoland/deno.git
</code></pre>
<p>Extra steps for Windows users:</p>
<ol>
<li><a href="https://www.google.com/search?q=windows+enable+developer+mode">Enable &quot;Developer Mode&quot;</a>
(otherwise symlinks would require administrator privileges).</li>
<li>Make sure you are using git version 2.19.2.windows.1 or newer.</li>
<li>Set <code>core.symlinks=true</code> before the checkout:
<pre><code class="language-shell">git config --global core.symlinks true
git clone --recurse-submodules https://github.com/denoland/deno.git
</code></pre>
</li>
</ol>
<h3><a class="header" href="#prerequisites" id="prerequisites">Prerequisites</a></h3>
<p>You will need to <a href="https://www.rust-lang.org/tools/install">install Rust</a>. Make
sure to fetch the latest stable release as Deno does not support nightly builds.
Check that you have the required tools:</p>
<pre><code>rustc -V
cargo -V
</code></pre>
<h3><a class="header" href="#setup-rust-targets-and-components" id="setup-rust-targets-and-components">Setup rust targets and components</a></h3>
<pre><code class="language-shell">rustup target add wasm32-unknown-unknown
rustup target add wasm32-wasi
</code></pre>
<h3><a class="header" href="#building-deno" id="building-deno">Building Deno</a></h3>
<p>The easiest way to build Deno is by using a precompiled version of V8:</p>
<pre><code>cargo build -vv
</code></pre>
<p>However if you want to build Deno and V8 from source code:</p>
<pre><code>V8_FROM_SOURCE=1 cargo build -vv
</code></pre>
<p>When building V8 from source, there are more dependencies:</p>
<p><a href="https://www.python.org/downloads">Python 2</a>. Ensure that a suffix-less
<code>python</code>/<code>python.exe</code> exists in your <code>PATH</code> and it refers to Python 2,
<a href="https://github.com/denoland/deno/issues/464#issuecomment-411795578">not 3</a>.</p>
<p>For Linux users glib-2.0 development files must also be installed. (On Ubuntu,
run <code>apt install libglib2.0-dev</code>.)</p>
<p>Mac users must have Command Line Tools installed.
(<a href="https://developer.apple.com/xcode/">XCode</a> already includes CLT. Run
<code>xcode-select --install</code> to install it without XCode.)</p>
<p>For Windows users:</p>
<ol>
<li>
<p>Get <a href="https://www.visualstudio.com/downloads/">VS Community 2019</a> with
&quot;Desktop development with C++&quot; toolkit and make sure to select the following
required tools listed below along with all C++ tools.</p>
<ul>
<li>Visual C++ tools for CMake</li>
<li>Windows 10 SDK (10.0.17763.0)</li>
<li>Testing tools core features - Build Tools</li>
<li>Visual C++ ATL for x86 and x64</li>
<li>Visual C++ MFC for x86 and x64</li>
<li>C++/CLI support</li>
<li>VC++ 2015.3 v14.00 (v140) toolset for desktop</li>
</ul>
</li>
<li>
<p>Enable &quot;Debugging Tools for Windows&quot;. Go to &quot;Control Panel&quot; → &quot;Programs&quot; →
&quot;Programs and Features&quot; → Select &quot;Windows Software Development Kit - Windows
10&quot; → &quot;Change&quot; → &quot;Change&quot; → Check &quot;Debugging Tools For Windows&quot; → &quot;Change&quot; -&gt;
&quot;Finish&quot;. Or use:
<a href="https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/">Debugging Tools for Windows</a>
(Notice: it will download the files, you should install
<code>X64 Debuggers And Tools-x64_en-us.msi</code> file manually.)</p>
</li>
</ol>
<p>See <a href="https://github.com/denoland/rusty_v8">rusty_v8's README</a> for more details
about the V8 build.</p>
<h3><a class="header" href="#building" id="building">Building</a></h3>
<p>Build with Cargo:</p>
<pre><code class="language-shell"># Build:
cargo build -vv

# Build errors?  Ensure you have latest master and try building again, or if that doesn't work try:
cargo clean &amp;&amp; cargo build -vv

# Run:
./target/debug/deno run cli/tests/002_hello.ts
</code></pre>
<h2><a class="header" href="#testing-and-tools" id="testing-and-tools">Testing and Tools</a></h2>
<h3><a class="header" href="#tests" id="tests">Tests</a></h3>
<p>Test <code>deno</code>:</p>
<pre><code class="language-shell"># Run the whole suite:
cargo test

# Only test cli/js/:
cargo test js_unit_tests
</code></pre>
<p>Test <code>std/</code>:</p>
<pre><code class="language-shell">cargo test std_tests
</code></pre>
<h3><a class="header" href="#lint-and-format" id="lint-and-format">Lint and format</a></h3>
<p>Lint the code:</p>
<pre><code class="language-shell">./tools/lint.py
</code></pre>
<p>Format the code:</p>
<pre><code class="language-shell">./tools/format.py
</code></pre>
<h3><a class="header" href="#profiling" id="profiling">Profiling</a></h3>
<p>To start profiling,</p>
<pre><code class="language-sh"># Make sure we're only building release.
# Build deno and V8's d8.
ninja -C target/release d8

# Start the program we want to benchmark with --prof
./target/release/deno run tests/http_bench.ts --allow-net --v8-flags=--prof &amp;

# Exercise it.
third_party/wrk/linux/wrk http://localhost:4500/
kill `pgrep deno`
</code></pre>
<p>V8 will write a file in the current directory that looks like this:
<code>isolate-0x7fad98242400-v8.log</code>. To examine this file:</p>
<pre><code class="language-sh">D8_PATH=target/release/ ./third_party/v8/tools/linux-tick-processor
isolate-0x7fad98242400-v8.log &gt; prof.log
# on macOS, use ./third_party/v8/tools/mac-tick-processor instead
</code></pre>
<p><code>prof.log</code> will contain information about tick distribution of different calls.</p>
<p>To view the log with Web UI, generate JSON file of the log:</p>
<pre><code class="language-sh">D8_PATH=target/release/ ./third_party/v8/tools/linux-tick-processor
isolate-0x7fad98242400-v8.log --preprocess &gt; prof.json
</code></pre>
<p>Open <code>third_party/v8/tools/profview/index.html</code> in your browser, and select
<code>prof.json</code> to view the distribution graphically.</p>
<p>Useful V8 flags during profiling:</p>
<ul>
<li>--prof</li>
<li>--log-internal-timer-events</li>
<li>--log-timer-events</li>
<li>--track-gc</li>
<li>--log-source-code</li>
<li>--track-gc-object-stats</li>
</ul>
<p>To learn more about <code>d8</code> and profiling, check out the following links:</p>
<ul>
<li><a href="https://v8.dev/docs/d8">https://v8.dev/docs/d8</a></li>
<li><a href="https://v8.dev/docs/profile">https://v8.dev/docs/profile</a></li>
</ul>
<h3><a class="header" href="#debugging-with-lldb" id="debugging-with-lldb">Debugging with LLDB</a></h3>
<p>To debug the deno binary, we can use <code>rust-lldb</code>. It should come with <code>rustc</code>
and is a wrapper around LLDB.</p>
<pre><code class="language-shell">$ rust-lldb -- ./target/debug/deno run --allow-net tests/http_bench.ts
# On macOS, you might get warnings like
# `ImportError: cannot import name _remove_dead_weakref`
# In that case, use system python by setting PATH, e.g.
# PATH=/System/Library/Frameworks/Python.framework/Versions/2.7/bin:$PATH
(lldb) command script import &quot;/Users/kevinqian/.rustup/toolchains/1.36.0-x86_64-apple-darwin/lib/rustlib/etc/lldb_rust_formatters.py&quot;
(lldb) type summary add --no-value --python-function lldb_rust_formatters.print_val -x &quot;.*&quot; --category Rust
(lldb) type category enable Rust
(lldb) target create &quot;../deno/target/debug/deno&quot;
Current executable set to '../deno/target/debug/deno' (x86_64).
(lldb) settings set -- target.run-args  &quot;tests/http_bench.ts&quot; &quot;--allow-net&quot;
(lldb) b op_start
(lldb) r
</code></pre>
<h3><a class="header" href="#v8-flags" id="v8-flags">V8 flags</a></h3>
<p>V8 has many many internal command-line flags.</p>
<pre><code class="language-shell">$ deno run --v8-flags=--help _
SSE3=1 SSSE3=1 SSE4_1=1 SSE4_2=1 SAHF=1 AVX=1 FMA3=1 BMI1=1 BMI2=1 LZCNT=1 POPCNT=1 ATOM=0
Synopsis:
  shell [options] [--shell] [&lt;file&gt;...]
  d8 [options] [-e &lt;string&gt;] [--shell] [[--module] &lt;file&gt;...]

  -e        execute a string in V8
  --shell   run an interactive JavaScript shell
  --module  execute a file as a JavaScript module

Note: the --module option is implicitly enabled for *.mjs files.

The following syntax for options is accepted (both '-' and '--' are ok):
  --flag        (bool flags only)
  --no-flag     (bool flags only)
  --flag=value  (non-bool flags only, no spaces around '=')
  --flag value  (non-bool flags only)
  --            (captures all remaining args in JavaScript)

Options:
  --use-strict (enforce strict mode)
        type: bool  default: false
  --es-staging (enable test-worthy harmony features (for internal use only))
        type: bool  default: false
  --harmony (enable all completed harmony features)
        type: bool  default: false
  --harmony-shipping (enable all shipped harmony features)
        type: bool  default: true
  --harmony-regexp-sequence (enable &quot;RegExp Unicode sequence properties&quot; (in progress))
        type: bool  default: false
  --harmony-weak-refs-with-cleanup-some (enable &quot;harmony weak references with FinalizationRegistry.prototype.cleanupSome&quot; (in progress))
        type: bool  default: false
  --harmony-regexp-match-indices (enable &quot;harmony regexp match indices&quot; (in progress))
        type: bool  default: false
  --harmony-top-level-await (enable &quot;harmony top level await&quot;)
        type: bool  default: false
  --harmony-namespace-exports (enable &quot;harmony namespace exports (export * as foo from 'bar')&quot;)
        type: bool  default: true
  --harmony-sharedarraybuffer (enable &quot;harmony sharedarraybuffer&quot;)
        type: bool  default: true
  --harmony-import-meta (enable &quot;harmony import.meta property&quot;)
        type: bool  default: true
  --harmony-dynamic-import (enable &quot;harmony dynamic import&quot;)
        type: bool  default: true
  --harmony-promise-all-settled (enable &quot;harmony Promise.allSettled&quot;)
        type: bool  default: true
  --harmony-promise-any (enable &quot;harmony Promise.any&quot;)
        type: bool  default: true
  --harmony-private-methods (enable &quot;harmony private methods in class literals&quot;)
        type: bool  default: true
  --harmony-weak-refs (enable &quot;harmony weak references&quot;)
        type: bool  default: true
  --harmony-string-replaceall (enable &quot;harmony String.prototype.replaceAll&quot;)
        type: bool  default: true
  --harmony-logical-assignment (enable &quot;harmony logical assignment&quot;)
        type: bool  default: true
  --lite-mode (enables trade-off of performance for memory savings)
        type: bool  default: false
  --future (Implies all staged features that we want to ship in the not-too-far future)
        type: bool  default: false
  --assert-types (generate runtime type assertions to test the typer)
        type: bool  default: false
  --allocation-site-pretenuring (pretenure with allocation sites)
        type: bool  default: true
  --page-promotion (promote pages based on utilization)
        type: bool  default: true
  --always-promote-young-mc (always promote young objects during mark-compact)
        type: bool  default: true
  --page-promotion-threshold (min percentage of live bytes on a page to enable fast evacuation)
        type: int  default: 70
  --trace-pretenuring (trace pretenuring decisions of HAllocate instructions)
        type: bool  default: false
  --trace-pretenuring-statistics (trace allocation site pretenuring statistics)
        type: bool  default: false
  --track-fields (track fields with only smi values)
        type: bool  default: true
  --track-double-fields (track fields with double values)
        type: bool  default: true
  --track-heap-object-fields (track fields with heap values)
        type: bool  default: true
  --track-computed-fields (track computed boilerplate fields)
        type: bool  default: true
  --track-field-types (track field types)
        type: bool  default: true
  --trace-block-coverage (trace collected block coverage information)
        type: bool  default: false
  --trace-protector-invalidation (trace protector cell invalidations)
        type: bool  default: false
  --feedback-normalization (feed back normalization to constructors)
        type: bool  default: false
  --enable-one-shot-optimization (Enable size optimizations for the code that will only be executed once)
        type: bool  default: false
  --unbox-double-arrays (automatically unbox arrays of doubles)
        type: bool  default: true
  --interrupt-budget (interrupt budget which should be used for the profiler counter)
        type: int  default: 147456
  --jitless (Disable runtime allocation of executable memory.)
        type: bool  default: false
  --use-ic (use inline caching)
        type: bool  default: true
  --budget-for-feedback-vector-allocation (The budget in amount of bytecode executed by a function before we decide to allocate feedback vectors)
        type: int  default: 1024
  --lazy-feedback-allocation (Allocate feedback vectors lazily)
        type: bool  default: true
  --ignition-elide-noneffectful-bytecodes (elide bytecodes which won't have any external effect)
        type: bool  default: true
  --ignition-reo (use ignition register equivalence optimizer)
        type: bool  default: true
  --ignition-filter-expression-positions (filter expression positions before the bytecode pipeline)
        type: bool  default: true
  --ignition-share-named-property-feedback (share feedback slots when loading the same named property from the same object)
        type: bool  default: true
  --print-bytecode (print bytecode generated by ignition interpreter)
        type: bool  default: false
  --enable-lazy-source-positions (skip generating source positions during initial compile but regenerate when actually required)
        type: bool  default: true
  --stress-lazy-source-positions (collect lazy source positions immediately after lazy compile)
        type: bool  default: false
  --print-bytecode-filter (filter for selecting which functions to print bytecode)
        type: string  default: *
  --trace-ignition-codegen (trace the codegen of ignition interpreter bytecode handlers)
        type: bool  default: false
  --trace-ignition-dispatches (traces the dispatches to bytecode handlers by the ignition interpreter)
        type: bool  default: false
  --trace-ignition-dispatches-output-file (the file to which the bytecode handler dispatch table is written (by default, the table is not written to a file))
        type: string  default: nullptr
  --fast-math (faster (but maybe less accurate) math functions)
        type: bool  default: true
  --trace-track-allocation-sites (trace the tracking of allocation sites)
        type: bool  default: false
  --trace-migration (trace object migration)
        type: bool  default: false
  --trace-generalization (trace map generalization)
        type: bool  default: false
  --turboprop (enable experimental turboprop mid-tier compiler.)
        type: bool  default: false
  --concurrent-recompilation (optimizing hot functions asynchronously on a separate thread)
        type: bool  default: true
  --trace-concurrent-recompilation (track concurrent recompilation)
        type: bool  default: false
  --concurrent-recompilation-queue-length (the length of the concurrent compilation queue)
        type: int  default: 8
  --concurrent-recompilation-delay (artificial compilation delay in ms)
        type: int  default: 0
  --block-concurrent-recompilation (block queued jobs until released)
        type: bool  default: false
  --concurrent-inlining (run optimizing compiler's inlining phase on a separate thread)
        type: bool  default: false
  --max-serializer-nesting (maximum levels for nesting child serializers)
        type: int  default: 25
  --trace-heap-broker-verbose (trace the heap broker verbosely (all reports))
        type: bool  default: false
  --trace-heap-broker-memory (trace the heap broker memory (refs analysis and zone numbers))
        type: bool  default: false
  --trace-heap-broker (trace the heap broker (reports on missing data only))
        type: bool  default: false
  --stress-runs (number of stress runs)
        type: int  default: 0
  --deopt-every-n-times (deoptimize every n times a deopt point is passed)
        type: int  default: 0
  --print-deopt-stress (print number of possible deopt points)
        type: bool  default: false
  --opt (use adaptive optimizations)
        type: bool  default: true
  --turbo-sp-frame-access (use stack pointer-relative access to frame wherever possible)
        type: bool  default: false
  --turbo-control-flow-aware-allocation (consider control flow while allocating registers)
        type: bool  default: true
  --turbo-filter (optimization filter for TurboFan compiler)
        type: string  default: *
  --trace-turbo (trace generated TurboFan IR)
        type: bool  default: false
  --trace-turbo-path (directory to dump generated TurboFan IR to)
        type: string  default: nullptr
  --trace-turbo-filter (filter for tracing turbofan compilation)
        type: string  default: *
  --trace-turbo-graph (trace generated TurboFan graphs)
        type: bool  default: false
  --trace-turbo-scheduled (trace TurboFan IR with schedule)
        type: bool  default: false
  --trace-turbo-cfg-file (trace turbo cfg graph (for C1 visualizer) to a given file name)
        type: string  default: nullptr
  --trace-turbo-types (trace TurboFan's types)
        type: bool  default: true
  --trace-turbo-scheduler (trace TurboFan's scheduler)
        type: bool  default: false
  --trace-turbo-reduction (trace TurboFan's various reducers)
        type: bool  default: false
  --trace-turbo-trimming (trace TurboFan's graph trimmer)
        type: bool  default: false
  --trace-turbo-jt (trace TurboFan's jump threading)
        type: bool  default: false
  --trace-turbo-ceq (trace TurboFan's control equivalence)
        type: bool  default: false
  --trace-turbo-loop (trace TurboFan's loop optimizations)
        type: bool  default: false
  --trace-turbo-alloc (trace TurboFan's register allocator)
        type: bool  default: false
  --trace-all-uses (trace all use positions)
        type: bool  default: false
  --trace-representation (trace representation types)
        type: bool  default: false
  --turbo-verify (verify TurboFan graphs at each phase)
        type: bool  default: false
  --turbo-verify-machine-graph (verify TurboFan machine graph before instruction selection)
        type: string  default: nullptr
  --trace-verify-csa (trace code stubs verification)
        type: bool  default: false
  --csa-trap-on-node (trigger break point when a node with given id is created in given stub. The format is: StubName,NodeId)
        type: string  default: nullptr
  --turbo-stats (print TurboFan statistics)
        type: bool  default: false
  --turbo-stats-nvp (print TurboFan statistics in machine-readable format)
        type: bool  default: false
  --turbo-stats-wasm (print TurboFan statistics of wasm compilations)
        type: bool  default: false
  --turbo-splitting (split nodes during scheduling in TurboFan)
        type: bool  default: true
  --function-context-specialization (enable function context specialization in TurboFan)
        type: bool  default: false
  --turbo-inlining (enable inlining in TurboFan)
        type: bool  default: true
  --max-inlined-bytecode-size (maximum size of bytecode for a single inlining)
        type: int  default: 500
  --max-inlined-bytecode-size-cumulative (maximum cumulative size of bytecode considered for inlining)
        type: int  default: 1000
  --max-inlined-bytecode-size-absolute (maximum cumulative size of bytecode considered for inlining)
        type: int  default: 5000
  --reserve-inline-budget-scale-factor (maximum cumulative size of bytecode considered for inlining)
        type: float  default: 1.2
  --max-inlined-bytecode-size-small (maximum size of bytecode considered for small function inlining)
        type: int  default: 30
  --max-optimized-bytecode-size (maximum bytecode size to be considered for optimization; too high values may cause the compiler to hit (release) assertions)
        type: int  default: 61440
  --min-inlining-frequency (minimum frequency for inlining)
        type: float  default: 0.15
  --polymorphic-inlining (polymorphic inlining)
        type: bool  default: true
  --stress-inline (set high thresholds for inlining to inline as much as possible)
        type: bool  default: false
  --trace-turbo-inlining (trace TurboFan inlining)
        type: bool  default: false
  --turbo-inline-array-builtins (inline array builtins in TurboFan code)
        type: bool  default: true
  --use-osr (use on-stack replacement)
        type: bool  default: true
  --trace-osr (trace on-stack replacement)
        type: bool  default: false
  --analyze-environment-liveness (analyze liveness of environment slots and zap dead values)
        type: bool  default: true
  --trace-environment-liveness (trace liveness of local variable slots)
        type: bool  default: false
  --turbo-load-elimination (enable load elimination in TurboFan)
        type: bool  default: true
  --trace-turbo-load-elimination (trace TurboFan load elimination)
        type: bool  default: false
  --turbo-profiling (enable basic block profiling in TurboFan)
        type: bool  default: false
  --turbo-profiling-verbose (enable basic block profiling in TurboFan, and include each function's schedule and disassembly in the output)
        type: bool  default: false
  --turbo-verify-allocation (verify register allocation in TurboFan)
        type: bool  default: false
  --turbo-move-optimization (optimize gap moves in TurboFan)
        type: bool  default: true
  --turbo-jt (enable jump threading in TurboFan)
        type: bool  default: true
  --turbo-loop-peeling (Turbofan loop peeling)
        type: bool  default: true
  --turbo-loop-variable (Turbofan loop variable optimization)
        type: bool  default: true
  --turbo-loop-rotation (Turbofan loop rotation)
        type: bool  default: true
  --turbo-cf-optimization (optimize control flow in TurboFan)
        type: bool  default: true
  --turbo-escape (enable escape analysis)
        type: bool  default: true
  --turbo-allocation-folding (Turbofan allocation folding)
        type: bool  default: true
  --turbo-instruction-scheduling (enable instruction scheduling in TurboFan)
        type: bool  default: false
  --turbo-stress-instruction-scheduling (randomly schedule instructions to stress dependency tracking)
        type: bool  default: false
  --turbo-store-elimination (enable store-store elimination in TurboFan)
        type: bool  default: true
  --trace-store-elimination (trace store elimination)
        type: bool  default: false
  --turbo-rewrite-far-jumps (rewrite far to near jumps (ia32,x64))
        type: bool  default: true
  --stress-gc-during-compilation (simulate GC/compiler thread race related to https://crbug.com/v8/8520)
        type: bool  default: false
  --turbo-fast-api-calls (enable fast API calls from TurboFan)
        type: bool  default: false
  --reuse-opt-code-count (don't discard optimized code for the specified number of deopts.)
        type: int  default: 0
  --turbo-nci (enable experimental native context independent code.)
        type: bool  default: false
  --turbo-nci-as-highest-tier (replace default TF with NCI code as the highest tier for testing purposes.)
        type: bool  default: false
  --print-nci-code (print native context independent code.)
        type: bool  default: false
  --trace-turbo-nci (trace native context independent code.)
        type: bool  default: false
  --turbo-collect-feedback-in-generic-lowering (enable experimental feedback collection in generic lowering.)
        type: bool  default: false
  --optimize-for-size (Enables optimizations which favor memory size over execution speed)
        type: bool  default: false
  --untrusted-code-mitigations (Enable mitigations for executing untrusted code)
        type: bool  default: false
  --expose-wasm (expose wasm interface to JavaScript)
        type: bool  default: true
  --assume-asmjs-origin (force wasm decoder to assume input is internal asm-wasm format)
        type: bool  default: false
  --wasm-num-compilation-tasks (maximum number of parallel compilation tasks for wasm)
        type: int  default: 128
  --wasm-write-protect-code-memory (write protect code memory on the wasm native heap)
        type: bool  default: false
  --wasm-async-compilation (enable actual asynchronous compilation for WebAssembly.compile)
        type: bool  default: true
  --wasm-test-streaming (use streaming compilation instead of async compilation for tests)
        type: bool  default: false
  --wasm-max-mem-pages (maximum initial number of 64KiB memory pages of a wasm instance)
        type: uint  default: 32767
  --wasm-max-mem-pages-growth (maximum number of 64KiB pages a Wasm memory can grow to)
        type: uint  default: 65536
  --wasm-max-table-size (maximum table size of a wasm instance)
        type: uint  default: 10000000
  --wasm-max-code-space (maximum committed code space for wasm (in MB))
        type: uint  default: 1024
  --wasm-tier-up (enable tier up to the optimizing compiler (requires --liftoff to have an effect))
        type: bool  default: true
  --trace-wasm-ast-start (start function for wasm AST trace (inclusive))
        type: int  default: 0
  --trace-wasm-ast-end (end function for wasm AST trace (exclusive))
        type: int  default: 0
  --liftoff (enable Liftoff, the baseline compiler for WebAssembly)
        type: bool  default: true
  --trace-wasm-memory (print all memory updates performed in wasm code)
        type: bool  default: false
  --wasm-tier-mask-for-testing (bitmask of functions to compile with TurboFan instead of Liftoff)
        type: int  default: 0
  --wasm-expose-debug-eval (Expose wasm evaluator support on the CDP)
        type: bool  default: false
  --validate-asm (validate asm.js modules before compiling)
        type: bool  default: true
  --suppress-asm-messages (don't emit asm.js related messages (for golden file testing))
        type: bool  default: false
  --trace-asm-time (log asm.js timing info to the console)
        type: bool  default: false
  --trace-asm-scanner (log tokens encountered by asm.js scanner)
        type: bool  default: false
  --trace-asm-parser (verbose logging of asm.js parse failures)
        type: bool  default: false
  --stress-validate-asm (try to validate everything as asm.js)
        type: bool  default: false
  --dump-wasm-module-path (directory to dump wasm modules to)
        type: string  default: nullptr
  --experimental-wasm-eh (enable prototype exception handling opcodes for wasm)
        type: bool  default: false
  --experimental-wasm-simd (enable prototype SIMD opcodes for wasm)
        type: bool  default: false
  --experimental-wasm-return-call (enable prototype return call opcodes for wasm)
        type: bool  default: false
  --experimental-wasm-compilation-hints (enable prototype compilation hints section for wasm)
        type: bool  default: false
  --experimental-wasm-gc (enable prototype garbage collection for wasm)
        type: bool  default: false
  --experimental-wasm-typed-funcref (enable prototype typed function references for wasm)
        type: bool  default: false
  --experimental-wasm-reftypes (enable prototype reference type opcodes for wasm)
        type: bool  default: false
  --experimental-wasm-threads (enable prototype thread opcodes for wasm)
        type: bool  default: false
  --experimental-wasm-type-reflection (enable prototype wasm type reflection in JS for wasm)
        type: bool  default: false
  --experimental-wasm-bigint (enable prototype JS BigInt support for wasm)
        type: bool  default: true
  --experimental-wasm-bulk-memory (enable prototype bulk memory opcodes for wasm)
        type: bool  default: true
  --experimental-wasm-mv (enable prototype multi-value support for wasm)
        type: bool  default: true
  --wasm-staging (enable staged wasm features)
        type: bool  default: false
  --wasm-opt (enable wasm optimization)
        type: bool  default: false
  --wasm-bounds-checks (enable bounds checks (disable for performance testing only))
        type: bool  default: true
  --wasm-stack-checks (enable stack checks (disable for performance testing only))
        type: bool  default: true
  --wasm-math-intrinsics (intrinsify some Math imports into wasm)
        type: bool  default: true
  --wasm-trap-handler (use signal handlers to catch out of bounds memory access in wasm (currently Linux x86_64 only))
        type: bool  default: true
  --wasm-fuzzer-gen-test (generate a test case when running a wasm fuzzer)
        type: bool  default: false
  --print-wasm-code (Print WebAssembly code)
        type: bool  default: false
  --print-wasm-stub-code (Print WebAssembly stub code)
        type: bool  default: false
  --asm-wasm-lazy-compilation (enable lazy compilation for asm-wasm modules)
        type: bool  default: false
  --wasm-lazy-compilation (enable lazy compilation for all wasm modules)
        type: bool  default: false
  --wasm-lazy-validation (enable lazy validation for lazily compiled wasm functions)
        type: bool  default: false
  --wasm-atomics-on-non-shared-memory (allow atomic operations on non-shared WebAssembly memory)
        type: bool  default: true
  --wasm-grow-shared-memory (allow growing shared WebAssembly memory objects)
        type: bool  default: true
  --wasm-simd-post-mvp (allow experimental SIMD operations for prototyping that are not included in the current proposal)
        type: bool  default: false
  --wasm-code-gc (enable garbage collection of wasm code)
        type: bool  default: true
  --trace-wasm-code-gc (trace garbage collection of wasm code)
        type: bool  default: false
  --stress-wasm-code-gc (stress test garbage collection of wasm code)
        type: bool  default: false
  --wasm-max-initial-code-space-reservation (maximum size of the initial wasm code space reservation (in MB))
        type: int  default: 0
  --frame-count (number of stack frames inspected by the profiler)
        type: int  default: 1
  --stress-sampling-allocation-profiler (Enables sampling allocation profiler with X as a sample interval)
        type: int  default: 0
  --lazy-new-space-shrinking (Enables the lazy new space shrinking strategy)
        type: bool  default: false
  --min-semi-space-size (min size of a semi-space (in MBytes), the new space consists of two semi-spaces)
        type: size_t  default: 0
  --max-semi-space-size (max size of a semi-space (in MBytes), the new space consists of two semi-spaces)
        type: size_t  default: 0
  --semi-space-growth-factor (factor by which to grow the new space)
        type: int  default: 2
  --max-old-space-size (max size of the old space (in Mbytes))
        type: size_t  default: 0
  --max-heap-size (max size of the heap (in Mbytes) both max_semi_space_size and max_old_space_size take precedence. All three flags cannot be specified at the same time.)
        type: size_t  default: 0
  --initial-heap-size (initial size of the heap (in Mbytes))
        type: size_t  default: 0
  --huge-max-old-generation-size (Increase max size of the old space to 4 GB for x64 systems withthe physical memory bigger than 16 GB)
        type: bool  default: true
  --initial-old-space-size (initial old space size (in Mbytes))
        type: size_t  default: 0
  --global-gc-scheduling (enable GC scheduling based on global memory)
        type: bool  default: true
  --gc-global (always perform global GCs)
        type: bool  default: false
  --random-gc-interval (Collect garbage after random(0, X) allocations. It overrides gc_interval.)
        type: int  default: 0
  --gc-interval (garbage collect after &lt;n&gt; allocations)
        type: int  default: -1
  --retain-maps-for-n-gc (keeps maps alive for &lt;n&gt; old space garbage collections)
        type: int  default: 2
  --trace-gc (print one trace line following each garbage collection)
        type: bool  default: false
  --trace-gc-nvp (print one detailed trace line in name=value format after each garbage collection)
        type: bool  default: false
  --trace-gc-ignore-scavenger (do not print trace line after scavenger collection)
        type: bool  default: false
  --trace-idle-notification (print one trace line following each idle notification)
        type: bool  default: false
  --trace-idle-notification-verbose (prints the heap state used by the idle notification)
        type: bool  default: false
  --trace-gc-verbose (print more details following each garbage collection)
        type: bool  default: false
  --trace-gc-freelists (prints details of each freelist before and after each major garbage collection)
        type: bool  default: false
  --trace-gc-freelists-verbose (prints details of freelists of each page before and after each major garbage collection)
        type: bool  default: false
  --trace-evacuation-candidates (Show statistics about the pages evacuation by the compaction)
        type: bool  default: false
  --trace-allocations-origins (Show statistics about the origins of allocations. Combine with --no-inline-new to track allocations from generated code)
        type: bool  default: false
  --trace-allocation-stack-interval (print stack trace after &lt;n&gt; free-list allocations)
        type: int  default: -1
  --trace-duplicate-threshold-kb (print duplicate objects in the heap if their size is more than given threshold)
        type: int  default: 0
  --trace-fragmentation (report fragmentation for old space)
        type: bool  default: false
  --trace-fragmentation-verbose (report fragmentation for old space (detailed))
        type: bool  default: false
  --minor-mc-trace-fragmentation (trace fragmentation after marking)
        type: bool  default: false
  --trace-evacuation (report evacuation statistics)
        type: bool  default: false
  --trace-mutator-utilization (print mutator utilization, allocation speed, gc speed)
        type: bool  default: false
  --incremental-marking (use incremental marking)
        type: bool  default: true
  --incremental-marking-wrappers (use incremental marking for marking wrappers)
        type: bool  default: true
  --incremental-marking-task (use tasks for incremental marking)
        type: bool  default: true
  --incremental-marking-soft-trigger (threshold for starting incremental marking via a task in percent of available space: limit - size)
        type: int  default: 0
  --incremental-marking-hard-trigger (threshold for starting incremental marking immediately in percent of available space: limit - size)
        type: int  default: 0
  --trace-unmapper (Trace the unmapping)
        type: bool  default: false
  --parallel-scavenge (parallel scavenge)
        type: bool  default: true
  --scavenge-task (schedule scavenge tasks)
        type: bool  default: true
  --scavenge-task-trigger (scavenge task trigger in percent of the current heap limit)
        type: int  default: 80
  --scavenge-separate-stack-scanning (use a separate phase for stack scanning in scavenge)
        type: bool  default: false
  --trace-parallel-scavenge (trace parallel scavenge)
        type: bool  default: false
  --write-protect-code-memory (write protect code memory)
        type: bool  default: true
  --concurrent-marking (use concurrent marking)
        type: bool  default: true
  --concurrent-array-buffer-sweeping (concurrently sweep array buffers)
        type: bool  default: true
  --concurrent-allocation (concurrently allocate in old space)
        type: bool  default: false
  --local-heaps (allow heap access from background tasks)
        type: bool  default: false
  --stress-concurrent-allocation (start background threads that allocate memory)
        type: bool  default: false
  --parallel-marking (use parallel marking in atomic pause)
        type: bool  default: true
  --ephemeron-fixpoint-iterations (number of fixpoint iterations it takes to switch to linear ephemeron algorithm)
        type: int  default: 10
  --trace-concurrent-marking (trace concurrent marking)
        type: bool  default: false
  --concurrent-store-buffer (use concurrent store buffer processing)
        type: bool  default: true
  --concurrent-sweeping (use concurrent sweeping)
        type: bool  default: true
  --parallel-compaction (use parallel compaction)
        type: bool  default: true
  --parallel-pointer-update (use parallel pointer update during compaction)
        type: bool  default: true
  --detect-ineffective-gcs-near-heap-limit (trigger out-of-memory failure to avoid GC storm near heap limit)
        type: bool  default: true
  --trace-incremental-marking (trace progress of the incremental marking)
        type: bool  default: false
  --trace-stress-marking (trace stress marking progress)
        type: bool  default: false
  --trace-stress-scavenge (trace stress scavenge progress)
        type: bool  default: false
  --track-gc-object-stats (track object counts and memory usage)
        type: bool  default: false
  --trace-gc-object-stats (trace object counts and memory usage)
        type: bool  default: false
  --trace-zone-stats (trace zone memory usage)
        type: bool  default: false
  --zone-stats-tolerance (report a tick only when allocated zone memory changes by this amount)
        type: size_t  default: 1048576
  --track-retaining-path (enable support for tracking retaining path)
        type: bool  default: false
  --concurrent-array-buffer-freeing (free array buffer allocations on a background thread)
        type: bool  default: true
  --gc-stats (Used by tracing internally to enable gc statistics)
        type: int  default: 0
  --track-detached-contexts (track native contexts that are expected to be garbage collected)
        type: bool  default: true
  --trace-detached-contexts (trace native contexts that are expected to be garbage collected)
        type: bool  default: false
  --move-object-start (enable moving of object starts)
        type: bool  default: true
  --memory-reducer (use memory reducer)
        type: bool  default: true
  --memory-reducer-for-small-heaps (use memory reducer for small heaps)
        type: bool  default: true
  --heap-growing-percent (specifies heap growing factor as (1 + heap_growing_percent/100))
        type: int  default: 0
  --v8-os-page-size (override OS page size (in KBytes))
        type: int  default: 0
  --always-compact (Perform compaction on every full GC)
        type: bool  default: false
  --never-compact (Never perform compaction on full GC - testing only)
        type: bool  default: false
  --compact-code-space (Compact code space on full collections)
        type: bool  default: true
  --flush-bytecode (flush of bytecode when it has not been executed recently)
        type: bool  default: true
  --stress-flush-bytecode (stress bytecode flushing)
        type: bool  default: false
  --use-marking-progress-bar (Use a progress bar to scan large objects in increments when incremental marking is active.)
        type: bool  default: true
  --stress-per-context-marking-worklist (Use per-context worklist for marking)
        type: bool  default: false
  --force-marking-deque-overflows (force overflows of marking deque by reducing it's size to 64 words)
        type: bool  default: false
  --stress-compaction (stress the GC compactor to flush out bugs (implies --force_marking_deque_overflows))
        type: bool  default: false
  --stress-compaction-random (Stress GC compaction by selecting random percent of pages as evacuation candidates. It overrides stress_compaction.)
        type: bool  default: false
  --stress-incremental-marking (force incremental marking for small heaps and run it more often)
        type: bool  default: false
  --fuzzer-gc-analysis (prints number of allocations and enables analysis mode for gc fuzz testing, e.g. --stress-marking, --stress-scavenge)
        type: bool  default: false
  --stress-marking (force marking at random points between 0 and X (inclusive) percent of the regular marking start limit)
        type: int  default: 0
  --stress-scavenge (force scavenge at random points between 0 and X (inclusive) percent of the new space capacity)
        type: int  default: 0
  --gc-experiment-background-schedule (new background GC schedule heuristics)
        type: bool  default: false
  --gc-experiment-less-compaction (less compaction in non-memory reducing mode)
        type: bool  default: false
  --disable-abortjs (disables AbortJS runtime function)
        type: bool  default: false
  --randomize-all-allocations (randomize virtual memory reservations by ignoring any hints passed when allocating pages)
        type: bool  default: false
  --manual-evacuation-candidates-selection (Test mode only flag. It allows an unit test to select evacuation candidates pages (requires --stress_compaction).)
        type: bool  default: false
  --fast-promotion-new-space (fast promote new space on high survival rates)
        type: bool  default: false
  --clear-free-memory (initialize free memory with 0)
        type: bool  default: false
  --young-generation-large-objects (allocates large objects by default in the young generation large object space)
        type: bool  default: true
  --debug-code (generate extra code (assertions) for debugging)
        type: bool  default: false
  --code-comments (emit comments in code disassembly; for more readable source positions you should add --no-concurrent_recompilation)
        type: bool  default: false
  --enable-sse3 (enable use of SSE3 instructions if available)
        type: bool  default: true
  --enable-ssse3 (enable use of SSSE3 instructions if available)
        type: bool  default: true
  --enable-sse4-1 (enable use of SSE4.1 instructions if available)
        type: bool  default: true
  --enable-sse4-2 (enable use of SSE4.2 instructions if available)
        type: bool  default: true
  --enable-sahf (enable use of SAHF instruction if available (X64 only))
        type: bool  default: true
  --enable-avx (enable use of AVX instructions if available)
        type: bool  default: true
  --enable-fma3 (enable use of FMA3 instructions if available)
        type: bool  default: true
  --enable-bmi1 (enable use of BMI1 instructions if available)
        type: bool  default: true
  --enable-bmi2 (enable use of BMI2 instructions if available)
        type: bool  default: true
  --enable-lzcnt (enable use of LZCNT instruction if available)
        type: bool  default: true
  --enable-popcnt (enable use of POPCNT instruction if available)
        type: bool  default: true
  --arm-arch (generate instructions for the selected ARM architecture if available: armv6, armv7, armv7+sudiv or armv8)
        type: string  default: armv8
  --force-long-branches (force all emitted branches to be in long mode (MIPS/PPC only))
        type: bool  default: false
  --mcpu (enable optimization for specific cpu)
        type: string  default: auto
  --partial-constant-pool (enable use of partial constant pools (X64 only))
        type: bool  default: true
  --sim-arm64-optional-features (enable optional features on the simulator for testing: none or all)
        type: string  default: none
  --enable-source-at-csa-bind (Include source information in the binary at CSA bind locations.)
        type: bool  default: false
  --enable-armv7 (deprecated (use --arm_arch instead))
        type: maybe_bool  default: unset
  --enable-vfp3 (deprecated (use --arm_arch instead))
        type: maybe_bool  default: unset
  --enable-32dregs (deprecated (use --arm_arch instead))
        type: maybe_bool  default: unset
  --enable-neon (deprecated (use --arm_arch instead))
        type: maybe_bool  default: unset
  --enable-sudiv (deprecated (use --arm_arch instead))
        type: maybe_bool  default: unset
  --enable-armv8 (deprecated (use --arm_arch instead))
        type: maybe_bool  default: unset
  --enable-regexp-unaligned-accesses (enable unaligned accesses for the regexp engine)
        type: bool  default: true
  --script-streaming (enable parsing on background)
        type: bool  default: true
  --stress-background-compile (stress test parsing on background)
        type: bool  default: false
  --finalize-streaming-on-background (perform the script streaming finalization on the background thread)
        type: bool  default: false
  --disable-old-api-accessors (Disable old-style API accessors whose setters trigger through the prototype chain)
        type: bool  default: false
  --expose-gc (expose gc extension)
        type: bool  default: false
  --expose-gc-as (expose gc extension under the specified name)
        type: string  default: nullptr
  --expose-externalize-string (expose externalize string extension)
        type: bool  default: false
  --expose-trigger-failure (expose trigger-failure extension)
        type: bool  default: false
  --stack-trace-limit (number of stack frames to capture)
        type: int  default: 10
  --builtins-in-stack-traces (show built-in functions in stack traces)
        type: bool  default: false
  --experimental-stack-trace-frames (enable experimental frames (API/Builtins) and stack trace layout)
        type: bool  default: false
  --disallow-code-generation-from-strings (disallow eval and friends)
        type: bool  default: false
  --expose-async-hooks (expose async_hooks object)
        type: bool  default: false
  --expose-cputracemark-as (expose cputracemark extension under the specified name)
        type: string  default: nullptr
  --allow-unsafe-function-constructor (allow invoking the function constructor without security checks)
        type: bool  default: false
  --force-slow-path (always take the slow path for builtins)
        type: bool  default: false
  --test-small-max-function-context-stub-size (enable testing the function context size overflow path by making the maximum size smaller)
        type: bool  default: false
  --inline-new (use fast inline allocation)
        type: bool  default: true
  --trace (trace javascript function calls)
        type: bool  default: false
  --trace-wasm (trace wasm function calls)
        type: bool  default: false
  --lazy (use lazy compilation)
        type: bool  default: true
  --max-lazy (ignore eager compilation hints)
        type: bool  default: false
  --trace-opt (trace lazy optimization)
        type: bool  default: false
  --trace-opt-verbose (extra verbose compilation tracing)
        type: bool  default: false
  --trace-opt-stats (trace lazy optimization statistics)
        type: bool  default: false
  --trace-deopt (trace optimize function deoptimization)
        type: bool  default: false
  --trace-file-names (include file names in trace-opt/trace-deopt output)
        type: bool  default: false
  --always-opt (always try to optimize functions)
        type: bool  default: false
  --always-osr (always try to OSR functions)
        type: bool  default: false
  --prepare-always-opt (prepare for turning on always opt)
        type: bool  default: false
  --trace-serializer (print code serializer trace)
        type: bool  default: false
  --compilation-cache (enable compilation cache)
        type: bool  default: true
  --cache-prototype-transitions (cache prototype transitions)
        type: bool  default: true
  --parallel-compile-tasks (enable parallel compile tasks)
        type: bool  default: false
  --compiler-dispatcher (enable compiler dispatcher)
        type: bool  default: false
  --trace-compiler-dispatcher (trace compiler dispatcher activity)
        type: bool  default: false
  --cpu-profiler-sampling-interval (CPU profiler sampling interval in microseconds)
        type: int  default: 1000
  --trace-side-effect-free-debug-evaluate (print debug messages for side-effect-free debug-evaluate for testing)
        type: bool  default: false
  --hard-abort (abort by crashing)
        type: bool  default: true
  --expose-inspector-scripts (expose injected-script-source.js for debugging)
        type: bool  default: false
  --stack-size (default size of stack region v8 is allowed to use (in kBytes))
        type: int  default: 984
  --max-stack-trace-source-length (maximum length of function source code printed in a stack trace.)
        type: int  default: 300
  --clear-exceptions-on-js-entry (clear pending exceptions when entering JavaScript)
        type: bool  default: false
  --histogram-interval (time interval in ms for aggregating memory histograms)
        type: int  default: 600000
  --heap-profiler-trace-objects (Dump heap object allocations/movements/size_updates)
        type: bool  default: false
  --heap-profiler-use-embedder-graph (Use the new EmbedderGraph API to get embedder nodes)
        type: bool  default: true
  --heap-snapshot-string-limit (truncate strings to this length in the heap snapshot)
        type: int  default: 1024
  --sampling-heap-profiler-suppress-randomness (Use constant sample intervals to eliminate test flakiness)
        type: bool  default: false
  --use-idle-notification (Use idle notification to reduce memory footprint.)
        type: bool  default: true
  --trace-ic (trace inline cache state transitions for tools/ic-processor)
        type: bool  default: false
  --modify-field-representation-inplace (enable in-place field representation updates)
        type: bool  default: true
  --max-polymorphic-map-count (maximum number of maps to track in POLYMORPHIC state)
        type: int  default: 4
  --native-code-counters (generate extra code for manipulating stats counters)
        type: bool  default: false
  --thin-strings (Enable ThinString support)
        type: bool  default: true
  --trace-prototype-users (Trace updates to prototype user tracking)
        type: bool  default: false
  --trace-for-in-enumerate (Trace for-in enumerate slow-paths)
        type: bool  default: false
  --trace-maps (trace map creation)
        type: bool  default: false
  --trace-maps-details (also log map details)
        type: bool  default: true
  --allow-natives-syntax (allow natives syntax)
        type: bool  default: false
  --allow-natives-for-differential-fuzzing (allow only natives explicitly allowlisted for differential fuzzers)
        type: bool  default: false
  --parse-only (only parse the sources)
        type: bool  default: false
  --trace-sim (Trace simulator execution)
        type: bool  default: false
  --debug-sim (Enable debugging the simulator)
        type: bool  default: false
  --check-icache (Check icache flushes in ARM and MIPS simulator)
        type: bool  default: false
  --stop-sim-at (Simulator stop after x number of instructions)
        type: int  default: 0
  --sim-stack-alignment (Stack alingment in bytes in simulator (4 or 8, 8 is default))
        type: int  default: 8
  --sim-stack-size (Stack size of the ARM64, MIPS64 and PPC64 simulator in kBytes (default is 2 MB))
        type: int  default: 2048
  --log-colour (When logging, try to use coloured output.)
        type: bool  default: true
  --trace-sim-messages (Trace simulator debug messages. Implied by --trace-sim.)
        type: bool  default: false
  --async-stack-traces (include async stack traces in Error.stack)
        type: bool  default: true
  --stack-trace-on-illegal (print stack trace when an illegal exception is thrown)
        type: bool  default: false
  --abort-on-uncaught-exception (abort program (dump core) when an uncaught exception is thrown)
        type: bool  default: false
  --correctness-fuzzer-suppressions (Suppress certain unspecified behaviors to ease correctness fuzzing: Abort program when the stack overflows or a string exceeds maximum length (as opposed to throwing RangeError). Use a fixed suppression string for error messages.)
        type: bool  default: false
  --randomize-hashes (randomize hashes to avoid predictable hash collisions (with snapshots this option cannot override the baked-in seed))
        type: bool  default: true
  --rehash-snapshot (rehash strings from the snapshot to override the baked-in seed)
        type: bool  default: true
  --hash-seed (Fixed seed to use to hash property keys (0 means random)(with snapshots this option cannot override the baked-in seed))
        type: uint64  default: 0
  --random-seed (Default seed for initializing random generator (0, the default, means to use system random).)
        type: int  default: 0
  --fuzzer-random-seed (Default seed for initializing fuzzer random generator (0, the default, means to use v8's random number generator seed).)
        type: int  default: 0
  --trace-rail (trace RAIL mode)
        type: bool  default: false
  --print-all-exceptions (print exception object and stack trace on each thrown exception)
        type: bool  default: false
  --detailed-error-stack-trace (includes arguments for each function call in the error stack frames array)
        type: bool  default: false
  --adjust-os-scheduling-parameters (adjust OS specific scheduling params for the isolate)
        type: bool  default: true
  --runtime-call-stats (report runtime call counts and times)
        type: bool  default: false
  --rcs (report runtime call counts and times)
        type: bool  default: false
  --rcs-cpu-time (report runtime times in cpu time (the default is wall time))
        type: bool  default: false
  --profile-deserialization (Print the time it takes to deserialize the snapshot.)
        type: bool  default: false
  --serialization-statistics (Collect statistics on serialized objects.)
        type: bool  default: false
  --serialization-chunk-size (Custom size for serialization chunks)
        type: uint  default: 4096
  --regexp-optimization (generate optimized regexp code)
        type: bool  default: true
  --regexp-mode-modifiers (enable inline flags in regexp.)
        type: bool  default: false
  --regexp-interpret-all (interpret all regexp code)
        type: bool  default: false
  --regexp-tier-up (enable regexp interpreter and tier up to the compiler after the number of executions set by the tier up ticks flag)
        type: bool  default: true
  --regexp-tier-up-ticks (set the number of executions for the regexp interpreter before tiering-up to the compiler)
        type: int  default: 1
  --regexp-peephole-optimization (enable peephole optimization for regexp bytecode)
        type: bool  default: true
  --trace-regexp-peephole-optimization (trace regexp bytecode peephole optimization)
        type: bool  default: false
  --trace-regexp-bytecodes (trace regexp bytecode execution)
        type: bool  default: false
  --trace-regexp-assembler (trace regexp macro assembler calls.)
        type: bool  default: false
  --trace-regexp-parser (trace regexp parsing)
        type: bool  default: false
  --trace-regexp-tier-up (trace regexp tiering up execution)
        type: bool  default: false
  --testing-bool-flag (testing_bool_flag)
        type: bool  default: true
  --testing-maybe-bool-flag (testing_maybe_bool_flag)
        type: maybe_bool  default: unset
  --testing-int-flag (testing_int_flag)
        type: int  default: 13
  --testing-float-flag (float-flag)
        type: float  default: 2.5
  --testing-string-flag (string-flag)
        type: string  default: Hello, world!
  --testing-prng-seed (Seed used for threading test randomness)
        type: int  default: 42
  --testing-d8-test-runner (test runner turns on this flag to enable a check that the function was prepared for optimization before marking it for optimization)
        type: bool  default: false
  --fuzzing (Fuzzers use this flag to signal that they are ... fuzzing. This causes intrinsics to fail silently (e.g. return undefined) on invalid usage.)
        type: bool  default: false
  --embedded-src (Path for the generated embedded data file. (mksnapshot only))
        type: string  default: nullptr
  --embedded-variant (Label to disambiguate symbols in embedded data file. (mksnapshot only))
        type: string  default: nullptr
  --startup-src (Write V8 startup as C++ src. (mksnapshot only))
        type: string  default: nullptr
  --startup-blob (Write V8 startup blob file. (mksnapshot only))
        type: string  default: nullptr
  --target-arch (The mksnapshot target arch. (mksnapshot only))
        type: string  default: nullptr
  --target-os (The mksnapshot target os. (mksnapshot only))
        type: string  default: nullptr
  --target-is-simulator (Instruct mksnapshot that the target is meant to run in the simulator and it can generate simulator-specific instructions. (mksnapshot only))
        type: bool  default: false
  --minor-mc-parallel-marking (use parallel marking for the young generation)
        type: bool  default: true
  --trace-minor-mc-parallel-marking (trace parallel marking for the young generation)
        type: bool  default: false
  --minor-mc (perform young generation mark compact GCs)
        type: bool  default: false
  --help (Print usage message, including flags, on console)
        type: bool  default: true
  --dump-counters (Dump counters on exit)
        type: bool  default: false
  --dump-counters-nvp (Dump counters as name-value pairs on exit)
        type: bool  default: false
  --use-external-strings (Use external strings for source code)
        type: bool  default: false
  --map-counters (Map counters to a file)
        type: string  default:
  --mock-arraybuffer-allocator (Use a mock ArrayBuffer allocator for testing.)
        type: bool  default: false
  --mock-arraybuffer-allocator-limit (Memory limit for mock ArrayBuffer allocator used to simulate OOM for testing.)
        type: size_t  default: 0
  --gdbjit (enable GDBJIT interface)
        type: bool  default: false
  --gdbjit-full (enable GDBJIT interface for all code objects)
        type: bool  default: false
  --gdbjit-dump (dump elf objects with debug info to disk)
        type: bool  default: false
  --gdbjit-dump-filter (dump only objects containing this substring)
        type: string  default:
  --log (Minimal logging (no API, code, GC, suspect, or handles samples).)
        type: bool  default: false
  --log-all (Log all events to the log file.)
        type: bool  default: false
  --log-api (Log API events to the log file.)
        type: bool  default: false
  --log-code (Log code events to the log file without profiling.)
        type: bool  default: false
  --log-handles (Log global handle events.)
        type: bool  default: false
  --log-suspect (Log suspect operations.)
        type: bool  default: false
  --log-source-code (Log source code.)
        type: bool  default: false
  --log-function-events (Log function events (parse, compile, execute) separately.)
        type: bool  default: false
  --prof (Log statistical profiling information (implies --log-code).)
        type: bool  default: false
  --detailed-line-info (Always generate detailed line information for CPU profiling.)
        type: bool  default: false
  --prof-sampling-interval (Interval for --prof samples (in microseconds).)
        type: int  default: 1000
  --prof-cpp (Like --prof, but ignore generated code.)
        type: bool  default: false
  --prof-browser-mode (Used with --prof, turns on browser-compatible mode for profiling.)
        type: bool  default: true
  --logfile (Specify the name of the log file.)
        type: string  default: v8.log
  --logfile-per-isolate (Separate log files for each isolate.)
        type: bool  default: true
  --ll-prof (Enable low-level linux profiler.)
        type: bool  default: false
  --gc-fake-mmap (Specify the name of the file for fake gc mmap used in ll_prof)
        type: string  default: /tmp/__v8_gc__
  --log-internal-timer-events (Time internal events.)
        type: bool  default: false
  --redirect-code-traces (output deopt information and disassembly into file code-&lt;pid&gt;-&lt;isolate id&gt;.asm)
        type: bool  default: false
  --redirect-code-traces-to (output deopt information and disassembly into the given file)
        type: string  default: nullptr
  --print-opt-source (print source code of optimized and inlined functions)
        type: bool  default: false
  --vtune-prof-annotate-wasm (Used when v8_enable_vtunejit is enabled, load wasm source map and provide annotate support (experimental).)
        type: bool  default: false
  --win64-unwinding-info (Enable unwinding info for Windows/x64)
        type: bool  default: true
  --interpreted-frames-native-stack (Show interpreted frames on the native stack (useful for external profilers).)
        type: bool  default: false
  --predictable (enable predictable mode)
        type: bool  default: false
  --predictable-gc-schedule (Predictable garbage collection schedule. Fixes heap growing, idle, and memory reducing behavior.)
        type: bool  default: false
  --single-threaded (disable the use of background tasks)
        type: bool  default: false
  --single-threaded-gc (disable the use of background gc tasks)
        type: bool  default: false
</code></pre>
<p>Particularly useful ones:</p>
<pre><code>--async-stack-trace
</code></pre>
<h3><a class="header" href="#continuous-benchmarks" id="continuous-benchmarks">Continuous Benchmarks</a></h3>
<p>See our benchmarks <a href="https://deno.land/benchmarks">over here</a></p>
<p>The benchmark chart supposes
https://github.com/denoland/benchmark_data/blob/gh-pages/data.json has the type
<code>BenchmarkData[]</code> where <code>BenchmarkData</code> is defined like the below:</p>
<pre><code class="language-ts">interface ExecTimeData {
  mean: number;
  stddev: number;
  user: number;
  system: number;
  min: number;
  max: number;
}

interface BenchmarkData {
  created_at: string;
  sha1: string;
  benchmark: {
    [key: string]: ExecTimeData;
  };
  binarySizeData: {
    [key: string]: number;
  };
  threadCountData: {
    [key: string]: number;
  };
  syscallCountData: {
    [key: string]: number;
  };
}
</code></pre>
<h1><a class="header" href="#deno-style-guide" id="deno-style-guide">Deno Style Guide</a></h1>
<h2><a class="header" href="#table-of-contents" id="table-of-contents">Table of Contents</a></h2>
<h2><a class="header" href="#copyright-headers" id="copyright-headers">Copyright Headers</a></h2>
<p>Most modules in the repository should have the following copyright header:</p>
<pre><code class="language-ts">// Copyright 2018-2020 the Deno authors. All rights reserved. MIT license.
</code></pre>
<p>If the code originates elsewhere, ensure that the file has the proper copyright
headers. We only allow MIT, BSD, and Apache licensed code.</p>
<h2><a class="header" href="#use-underscores-not-dashes-in-filenames" id="use-underscores-not-dashes-in-filenames">Use underscores, not dashes in filenames.</a></h2>
<p>Example: Use <code>file_server.ts</code> instead of <code>file-server.ts</code>.</p>
<h2><a class="header" href="#add-tests-for-new-features" id="add-tests-for-new-features">Add tests for new features.</a></h2>
<p>Each module should contain or be accompanied by tests for its public
functionality.</p>
<h2><a class="header" href="#todo-comments" id="todo-comments">TODO Comments</a></h2>
<p>TODO comments should usually include an issue or the author's github username in
parentheses. Example:</p>
<pre><code class="language-ts">// TODO(ry): Add tests.
// TODO(#123): Support Windows.
// FIXME(#349): Sometimes panics.
</code></pre>
<h2><a class="header" href="#meta-programming-is-discouraged-including-the-use-of-proxy" id="meta-programming-is-discouraged-including-the-use-of-proxy">Meta-programming is discouraged. Including the use of Proxy.</a></h2>
<p>Be explicit even when it means more code.</p>
<p>There are some situations where it may make sense to use such techniques, but in
the vast majority of cases it does not.</p>
<h2><a class="header" href="#inclusive-code" id="inclusive-code">Inclusive code</a></h2>
<p>Please follow the guidelines for inclusive code outlined at
https://chromium.googlesource.com/chromium/src/+/master/styleguide/inclusive_code.md.</p>
<h2><a class="header" href="#rust" id="rust">Rust</a></h2>
<p>Follow Rust conventions and be consistent with existing code.</p>
<h2><a class="header" href="#typescript" id="typescript">Typescript</a></h2>
<p>The TypeScript portions of the codebase include <code>cli/js</code> for the built-ins and
the standard library <code>std</code>.</p>
<h3><a class="header" href="#use-typescript-instead-of-javascript" id="use-typescript-instead-of-javascript">Use TypeScript instead of JavaScript.</a></h3>
<h3><a class="header" href="#use-the-term-module-instead-of-library-or-package" id="use-the-term-module-instead-of-library-or-package">Use the term &quot;module&quot; instead of &quot;library&quot; or &quot;package&quot;.</a></h3>
<p>For clarity and consistency avoid the terms &quot;library&quot; and &quot;package&quot;. Instead use
&quot;module&quot; to refer to a single JS or TS file and also to refer to a directory of
TS/JS code.</p>
<h3><a class="header" href="#do-not-use-the-filename-indextsindexjs" id="do-not-use-the-filename-indextsindexjs">Do not use the filename <code>index.ts</code>/<code>index.js</code>.</a></h3>
<p>Deno does not treat &quot;index.js&quot; or &quot;index.ts&quot; in a special way. By using these
filenames, it suggests that they can be left out of the module specifier when
they cannot. This is confusing.</p>
<p>If a directory of code needs a default entry point, use the filename <code>mod.ts</code>.
The filename <code>mod.ts</code> follows Rust’s convention, is shorter than <code>index.ts</code>, and
doesn’t come with any preconceived notions about how it might work.</p>
<h3><a class="header" href="#exported-functions-max-2-args-put-the-rest-into-an-options-object" id="exported-functions-max-2-args-put-the-rest-into-an-options-object">Exported functions: max 2 args, put the rest into an options object.</a></h3>
<p>When designing function interfaces, stick to the following rules.</p>
<ol>
<li>
<p>A function that is part of the public API takes 0-2 required arguments, plus
(if necessary) an options object (so max 3 total).</p>
</li>
<li>
<p>Optional parameters should generally go into the options object.</p>
<p>An optional parameter that's not in an options object might be acceptable if
there is only one, and it seems inconceivable that we would add more optional
parameters in the future.</p>
</li>
<li>
<p>The 'options' argument is the only argument that is a regular 'Object'.</p>
<p>Other arguments can be objects, but they must be distinguishable from a
'plain' Object runtime, by having either:</p>
<ul>
<li>a distinguishing prototype (e.g. <code>Array</code>, <code>Map</code>, <code>Date</code>, <code>class MyThing</code>)</li>
<li>a well-known symbol property (e.g. an iterable with <code>Symbol.iterator</code>).</li>
</ul>
<p>This allows the API to evolve in a backwards compatible way, even when the
position of the options object changes.</p>
</li>
</ol>
<pre><code class="language-ts">// BAD: optional parameters not part of options object. (#2)
export function resolve(
  hostname: string,
  family?: &quot;ipv4&quot; | &quot;ipv6&quot;,
  timeout?: number,
): IPAddress[] {}

// GOOD.
export interface ResolveOptions {
  family?: &quot;ipv4&quot; | &quot;ipv6&quot;;
  timeout?: number;
}
export function resolve(
  hostname: string,
  options: ResolveOptions = {},
): IPAddress[] {}
</code></pre>
<pre><code class="language-ts">export interface Environment {
  [key: string]: string;
}

// BAD: `env` could be a regular Object and is therefore indistinguishable
// from an options object. (#3)
export function runShellWithEnv(cmdline: string, env: Environment): string {}

// GOOD.
export interface RunShellOptions {
  env: Environment;
}
export function runShellWithEnv(
  cmdline: string,
  options: RunShellOptions,
): string {}
</code></pre>
<pre><code class="language-ts">// BAD: more than 3 arguments (#1), multiple optional parameters (#2).
export function renameSync(
  oldname: string,
  newname: string,
  replaceExisting?: boolean,
  followLinks?: boolean,
) {}

// GOOD.
interface RenameOptions {
  replaceExisting?: boolean;
  followLinks?: boolean;
}
export function renameSync(
  oldname: string,
  newname: string,
  options: RenameOptions = {},
) {}
</code></pre>
<pre><code class="language-ts">// BAD: too many arguments. (#1)
export function pwrite(
  fd: number,
  buffer: TypedArray,
  offset: number,
  length: number,
  position: number,
) {}

// BETTER.
export interface PWrite {
  fd: number;
  buffer: TypedArray;
  offset: number;
  length: number;
  position: number;
}
export function pwrite(options: PWrite) {}
</code></pre>
<h3><a class="header" href="#minimize-dependencies-do-not-make-circular-imports" id="minimize-dependencies-do-not-make-circular-imports">Minimize dependencies; do not make circular imports.</a></h3>
<p>Although <code>cli/js</code> and <code>std</code> have no external dependencies, we must still be
careful to keep internal dependencies simple and manageable. In particular, be
careful not to introduce circular imports.</p>
<h3><a class="header" href="#if-a-filename-starts-with-an-underscore-_foots-do-not-link-to-it" id="if-a-filename-starts-with-an-underscore-_foots-do-not-link-to-it">If a filename starts with an underscore: <code>_foo.ts</code>, do not link to it.</a></h3>
<p>Sometimes there may be situations where an internal module is necessary but its
API is not meant to be stable or linked to. In this case prefix it with an
underscore. By convention, only files in its own directory should import it.</p>
<h3><a class="header" href="#use-jsdoc-for-exported-symbols" id="use-jsdoc-for-exported-symbols">Use JSDoc for exported symbols.</a></h3>
<p>We strive for complete documentation. Every exported symbol ideally should have
a documentation line.</p>
<p>If possible, use a single line for the JS Doc. Example:</p>
<pre><code class="language-ts">/** foo does bar. */
export function foo() {
  // ...
}
</code></pre>
<p>It is important that documentation is easily human readable, but there is also a
need to provide additional styling information to ensure generated documentation
is more rich text. Therefore JSDoc should generally follow markdown markup to
enrich the text.</p>
<p>While markdown supports HTML tags, it is forbidden in JSDoc blocks.</p>
<p>Code string literals should be braced with the back-tick (`) instead of quotes.
For example:</p>
<pre><code class="language-ts">/** Import something from the `deno` module. */
</code></pre>
<p>Do not document function arguments unless they are non-obvious of their intent
(though if they are non-obvious intent, the API should be considered anyways).
Therefore <code>@param</code> should generally not be used. If <code>@param</code> is used, it should
not include the <code>type</code> as TypeScript is already strongly typed.</p>
<pre><code class="language-ts">/**
 * Function with non obvious param.
 * @param foo Description of non obvious parameter.
 */
</code></pre>
<p>Vertical spacing should be minimized whenever possible. Therefore single line
comments should be written as:</p>
<pre><code class="language-ts">/** This is a good single line JSDoc. */
</code></pre>
<p>And not</p>
<pre><code class="language-ts">/**
 * This is a bad single line JSDoc.
 */
</code></pre>
<p>Code examples should not utilise the triple-back tick (```) notation or tags.
They should just be marked by indentation, which requires a break before the
block and 6 additional spaces for each line of the example. This is 4 more than
the first column of the comment. For example:</p>
<pre><code class="language-ts">/** A straight forward comment and an example:
 *
 *       import { foo } from &quot;deno&quot;;
 *       foo(&quot;bar&quot;);
 */
</code></pre>
<p>Code examples should not contain additional comments. It is already inside a
comment. If it needs further comments it is not a good example.</p>
<h3><a class="header" href="#each-module-should-come-with-a-test-module" id="each-module-should-come-with-a-test-module">Each module should come with a test module.</a></h3>
<p>Every module with public functionality <code>foo.ts</code> should come with a test module
<code>foo_test.ts</code>. A test for a <code>cli/js</code> module should go in <code>cli/js/tests</code> due to
their different contexts, otherwise it should just be a sibling to the tested
module.</p>
<h3><a class="header" href="#unit-tests-should-be-explicit" id="unit-tests-should-be-explicit">Unit Tests should be explicit.</a></h3>
<p>For a better understanding of the tests, function should be correctly named as
its prompted throughout the test command. Like:</p>
<pre><code>test myTestFunction ... ok
</code></pre>
<p>Example of test:</p>
<pre><code class="language-ts">import { assertEquals } from &quot;https://deno.land/std@v0.11/testing/asserts.ts&quot;;
import { foo } from &quot;./mod.ts&quot;;

Deno.test(&quot;myTestFunction&quot; function() {
  assertEquals(foo(), { bar: &quot;bar&quot; });
});
</code></pre>
<h3><a class="header" href="#top-level-functions-should-not-use-arrow-syntax" id="top-level-functions-should-not-use-arrow-syntax">Top level functions should not use arrow syntax.</a></h3>
<p>Top level functions should use the <code>function</code> keyword. Arrow syntax should be
limited to closures.</p>
<p>Bad</p>
<pre><code class="language-ts">export const foo = (): string =&gt; {
  return &quot;bar&quot;;
};
</code></pre>
<p>Good</p>
<pre><code class="language-ts">export function foo(): string {
  return &quot;bar&quot;;
}
</code></pre>
<h3><a class="header" href="#std" id="std"><code>std</code></a></h3>
<h4><a class="header" href="#do-not-depend-on-external-code" id="do-not-depend-on-external-code">Do not depend on external code.</a></h4>
<p><code>https://deno.land/std/</code> is intended to be baseline functionality that all Deno
programs can rely on. We want to guarantee to users that this code does not
include potentially unreviewed third party code.</p>
<h4><a class="header" href="#document-and-maintain-browser-compatiblity" id="document-and-maintain-browser-compatiblity">Document and maintain browser compatiblity.</a></h4>
<p>If a module is browser compatible, include the following in the JSDoc at the top
of the module:</p>
<pre><code class="language-ts">/** This module is browser compatible. */
</code></pre>
<p>Maintain browser compatibility for such a module by either not using the global
<code>Deno</code> namespace or feature-testing for it. Make sure any new dependencies are
also browser compatible.</p>
<h2><a class="header" href="#internal-details" id="internal-details">Internal details</a></h2>
<h3><a class="header" href="#deno-and-linux-analogy" id="deno-and-linux-analogy">Deno and Linux analogy</a></h3>
<table><thead><tr><th align="right"><strong>Linux</strong></th><th align="left"><strong>Deno</strong></th></tr></thead><tbody>
<tr><td align="right">Processes</td><td align="left">Web Workers</td></tr>
<tr><td align="right">Syscalls</td><td align="left">Ops</td></tr>
<tr><td align="right">File descriptors (fd)</td><td align="left"><a href="contributing/architecture#resources">Resource ids (rid)</a></td></tr>
<tr><td align="right">Scheduler</td><td align="left">Tokio</td></tr>
<tr><td align="right">Userland: libc++ / glib / boost</td><td align="left">https://deno.land/std/</td></tr>
<tr><td align="right">/proc/$$/stat</td><td align="left"><a href="contributing/architecture#metrics">Deno.metrics()</a></td></tr>
<tr><td align="right">man pages</td><td align="left">deno types</td></tr>
</tbody></table>
<h4><a class="header" href="#resources" id="resources">Resources</a></h4>
<p>Resources (AKA <code>rid</code>) are Deno's version of file descriptors. They are integer
values used to refer to open files, sockets, and other concepts. For testing it
would be good to be able to query the system for how many open resources there
are.</p>
<pre><code class="language-ts">console.log(Deno.resources());
// { 0: &quot;stdin&quot;, 1: &quot;stdout&quot;, 2: &quot;stderr&quot; }
Deno.close(0);
console.log(Deno.resources());
// { 1: &quot;stdout&quot;, 2: &quot;stderr&quot; }
</code></pre>
<h4><a class="header" href="#metrics" id="metrics">Metrics</a></h4>
<p>Metrics is Deno's internal counter for various statistics.</p>
<pre><code class="language-shell">&gt; console.table(Deno.metrics())
┌──────────────────┬────────┐
│     (index)      │ Values │
├──────────────────┼────────┤
│  opsDispatched   │   9    │
│   opsCompleted   │   9    │
│ bytesSentControl │  504   │
│  bytesSentData   │   0    │
│  bytesReceived   │  856   │
└──────────────────┴────────┘
</code></pre>
<h3><a class="header" href="#schematic-diagram" id="schematic-diagram">Schematic diagram</a></h3>
<p><img src="https://deno.land/images/schematic_v0.2.png" alt="architectural schematic" /></p>
<h1><a class="header" href="#例" id="例">例</a></h1>
<p>この章では、ランタイムの詳細を学習するために使用できるいくつかのサンプルプログラムを見つけることができます。</p>
<h2><a class="header" href="#ベーシック" id="ベーシック">ベーシック</a></h2>
<ul>
<li><a href="./examples/hello_world">Hello World</a></li>
<li><a href="./examples/import_export">Import and Export Modules</a></li>
<li><a href="./examples/manage_dependencies">How to Manage Dependencies</a></li>
</ul>
<h2><a class="header" href="#アドバンス" id="アドバンス">アドバンス</a></h2>
<ul>
<li><a href="./examples/unix_cat">Unix Cat</a></li>
<li><a href="./examples/file_server">File Server</a></li>
<li><a href="./examples/tcp_echo">TCP Echo</a></li>
<li><a href="./examples/subprocess">Subprocess</a></li>
<li><a href="./examples/permissions">Permissions</a></li>
<li><a href="./examples/os_signals">OS Signals</a></li>
<li><a href="./examples/file_system_events">File System Events</a></li>
<li><a href="./examples/testing_if_main">Testing If Main</a></li>
</ul>
<h1><a class="header" href="#hello-world-1" id="hello-world-1">Hello World</a></h1>
<p>Denoは、JavaScriptとTypeScriptの両方の安全なランタイムです。以下のhello worldの例は、同じ機能をJavaScriptまたはTypeScriptで作成できることを示しているので、Denoは両方を実行します。</p>
<h2><a class="header" href="#javascript" id="javascript">JavaScript</a></h2>
<p>このJavaScriptの例では、メッセージ<code>Hello [name]</code>がコンソールに出力され、コードにより、提供された名前が大文字で使用されることが保証されます。</p>
<p><strong>Command：</strong> <code>deno run hello-world.js</code></p>
<pre><code class="language-js">function capitalize(word) {
  return word.charAt(0).toUpperCase() + word.slice(1);
}

function hello(name) {
  return &quot;Hello &quot; + capitalize(name);
}

console.log(hello(&quot;john&quot;));
console.log(hello(&quot;Sarah&quot;));
console.log(hello(&quot;kai&quot;));

/**
 * Output:
 *
 * Hello John
 * Hello Sarah
 * Hello Kai
**/
</code></pre>
<h2><a class="header" href="#typescript-1" id="typescript-1">TypeScript</a></h2>
<p>このTypeScriptの例は、上記のJavaScriptの例とまったく同じです。コードには、TypeScriptがサポートする追加の型情報が含まれています。</p>
<p><code>deno run</code>コマンドを使うのはまったく同じです。<code>*.js</code>ファイルではなく<code>*.ts</code>ファイルを参照するだけです。</p>
<p><strong>Command：</strong> <code>deno run hello-world.ts</code></p>
<pre><code class="language-ts">function capitalize(word: string): string {
  return word.charAt(0).toUpperCase() + word.slice(1);
}

function hello(name: string): string {
  return &quot;Hello &quot; + capitalize(name);
}

console.log(hello(&quot;john&quot;));
console.log(hello(&quot;Sarah&quot;));
console.log(hello(&quot;kai&quot;));

/**
 * Output:
 *
 * Hello John
 * Hello Sarah
 * Hello Kai
**/
</code></pre>
<h1><a class="header" href="#モジュールのインポートとエクスポート" id="モジュールのインポートとエクスポート">モジュールのインポートとエクスポート</a></h1>
<p>Denoはデフォルトで、JavaScriptとTypeScriptの両方でモジュールをインポートする方法を標準化しています。 ECMAScript 6の<code>インポート/エクスポート</code>標準に従いますが、注意点が1つあります。ファイルタイプはインポートステートメントの最後に含める必要があります。</p>
<pre><code class="language-js">import {
  add,
  multiply,
} from &quot;./arithmetic.ts&quot;;
</code></pre>
<p>依存関係も直接インポートされ、パッケージ管理のオーバーヘッドはありません。ローカルモジュールは、リモートモジュールとまったく同じ方法でインポートされます。以下の例に示すように、同じ機能をローカルモジュールまたはリモートモジュールを使用して同じ方法で作成できます。</p>
<h2><a class="header" href="#ローカルインポート" id="ローカルインポート">ローカルインポート</a></h2>
<p>この例では、<code>add</code>関数と<code>multiply</code>関数がローカルの<code>arithmetic.ts</code>モジュールからインポートされています。</p>
<p><strong>Command：</strong> <code>deno run local.ts</code></p>
<pre><code class="language-ts">import { add, multiply } from &quot;./arithmetic.ts&quot;;

function totalCost(outbound: number, inbound: number, tax: number): number {
  return multiply(add(outbound, inbound), tax);
}

console.log(totalCost(19, 31, 1.2));
console.log(totalCost(45, 27, 1.15));

/**
 * Output
 *
 * 60
 * 82.8
 */
</code></pre>
<h2><a class="header" href="#エクスポート" id="エクスポート">エクスポート</a></h2>
<p>上記の例では、<code>add</code>関数と<code>multiply</code>関数はローカルに保存された算術モジュールからインポートされます。これを可能にするには、算術モジュールに保存されている関数をエクスポートする必要があります。</p>
<p>これを行うには、以下に示すように、関数シグネチャの先頭に<code>export</code>のキーワードを追加します。</p>
<pre><code class="language-ts">export function add(a: number, b: number): number {
  return a + b;
}

export function multiply(a: number, b: number): number {
  return a * b;
}
</code></pre>
<p>外部モジュール内でアクセスできる必要があるすべての関数、クラス、定数、変数はエクスポートする必要があります。それらに<code>export</code>キーワードを前に付けるか、ファイルの下部にあるexportステートメントに含めます。</p>
<p>ECMAScriptエクスポート機能の詳細については、<a href="https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Statements/export">MDNドキュメント</a>をご覧ください。</p>
<h2><a class="header" href="#リモートインポート" id="リモートインポート">リモートインポート</a></h2>
<p>上記のローカルインポートの例では、<code>add</code>および<code>multiply</code>メソッドがローカルに保存された算術モジュールからインポートされます。同じ機能は、リモートモジュールから<code>add</code>メソッドと<code>multiply</code>メソッドをインポートすることによっても作成できます。 </p>
<p>この場合、バージョン番号を含むRamdaモジュールが参照されます。また、JavaScriptモジュールがTypeSriptモジュールに直接インポートされることにも注意してください。Denoはこれを問題なく処理します。</p>
<p><strong>Command：</strong> <code>deno run ./remote.ts</code></p>
<pre><code class="language-ts">import {
  add,
  multiply,
} from &quot;https://x.nest.land/ramda@0.27.0/source/index.js&quot;;

function totalCost(outbound: number, inbound: number, tax: number): number {
  return multiply(add(outbound, inbound), tax);
}

console.log(totalCost(19, 31, 1.2));
console.log(totalCost(45, 27, 1.15));

/**
 * Output
 *
 * 60
 * 82.8
 */
</code></pre>
<h1><a class="header" href="#依存関係の管理" id="依存関係の管理">依存関係の管理</a></h1>
<p>Denoでは、外部モジュールがローカルモジュールに直接インポートされるため、パッケージマネージャーの概念はありません。これは、パッケージマネージャーなしでリモートの依存関係を管理する方法の問題を提起します。依存関係の多い大きなプロジェクトでは、モジュールを個別のモジュールに個別にインポートすると、モジュールを更新するのが面倒で時間がかかります。</p>
<p>Denoでこの問題を解決するための標準的な方法は、<code>deps.ts</code>ファイルを作成することです。必要なすべてのリモート依存関係がこのファイルで参照され、必要なメソッドとクラスが再エクスポートされます。依存するローカルモジュールは、リモートの依存関係ではなく<code>deps.ts</code>を参照します。</p>
<p>これにより、大規模なコードベース全体のモジュールを簡単に更新できるようになり、「パッケージマネージャーの問題」があったとしても、それが解決されます。開発の依存関係は、別の<code>dev_deps.ts</code>ファイルで管理することもできます。</p>
<p><strong>deps.ts 例</strong></p>
<pre><code class="language-ts">/**
 * deps.ts re-exports the required methods from the remote Ramda module.
 **/
export {
  add,
  multiply,
} from &quot;https://x.nest.land/ramda@0.27.0/source/index.js&quot;;
</code></pre>
<p>この例では、<a href="examples/./import_export.html">ローカルおよびリモートのインポート例</a>と同じ機能が作成されます。ただし、この場合、Ramdaモジュールが直接参照される代わりに、ローカルの<code>deps.ts</code>モジュールを使用してプロキシによって参照されます。</p>
<p><strong>Command：</strong> <code>deno run dependencies.ts</code></p>
<pre><code class="language-ts">import {
  add,
  multiply,
} from &quot;./deps.ts&quot;;

function totalCost(outbound: number, inbound: number, tax: number): number {
  return multiply(add(outbound, inbound), tax);
}

console.log(totalCost(19, 31, 1.2));
console.log(totalCost(45, 27, 1.15));

/**
 * Output
 *
 * 60
 * 82.8
 */
</code></pre>
<h2><a class="header" href="#unix-cat" id="unix-cat">Unix cat</a></h2>
<p>このプログラムでは、各コマンドライン引数はファイル名であると想定され、ファイルが開かれ、標準出力に出力されます。</p>
<pre><code class="language-ts">const filenames = Deno.args;
for (const filename of filenames) {
  const file = await Deno.open(filename);
  await Deno.copy(file, Deno.stdout);
  file.close();
}
</code></pre>
<p>ここの<code>copy()</code>関数は、実際には必要なカーネル-&gt;ユーザースペース-&gt;カーネルのコピーしか作成しません。つまり、データがファイルから読み取られるのと同じメモリがstdoutに書き込まれます。これは、DenoのI / Oストリームの一般的な設計目標を示しています。</p>
<p>プログラムを試してください：</p>
<pre><code class="language-shell">deno run --allow-read https://deno.land/std@$STD_VERSION/examples/cat.ts /etc/passwd
</code></pre>
<h2><a class="header" href="#ファイルサーバー" id="ファイルサーバー">ファイルサーバー</a></h2>
<p>これはHTTPでローカルディレクトリを提供します。</p>
<pre><code class="language-shell">deno install --allow-net --allow-read https://deno.land/std@$STD_VERSION/http/file_server.ts
</code></pre>
<p>それを実行します：</p>
<pre><code class="language-shell">$ file_server .
Downloading https://deno.land/std@$STD_VERSION/http/file_server.ts...
[...]
HTTP server listening on http://0.0.0.0:4500/
</code></pre>
<p>また、最新の公開バージョンにアップグレードしたい場合は、次のようにします：</p>
<pre><code class="language-shell">file_server --reload
</code></pre>
<h2><a class="header" href="#tcp-echo-server" id="tcp-echo-server">TCP echo server</a></h2>
<p>これは、ポート8080で接続を受け入れ、送信したものをクライアントに返すサーバーの例です。</p>
<pre><code class="language-ts">const listener = Deno.listen({ port: 8080 });
console.log(&quot;listening on 0.0.0.0:8080&quot;);
for await (const conn of listener) {
  Deno.copy(conn, conn);
}
</code></pre>
<p>このプログラムを起動すると、PermissionDeniedエラーがスローされます。</p>
<pre><code class="language-shell">$ deno run https://deno.land/std@$STD_VERSION/examples/echo_server.ts
error: Uncaught PermissionDenied: network access to &quot;0.0.0.0:8080&quot;, run again with the --allow-net flag
► $deno$/dispatch_json.ts:40:11
    at DenoError ($deno$/errors.ts:20:5)
    ...
</code></pre>
<p>セキュリティ上の理由から、Denoは明示的な許可なしにプログラムがネットワークにアクセスすることを許可していません。ネットワークへのアクセスを許可するには、コマンドラインフラグを使用します：</p>
<pre><code class="language-shell">deno run --allow-net https://deno.land/std@$STD_VERSION/examples/echo_server.ts
</code></pre>
<p>テストするには、netcatを使用してデータを送信してみてください。</p>
<pre><code class="language-shell">$ nc localhost 8080
hello world
hello world
</code></pre>
<p><code>cat.ts</code>の例と同様に、ここでの<code>copy()</code>関数も不要なメモリコピーを作成しません。それはカーネルからパケットを受信し、さらに複雑にすることなく送り返します。</p>
<h2><a class="header" href="#サブプロセスを実行する" id="サブプロセスを実行する">サブプロセスを実行する</a></h2>
<p><a href="https://doc.deno.land/https/github.com/denoland/deno/releases/latest/download/lib.deno.d.ts#Deno.run">API リファレンス</a></p>
<p>例：</p>
<pre><code class="language-ts">// create subprocess
const p = Deno.run({
  cmd: [&quot;echo&quot;, &quot;hello&quot;],
});

// await its completion
await p.status();
</code></pre>
<p>実行:</p>
<pre><code class="language-shell">$ deno run --allow-run ./subprocess_simple.ts
hello
</code></pre>
<p>ここでは、<code>window.onload</code>に関数が割り当てられています。この関数は、メインスクリプトが読み込まれた後に呼び出されます。これはブラウザの<a href="https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers/onload">onload</a>と同じであり、メインのエントリポイントとして使用できます。</p>
<p>デフォルトでは、<code>Deno.run()</code>を使用すると、サブプロセスは親プロセスのstdin、stdout、およびstderrを継承します。開始されたサブプロセスと通信したい場合は、<code>&quot;piped&quot;</code>オプションを使用できます。</p>
<pre><code class="language-ts">const fileNames = Deno.args;

const p = Deno.run({
  cmd: [
    &quot;deno&quot;,
    &quot;run&quot;,
    &quot;--allow-read&quot;,
    &quot;https://deno.land/std@$STD_VERSION/examples/cat.ts&quot;,
    ...fileNames,
  ],
  stdout: &quot;piped&quot;,
  stderr: &quot;piped&quot;,
});

const { code } = await p.status();

if (code === 0) {
  const rawOutput = await p.output();
  await Deno.stdout.write(rawOutput);
} else {
  const rawError = await p.stderrOutput();
  const errorString = new TextDecoder().decode(rawError);
  console.log(errorString);
}

Deno.exit(code);
</code></pre>
<p>実行:</p>
<pre><code class="language-shell">$ deno run --allow-run ./subprocess.ts &lt;somefile&gt;
[file content]

$ deno run --allow-run ./subprocess.ts non_existent_file.md

Uncaught NotFound: No such file or directory (os error 2)
    at DenoError (deno/js/errors.ts:22:5)
    at maybeError (deno/js/errors.ts:41:12)
    at handleAsyncMsgFromRust (deno/js/dispatch.ts:27:17)
</code></pre>
<h2><a class="header" href="#パーミッションの調査と取り消し" id="パーミッションの調査と取り消し">パーミッションの調査と取り消し</a></h2>
<blockquote>
<p>このプログラムは、不安定なDeno機能を利用しています。
<a href="examples/../runtime/stability.html">不安定な機能の詳細</a>をご覧ください。</p>
</blockquote>
<p>プログラムによっては、以前に付与されたアクセス許可を取り消すことが必要な場合があります。後の段階でプログラムがこれらの権限を必要とする場合、プログラムは失敗します。</p>
<pre><code class="language-ts">// lookup a permission
const status = await Deno.permissions.query({ name: &quot;write&quot; });
if (status.state !== &quot;granted&quot;) {
  throw new Error(&quot;need write permission&quot;);
}

const log = await Deno.open(&quot;request.log&quot;, { write: true, append: true });

// revoke some permissions
await Deno.permissions.revoke({ name: &quot;read&quot; });
await Deno.permissions.revoke({ name: &quot;write&quot; });

// use the log file
const encoder = new TextEncoder();
await log.write(encoder.encode(&quot;hello\n&quot;));

// this will fail.
await Deno.remove(&quot;request.log&quot;);
</code></pre>
<h2><a class="header" href="#osシグナル" id="osシグナル">OSシグナル</a></h2>
<blockquote>
<p>このプログラムは、不安定なDeno機能を利用しています。
<a href="examples/../runtime/stability.html">不安定な機能の詳細</a>をご覧ください。</p>
</blockquote>
<p><a href="https://doc.deno.land/https/raw.githubusercontent.com/denoland/deno/master/cli/dts/lib.deno.unstable.d.ts#Deno.signal">API リファレンス</a></p>
<p><code>Deno.signal()</code>を使用して、OSシグナルを処理できます。</p>
<pre><code class="language-ts">for await (const _ of Deno.signal(Deno.Signal.SIGINT)) {
  console.log(&quot;interrupted!&quot;);
}
</code></pre>
<p><code>Deno.signal()</code> もpromiseとして機能します。</p>
<pre><code class="language-ts">await Deno.signal(Deno.Signal.SIGINT);
console.log(&quot;interrupted!&quot;);
</code></pre>
<p>シグナルの監視を停止したい場合は、シグナルオブジェクトの<code>dispose()</code>メソッドを使用できます。</p>
<pre><code class="language-ts">const sig = Deno.signal(Deno.Signal.SIGINT);
setTimeout(() =&gt; {
  sig.dispose();
}, 5000);

for await (const _ of sig) {
  console.log(&quot;interrupted&quot;);
}
</code></pre>
<p>上記のfor-awaitループは、<code>sig.dispose()</code>が呼び出されると5秒後に終了します。</p>
<h3><a class="header" href="#ファイルシステムイベント" id="ファイルシステムイベント">ファイルシステムイベント</a></h3>
<p>ファイルシステムイベントをポーリングするには：</p>
<pre><code class="language-ts">const watcher = Deno.watchFs(&quot;/&quot;);
for await (const event of watcher) {
  console.log(&quot;&gt;&gt;&gt;&gt; event&quot;, event);
  // { kind: &quot;create&quot;, paths: [ &quot;/foo.txt&quot; ] }
}
</code></pre>
<p>イベントの正確な順序は、オペレーティングシステムによって異なる場合があることに注意してください。この機能は、プラットフォームに応じて異なるsyscallを使用します：</p>
<ul>
<li>Linux: inotify</li>
<li>macOS: FSEvents</li>
<li>Windows: ReadDirectoryChangesW</li>
</ul>
<h2><a class="header" href="#現在のファイルがメインプログラムかどうかのテスト" id="現在のファイルがメインプログラムかどうかのテスト">現在のファイルがメインプログラムかどうかのテスト</a></h2>
<p>現在のスクリプトがプログラムへのメイン入力として実行されたかどうかをテストするには、<code>import.meta.main</code>を確認します。</p>
<pre><code class="language-ts">if (import.meta.main) {
  console.log(&quot;main&quot;);
}
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        
        <!-- Google Analytics Tag -->
        <script type="text/javascript">
            var localAddrs = ["localhost", "127.0.0.1", ""];

            // make sure we don't activate google analytics if the developer is
            // inspecting the book locally...
            if (localAddrs.indexOf(document.location.hostname) === -1) {
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

                ga('create', 'UA-149348992-5', 'auto');
                ga('send', 'pageview');
            }
        </script>
        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
        
        

    </body>
</html>
